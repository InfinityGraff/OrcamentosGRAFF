<!DOCTYPE html>
<html lang='pt-BR'>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orcamento</title>

    <link  href="https://raw.githack.com/InfinityGraff/MyBiblioteca/main/fontes.css"        rel="stylesheet">
    <link  href="https://raw.githack.com/InfinityGraff/MyBiblioteca/main/CSSBiblioteca.css" rel="stylesheet">
    <script src="https://raw.githack.com/InfinityGraff/MyBiblioteca/main/PreScript.js"      ></script>
    <script src="https://raw.githack.com/InfinityGraff/MyBiblioteca/main/Templates.js"      ></script>
    <!-- 
        <link  href="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/fontes.css"        rel="stylesheet">
        <link  href="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/CSSBiblioteca.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/PreScript.js"      ></script>
        <script src="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/Templates.js"      ></script>

        <link  href="../MyBiblioteca/fontes.css"        rel="stylesheet">
        <link  href="../MyBiblioteca/CSSBiblioteca.css" rel="stylesheet">
        <script src="../MyBiblioteca/PreScript.js"      ></script>
        <script src="../MyBiblioteca/Templates.js"      ></script>
    --> 

    <link  href="./CssGRAFF.css" rel="stylesheet">
    <script src="./BaseGRAFF.js"></script>
    <script src="./BiblGRAFF.js"></script>
    
        <script src="./JSON/DadosPDDS.js"></script>
        <script src="./JSON/DadosGRAD.js"></script>
        <script src="./JSON/DadosMPAG.js"></script>
        <script src="./JSON/DadosOOSS.js"></script>
        <script src="./JSON/DadosUBER.js"></script>
        <script src="./JSON/DadosCLNT.js"></script>

        <link rel="icon" type="image/x-icon" href="Img/FavG_32.png">
        <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script> -->
        <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
        <!--
        <script src="https://threejs.org/build/three.js"></script>-->
        <script src="./AchaMdd.js"></script>
        <script src="./Gera3D.js"></script>
        <style>
            .Fixed{position: fixed;}
        </style>
</head>

<script> // Base de Dados
    // mostrar pedidos aberto e pedidos concluido
    // a tabela vai ficar muito mais leve se exibir apenas os pedidos em aberto
    const Edi   = 'contenteditable="true"'
    const Err   = `onerror="this.src='./SVG/placeholder.svg'"`
    const Link  = 'http://localhost:3000'
    const Limit = {PDDS:{INN:547,OUT:3000},SERV:{INN:547,OUT:3000},PGMT:{INN:547,OUT:3000}}
    const Atual = {Pag:'#Pag_ORC'}
    const J     = {PDDS:[],SERV:[],PGMT:[],GRAD:[],MPAG:[],OOSS:[],UBER:[],CLNT:[]}
    const Navv  = ['Pedidos','Servicos','Pagamentos','Grades','MPago','Clientes']
    const Mnsg  = {PreTbl:(Typ)=>`A Tabela ${Typ} já estava Carregada...`}
    const N_Brev= {HOME:'Principal',ORC:'Orçamento',LOJA:'Loja',GBRT:'Gabaritos',BBTC:'Biblioteca',LIN:'',PDDS:'Pedidos',SERV:'Serviços',PGMT:'Pagamentos',GRAD:'DashBoard',CLNT:'Clientes',CONF:'Configurações',CUST:'Custos',ABCD:'ABCD'}
    const NavImg= ['HOME','LIN','ORC','LOJA','GBRT','BBTC','LIN','PDDS','SERV','LIN','PGMT','GRAD','CLNT','LIN','CONF']
    const D_brev= {Tipo:'Tipo',Serv:'Serviço',Lrg:'Largura',Alt:'Altura',Cmp:'Comprimento',Cbmt:'Acabamento',Gram:'Gramatura',Qnt:'QNT',Und:'Valor UND',SbTt:'SubTotal'}
    const PreTable ={PDDS:'',SERV:'',PGMT:'',GRAD:'',CLNT:''}
    const TypBndj  = ['SERV','PGMT','CUST','ABCD'] // Tabelas Secundárias ACHO Q DESNESSESÁRIO  ❌❌❌❌
    const LocSecund= {SERV:'PDDS',PGMT:'PDDS',CUST:'PDDS',ABCD:'GRAD'}
    let scrollPosition = [0,0]
    const Prod = { // Adicionar pra todos eles a proporção do Desconto pela quantidade // adicionar também o comporta das cores
        // Por M2
        'Adesivo'  :{Calc:'M2' , Stts:'Disp' , Prvw:'CanvMdd' , Desc:'Adesivo Impresso'     , Forn:['Grafit','BPrint','Tatiane'  ] , Prdc:['Arte','Refile',{'Aplicação':10}            ] , Extra:[            ] , HotKey:["colar", "adesivar", "autocolante"       ] ,
                        Variantes:{
                            'Brilho'          :{item:'1',Grad:'Ads(Blh)',Tipo:'',Valr:60 ,Cust:20},
                            'Fosco'           :{item:'2',Grad:'Ads(Fos)',Tipo:'',Valr:60 ,Cust:20},
                            'Blackout'        :{item:'3',Grad:'Ads(Blk)',Tipo:'',Valr:70 ,Cust:25},
                            'Transparente'    :{item:'4',Grad:'Ads(Trp)',Tipo:'',Valr:70 ,Cust:25},
                            'Laminado'        :{item:'6',Grad:'Ads(Blh)',Tipo:'',Valr:70 ,Cust:20},
                            'Espelhado'       :{item:'7',Grad:'Ads(Trp)',Tipo:'',Valr:80 ,Cust:20},
                            'Perfurado'       :{item:'5',Grad:'Ads(Prf)',Tipo:'',Valr:100,Cust:35},
            }},
        'Etiqueta' :{Calc:'M2' , Stts:'Disp' , Prvw:'CanvMdd' , Desc:'Impressão + Recorte'  , Forn:['Grafit','BPrint','Tatiane'  ] , Prdc:['Arte','Recorte'                            ] , Extra:[            ] , HotKey:["rótulo", "identificação", "label", "tag"] ,
                        Variantes:{
                            'Refilada'        :{item:'6',Grad:'Ads(Blh)',Tipo:'',Valr:70 ,Cust:20},
                            'Redonda'         :{item:'7',Grad:'Ads(Rct)',Tipo:'',Valr:75 ,Cust:30},
                            'Personalizada'   :{item:'7',Grad:'Ads(Rct)',Tipo:'',Valr:80 ,Cust:30},
            }},
        'Lona'     :{Calc:'M2' , Stts:'Disp' , Prvw:''        , Desc:'Banner, Faixa, ilhós' , Forn:['Grafit','BPrint','Tatiane'  ] , Prdc:['Arte'                                      ] , Extra:[            ] , HotKey:["painel"                                 ] ,
                        Variantes:{
                            'Banner'          :{item:'8' ,Grad:'Lon(Bnn)',Tipo:''                              ,Valr:70,Cust:22 , Limit:['0,00 x 1,20'] , Mdds:['0,50 x 0,70' , '0,80 x 1,20' , '2,00 x 1,00']}, 
                            'Faixa'           :{item:'9' ,Grad:'Lon(Fax)',Tipo:['Só Madeira','Madeira e ilhós'],Valr:70,Cust:22 , Limit:['0,00 x 1,20'] , Mdds:['2,00 x 0,50']}, 
                            'com ilhós'       :{item:'11',Grad:'Lon(Ilh)',Tipo:['Completo'  ,     'nas Pontas'],Valr:70,Cust:22 , Limit:['0,00 x 3,20'] , Mdds:['1,00 x 1,00']},
                            'Sem Acabamento'  :{item:'13',Grad:'Lon(Sem)',Tipo:''                              ,Valr:60,Cust:20 , Limit:['0,00 x 3,20'] , Mdds:[]},
            }},
        'Quadro'   :{Calc:'M2' , Stts:'Disp' , Prvw:'CanvMdd' , Desc:'Quadro sem Moldura'   , Forn:['Grafit','BPrint','Tatiane'  ] , Prdc:['Arte','Aplicação',{'Laminação':10},'Reflie'] , Extra:['PVC','Fita'] , HotKey:["moldura", "pôster", "cartaz"            ] ,
                        Variantes:{  
                            'PS 1mm'          :{item:'17',Grad:'Ads(Blh)',Tipo:'',Valr:100,Cust:21.25 + 20, Limit:['2,00 x 1,00'] , Mdds:['0,30 x 0,20']}, // Folha de PVC com (2,00 x 1,00) R$ 42,50
                            'PS 2mm'          :{item:'18',Grad:'Ads(Blh)',Tipo:'',Valr:130,Cust:'        ', Limit:['2,00 x 1,00'] , Mdds:['0,30 x 0,20']},  
                            'PVC 2mm'         :{item:'14',Grad:'Ads(Blh)',Tipo:'',Valr:150,Cust:'        ', Limit:['2,44 x 1,22'] , Mdds:['0,30 x 0,20']},
                            'PVC 3mm'         :{item:'15',Grad:'Ads(Blh)',Tipo:'',Valr:170,Cust:43.00 + 20, Limit:['2,44 x 1,22'] , Mdds:['0,30 x 0,20']}, // Folha de PVC com (2,44 x 1,22) R$ 86,00
                            'PVC 5mm'         :{item:'16',Grad:'Ads(Blh)',Tipo:'',Valr:' ',Cust:'        ', Limit:['2,44 x 1,22'] , Mdds:['0,30 x 0,20']},
            }},
        'ímã'      :{Calc:'M2' , Stts:'Disp' , Prvw:'CanvMdd' , Desc:'Geladeira ou Carro'   , Forn:['Grafit','BPrint','Tatiane'  ] , Prdc:['Arte','Aplicação','Reflie'                 ] , Extra:['Manta'     ] , HotKey:["magneto", 'manta magnética'             ] ,
                        Variantes:{ // Adicional de Calendário (Acima de 500 UND)
                            '0.3 - Geladeira' :{item:'19',Grad:'Ads(Blh)',Tipo:'',Valr: 70.00+60,Cust:35.00 , Limit:['0,00 x 0,60'] , Mdds:['0,05 x 0,06']}, // 0.3 - R$ 21,00 (0,60 x 1,00) || o Metro fica: 
                            '0.4 - Geladeira' :{item:'20',Grad:'Ads(Blh)',Tipo:'',Valr: 95.00+60,Cust:48.33 , Limit:['0,00 x 0,60'] , Mdds:['0,05 x 0,06']}, // 0.4 - R$ 29,00 (0,60 x 1,00) || o Metro fica: 
                            '0.8 - Carro'     :{item:'21',Grad:'Ads(Blh)',Tipo:'',Valr:180.00+60,Cust:98.33 , Limit:['0,00 x 0,60'] , Mdds:['0,60 x 0,30']}, // 0.8 - R$ 59,00 (0,60 x 1,00) || o Metro fica: 
            }},
        'Trofeu'   :{Calc:'M2' , Stts:'Disp' , Prvw:'CanvMdd' , Desc:'Acrilico Cristal 2mm' , Forn:['Stock','Barraca'            ] , Prdc:['Arte'                                      ] , Extra:['Acrilico'  ] , HotKey:['acrilico'                               ] ,
                        Variantes:{
                            'Virado'          :{Grad:'Ads(Trp)',Valr:60+30+180+100+17, Cust:20+15+90+60}, // Adesivo, Vinil, Acrilico, Corte (ultimos 15 é estouro)
                            'Colado'          :{Grad:'Ads(Trp)',Valr:60+30+180+100+35, Cust:20+15+90+60}, // Adesivo, Vinil, Acrilico, Corte (ultimos 15 é estouro)
        }},
        // Offset
        'Cartão'   :{Calc:'OFS', Stts:'Disp' , Prvw:'Fotinha' , Desc:'Medida: 9cm x 5cn'    , Forn:['BPrint','Bureal'] , Prdc:[] , Extra:[] , HotKey:["cartão de visita", "business card", "papel", "folha"] , 
                        Variantes:{
                    'Brilho'      :{Table:[
                        ['Frente' ,'250g',[['500', 90,31,'left:7.6% ;top:33.4%'],['1.000',135,45,'left:26.8%;top:33.4%']]],
                        ['F.Verso','250g',[['500',115,42,'left:52.4%;top:33.4%'],['1.000',150,54,'left:72.2%;top:33.4%']]], 
                        ['Frente' ,'300g',[['500',130,49,'left:0%   ;top:0%   '],['1.000',145,56,'left:0%   ;top:0%   ']]], 
                        ['F.Verso','300g',[['500',150,58,'left:0%   ;top:0%   '],['1.000',165,65,'left:0%   ;top:0%   ']]],]},
                    'Brilho Local':{Table:[
                        ['Frente' ,'300g',[['500',155,62,'left:7.6% ;top:66%  '],['1.000',190,78,'left:26.8%;top:66%  ']]],
                        ['F.Verso','300g',[['500',190,80,'left:52.4%;top:66%  '],['1.000',230,99,'left:72.2%;top:66%  ']]],]},
                    }},
        'Panfleto' :{Calc:'OFS', Stts:'Disp' , Prvw:'Fotinha' , Desc:'Gramatura: 90g'       , Forn:['Bureal'         ] , Prdc:[] , Extra:[] , HotKey:["folheto", "papel", "informativo",'folha'] , 
                        Variantes:{
                    '10 x 15':{Table:[
                        ['Frente' ,'90g',[['1.000',130, 67,'left:25.2%;top:25.2%'],['2.500',180, 85,'left:25.2%;top:34.4%'],['5.000',270,170],['10.000',650,340 ]]],
                        ['F.Verso','90g',                                         [['2.500',280,135,'left:69.4%;top:34.4%'],['5.000',320,220],['10.000',720,392 ]]],]},
                    '15 x 20':{Table:[
                        ['Frente' ,'90g',[['1.000',190,127,'left:25.2%;top:56.4%'],['2.500',340,170,'left:25.2%;top:65.8%'],['5.000',650,340],['10.000',900,600 ]]],
                        ['F.Verso','90g',                                         [['2.500',500,270,'left:69.4%;top:65.8%'],['5.000',700,440],['10.000',1200,800]]],]},
                    }},
        'Talão'    :{Calc:'OFS', Stts:'Disp' , Prvw:'Fotinha' , Desc:'Gramatura: 90g'       , Forn:['JLTal']           , Prdc:[] , Extra:[] , HotKey:[] , 
                        Variantes:{
                    '10 x 15':{Table:[
                        ['Preto e Branco','1 Via',[['4',60,30,'left:22.2%;top:26.8%'],['8', 90,45],['12',130,65],['20',170, 85,'left:22.2%;top:36.8%']]],
                        ['Colorido'      ,'1 Via',[['4',80,40,'left:60.6%;top:26.8%'],['8',110,55],['12',150,75],['20',200,100,'left:60.6%;top:36.8%']]],
                        ['Preto e Branco','2 Via',[['4',75,35],['8',105,55],['12',145,70],['20',185, 80]]],
                        ['Colorido'      ,'2 Via',[['4',95,45],['8',125,65],['12',165,85],['20',215,110]]],
                    ]},
                    '15 x 20':{Table:[
                        ['Preto e Branco','1 Via',[['2',60,30,'left:22.2%;top:58.8%'],['4', 90,45],['10',170, 85],['20',300,150,'left:22.2%;top:69.2%']]],
                        ['Colorido'      ,'1 Via',[['2',80,40,'left:60.6%;top:58.8%'],['4',110,55],['10',200,100],['20',350,175,'left:60.6%;top:69.2%']]],
                        ['Preto e Branco','2 Via',[['2',75,35],['4',105,55],['10',185, 90],['20',315,165]]],
                        ['Colorido'      ,'2 Via',[['2',95,45],['4',125,65],['10',215,110],['20',365,195]]],
                    ]},
                    '9 x 21' :{Table:[
                        ['Preto e Branco','1 Via',[['3',60,30],['6', 90,45],['9',130,65],['12',150, 75]]],
                        ['Colorido'      ,'1 Via',[['3',80,40],['6',110,55],['9',170,85],['12',190, 95]]],
                        ['Preto e Branco','2 Via',[['3',75,35],['6',105,55],['9',145,70],['12',165, 80]]],
                        ['Colorido'      ,'2 Via',[['3',95,45],['6',125,65],['9',185,85],['12',205,100]]],
                    ]},
        }},
        'Tag'      :{Calc:'OFS', Stts:'Disp' , Prvw:'Fotinha' , Desc:'Gramatura: 90g'       , Forn:['Bureal'         ] , Prdc:[] , Extra:[] , HotKey:["etiqueta", "rótulo", "marcador",'furo'  ] , 
                        Variantes:{
                    '4 x 5':{Table:[
                        ['Reto' ,'250g',[['1.000',130,73,'left:26.8%;top:31%' ]]],
                        ['Curva','250g',[['1.000',150,85,'left:69.2%;top:31%' ]]]
                    ]},
                    '5 x 9':{Table:[
                        ['Reto' ,'250g',[['500',100,57,'left:26.8%;top:54%'  ],['1.000',140,69,'left:26.8%;top:64.4%']]],
                        ['Curva','250g',[['500',120,67,'left:69.2%;top:54%'  ],['1.000',150,79,'left:69.2%;top:64.4%']]]
                    ]},
            }},
        'Cardápio' :{Calc:'OFS', Stts:'Disp' , Prvw:'Fotinha' , Desc:'Gramatura: 90g'       , Forn:['BPrint']          , Prdc:[] , Extra:[] , HotKey:["menu", "lista de pratos", "menu de restaurante", "opções de comida", "restaurante", "cozinha"] ,
                        Variantes:{
                'A4':{Table:[
                    ['Frente' ,'170g',[['1',15,6.90,'left:23% ;top:26.2%']]],
                    ['F.Verso','170g',[['1',20,8.80,'left:68.6%;top:26.2%']]],
                ]},
                'A3':{Table:[
                    ['Frente' ,'170g',[['1',30,13.75,'left:23% ;top:36.2%']]],
                    ['F.Verso','170g',[['1',35,17.50,'left:68.6%;top:36.2%']]],
                ]},
        }},
        'Topo Bolo':{Calc:'OFS', Stts:'Offf' , Prvw:'Fotinha' , Forn:['BPrint']      ,
                        Variantes:{
                            'Topo de Bolo' :{}}
        },
        'Crachá'   :{Calc:'OFS', Stts:'Offf' , Prvw:'Fotinha' , Forn:['BPrint']      ,
                        Variantes:{
                            'Crachá' :{}}
        },
        'Carteira' :{Calc:'OFS', Stts:'Offf' , Prvw:'Fotinha' , Forn:['BPrint']      ,
                    Variantes:{
                            'Carteira' :{}}
        },
        // Tecido
        'Camisa'   :{Calc:'QNT', Stts:'Offf' , Prvw:'PrevCAM' , Desc:'Sublimação Total'     , Forn:['Inová']   , Prdc:[] , Extra:[           ] , HotKey:["blusa", "camiseta", "roupa", "estampa", "moda", "vestuário","Pano","Tecido"] ,
                        Variantes:{
                            'M.Curta'  :{Tipo:'',Tamn:['PP','P','M','G','GG'],Valr:['Helanquinha','Dry Furado'],Valor:0,},
                            Regata     :{Tipo:'',Tamn:['PP','P','M','G','GG'],Valr:['Helanquinha','Dry Furado'],Valor:0,},
                            Polo       :{Tipo:'',Tamn:['PP','P','M','G','GG'],Valr:['                        '],Valor:0,},
                            'M.Longa'  :{Tipo:'',Tamn:['PP','P','M','G','GG'],Valr:['Helanquinha','Dry Furado'],Valor:0,},
        }},
        'Calção'   :{Calc:'QNT', Stts:'Offf' , Prvw:'PrevCAM' , Desc:'Sublimação Total'     , Forn:['Inová']   , Prdc:[] , Extra:[           ] , HotKey:['Short','Sublimação','roupa','pano'] ,
                        Variantes:{
                            'Bermuda' :{},
                            'Short'   :{},
        }},  
        'WindFlag' :{Calc:'QNT', Stts:'Offf' , Prvw:''        , Desc:'Tecido: Oxford'       , Forn:['NovaImp'] , Prdc:[] , Extra:[{'Base':80}] , HotKey:['Sublimação',"Pano","Tecido",'BigFlag','WindBanner','Bandeira do Vento'] ,
                        Variantes:{
                            Faca :{Tipo:['P','M','G'],Valr:0,Cust:0},
                            Vela :{Tipo:['P','M','G'],Valr:0,Cust:0},
                            Pena :{Tipo:['P','M','G'],Valr:0,Cust:0},
                            Gota :{Tipo:['P','M','G'],Valr:0,Cust:0},
            }},
        'BigBall'  :{Calc:'QNT', Stts:'Offf' , Prvw:''        , Desc:'Tecido: Oxford'       , Forn:['NovaImp'] , Prdc:[] , Extra:[{'Base':80}] , HotKey:['Sublimação',"Pano","Tecido"] ,
                        Variantes:{
                            P  :{Tipo:[''],Valr:0,Cust:0},
                            M  :{Tipo:[''],Valr:0,Cust:0},
                            G  :{Tipo:[''],Valr:0,Cust:0},
            }},   
        'Bandeira' :{Calc:'M2' , Stts:'Offf' , Prvw:''        , Desc:'Tecido: Oxford'       , Forn:['Inová']   , Prdc:[] , Extra:[           ] , HotKey:['Sublimação',"Pano","Tecido"] ,
                        Variantes:{
                            'Oxford' :{},
                            'Cettin' :{},
        }},    
        // Cortes
        'Router'   :{Calc:'M2v', Stts:'Offf' , Prvw:'CnvEcut' , Desc:'Cortes em PVC 10mm'   , Forn:['Barraca','Jailson']  ,
                        Variantes:{
                            'PVC'      :{},
                            'Acrilico' :{}}
        },
        'Recorte'  :{Calc:'M2v', Stts:'Offf' , Prvw:'CnvEcut' , Desc:'Adesivo Recortado'    , Forn:['Stock'                      ] , Prdc:['Arte','Aplicação','Reflie'                 ] , Extra:[            ] , HotKey:["Ploter",'Lamina','Siluet','Vetor'       ] ,
                        Variantes:{
                            'Vinil'           :{item:'22',Calc:'M2',Tipo:'',Valr:150,Valor:70  , Limit:[] , Mdds:[]},
                            'Holografico'     :{item:'23',Calc:'M2',Tipo:'',Valr:200,Valor:100 , Limit:[] , Mdds:[]},
        }},
      'Sinalização':{Calc:'M2v', Stts:'Offf' , Prvw:'' , Forn:['-']      ,
                        Variantes:{
                            'Sinalização' :{}}
        },
        // Serviços
        'Arte'     :{Calc:'UND', Stts:'Offf' , Prvw:'MdalArt' , Desc:'Criação e Recriação'  , Forn:['Arte']      ,
                        Variantes:{
                    'Arte' :{}}
        },
        'Plotagem' :{Calc:'M2v', Stts:'Offf' , Prvw:''        , Forn:['Stock']              ,
                        Variantes:{
                    'Plotagem' :{}}
        },
        // Produtos
        'Figurinha':{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['Stock']      ,
                        Variantes:{
                            'Figurinha' :{}}
        },
        'Vendas'   :{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['Stock']      ,
                        Variantes:{
                            'Vendas' :{}}
        },
        'Cartela'  :{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['Stock']      ,
                        Variantes:{
                            'Cartela' :{}}
        },
        // Ferragem
        'Placa'    :{Calc:'UND', Stts:'Offf' , Prvw:'Canva3D' , Forn:['-']      ,
                    Variantes:{
                        'Placa' :{}}
        }, 
       'Serigrafia':{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['Stock']      ,
                        Variantes:{
                            'Serigrafia' :{}}
        },
        }

    // Const Importante pra Compilar a Tabela pra deixa o Load Mais Rápido
    const EtrProd = ObjEtr(Prod)
    const AllProd = ObjKey(Prod)
    const HotKy   = Object.fromEntries(EtrProd.map(([k,v])=>[k,v.HotKey||[]]))
    const AllForn = Object.fromEntries(EtrProd.map(([k,v])=>[k,v.Forn  ||[]]))
    const Vari=e=>ObjKey(Prod[e].Variantes)
    const TiposArtes=[]

    const O = {
        Forn:['','Grafit','BPrint','Tatiane','Inová','Bureal','Stock','Arte','JLTal','Varyus','NovaImp','Barraca','Jailson','-'], // 'WM SilkSing','Casas leo'
        Serv:['',...AllProd],
        Tipo:['','Recorte',...Uniq(AllProd.flatMap(e=>Vari(e)))],
        Dsng:['','Allan','Baby','Fexta','Italo','Eurik','Canva','Ja Tinha','n tem',''],
        Form:['','Pix','Av','Card'],
        Pgmt:['','Pix','Av','Card'],
        Dstn:['','Serv1','Serv2'],
        Stts:['','Orçamento','Arte','Impressão','Acabamento','Pronto','Entregue','Devendo','Concluído'],
        Cams:['','PP (Inf)','P (Inf)','M (Inf)','G (Inf)','PP','P','M','G','GG','XG','XXG'],
        TArt:['','Criação','Recriação','Vetorização','Modificação','Adaptação','Finalização','Ajustes','Mockup','Restauração','Tratamento'],
       TArt2:['','Layout','CGI'], // aqui mais interessada nos Fins
        

    }
    const AllList = ObjKey(O)
    const ALL = {CLNT:[]}
    const Listagem=(Typ)=>ALL[Typ] = Uniq(J.CLNT.map(E=>E['Clnt'])) // pegar todos itens de uma determinada coluna no Json e botar na const acima
    const D = {PDDS:0,SERV:0,CLNT:0,PGMT:0,GRAD:0,OOSS:0,UBER:0,MPAG:0,CUST:0}

    const dbCol = {Id:"Id",Lin:"Lin",Data:"Data",Clnt:"Clientes",Serv:"Serviços",Valr:"Valor",Pgmt:"Pagamentos",Cust:"Custos",Lcro:"Lucros",Stts:"Status",Lixo:"Lixo",Tipo:"Tipo",Desc:"Descrição",Dsng:"Design",Arte:"Arte",Forn:"Fornecedor",OK:"OK",Entg:"Entregue",Detg:"Detg",Grad:"Grad",Gimg:"Gimg",Abcd:"Abcd",ABCD:"Abcd",OS:"OS",Uber:"Uber",Cmnt:"Comentário",SStts:"Status",Form:"Forma",Link:"Link",Mpag:"Mpag",Item:"Item",Dstn:"Destino",Pcnt:"Porcentagem",Cmpt:"Complemento",Cntt:"Contato",Lcal:"Local",Loja:"Loja",CtLj:"Ctt Loja",Cat:"Categoria",Emal:"Email",Cont:"Cont",Nome:"Nome",QntS:"Qnt",VUbr:"Valor Uber",AsStts:"Stts",Dest:"Destino",Hora:"Hora",Dirc:"Direção",Prds:"Produtos",Cpvt:"Comprovante",User:"Usuário",Qnt:"Qnt",Lag:"Lag",Alt:'Alt',TArt:'TArt'}
    const CRYPP = {F:'Fixo',B:'Bndj',S:'Slct',A:'Auto',C:'Chek',G:'Sugg',M:'Imgs',E:'Edit',T:'Grds',V:'Valr',D:'Data',O:'Soma',X:'Lixo',Z:'Mdds'}
    const CRYCLS = {A:'AutoComp',I:'CorID'}
    const BS = { // ['1º é Forma de Carregar', '2º são as Classes CSS
        PDDS:{Id:['F','I'], Lin:['E','' ],Data:['D','' ],Clnt:['B',''],Serv:['B',''],Valr:['O','A'],Pgmt:['B','' ],Cust:['B',''],Lcro:['E','A'],Stts:['S','A'],Lixo:['X','']},
        SERV:{Id:['F','I'],Data:['D','A'],Clnt:['B','A'],Serv:['S',''],Tipo:['S',''],Qnt :['E','' ],Lag :['Z','' ],Alt :['Z',''],Desc:['E','']/*,Calc:['E','' ]*/,Valr:['V','A'],Dsng:['S',''],TArt:['S',''],Arte:['M','' ],Forn:['S','A'],OK:  ['C',''],Entg:['C',''],Detg:['E',''],Grad:['E',''],Gimg:['M','A'],Abcd:['E','A'],OS:['E','A'],Uber:['E','A'],Cmnt:['E',''],SStts:['E','A'],Lixo:['X','']},
        PGMT:{Id:['F','I'],Data:['D','' ],Clnt:['B','' ],Valr:['V',''],Form:['S',''],Desc:['E','' ],Stts:['E','' ],Link:['E',''],Mpag:['G','' ],Lixo:['X','' ]},
        CUST:{Id:['F','I'],Data:['D','' ],Item:['E','' ],Valr:['V',''],Forn:['S',''],Dstn:['E','' ],Pcnt:['A','' ],Lixo:['X','']},
        FINC:{Valr:['F',''],Cust:['F',''],Lcro:['F','']},

        CLNT:{Id:['F','I'],Clnt:['E','' ],Cmpt:['E',''],Cntt:['E','' ],Lcal:['E','' ],Loja:['E',''],CtLj:['E','' ],Cat: ['E',''],Stts:['E',''],Link: ['E',''],Lixo:['X','']},
        GRAD:{Id:['F','I'],Data:['D','A'],Emal:['E',''],Forn:['S','A'],Grad:['M','A'],OS  :['E',''],Cont:['E','A'],Abcd:['B',''],Stts:['E',''],Lixo:['X','']},
        ABCD:{Id:['E','I'],Nome:['E','' ],Desc:['E',''],QntS:['E','A'],Valr:['V','A'],Uber:['E',''],VUbr:['V','A'],Link:['E',''],AStts:['E','A'],Lixo:['X','']},
        UBER:{Id:['F','I'],Data:['D','' ],Dest:['E',''],Hora:['E','' ],Valr:['E','' ],Dirc:['E',''],Prds:['E','' ],Desc:['E',''],Grad:['E',''],Link: ['G',''],Lixo:['X','']},
        MPAG:{Id:['F','I'],Cpvt:['E',''],Data:['E','' ],Clnt:['E','' ],Valr:['E','' ],Hora:['E','' ],Form:['E',''],User:['E','' ],Link:['G',''],Lixo:['X','']}, // Removi 'Cpvt'
        
        OOSS:{Id:['F','I'],Nome:['E',''],Link:['E',''],Desc:['E',''],Lixo:['X','']},
        CALC:{}
    }

    const ListaFora = ['Arte','Router','Envelopamento','Serigrafia','Figurinha','Topo Bolo','Vendas','Placa','Sinalização','Cartela','Plotagem','Crachá','Carteira']
    const ListaKits=['Zebu','Zimaz']
    let todoTitle = {Serv:[],Cust:[],Finc:[],Soma:[],Calc:[]}

    // Configuração do Supabase
    const SUPABASE_URL = "https://adxigvfxtafvlmpvwwvb.supabase.co"
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkeGlndmZ4dGFmdmxtcHZ3d3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1Njc1NTEsImV4cCI6MjA2NzE0MzU1MX0.wc90qDuSNhtolJBd4qLEux3xCwJwPuTTFb3gZMKUBYU"
    const supabase = window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY)
</script>

<script> // Bibliotecas
        const Bool = e => typeof e === 'boolean' ? e : e === 'true';
    // Epecíficas (as q Retorna)
        const Prvn    =()=>event.preventDefault()
        const OjKy    =Typ=>ObjKey(BS[Typ]) // o nome pode mudar pra algo mais Intuitivo
        const Colx    =(Typ,col)=>FIdx(OjKy(Typ),col)+1
        const ExtObj  =Obj=>[0,1,2].map(i=>ObjVal(Obj).map(arr=>arr[i])) // não sei a necessidade
        const daClass =R=>{const bs = BS[R.Typ][R.Col][1] ; return (bs==true?'':bs).split('').map(e=>CRYCLS[e]).join(' ') || ''} // Aplica as Casses q estão no BS
        const tr_ID   =tr =>getClas(tr,'tr-').split('-')[1]
        const tr_X    =tr =>getClas(tr,'tr-').split('-')[2]
        const TRs     =Typ=>$$(`#H_${Typ} > tbody > tr`)
        const Rx2     =arry=>Rx(['Rastr',...arry])
        const D_Rastr =e=>Extrat_Clss(e,'Rastr-').split('-')
        const D_R     =R=>{const v = (typeof R === "string" ? R : Extrat_Clss(R,'Rastr-')).split('-') ; return {r:v[0],Typ:v[1],Row:v[2],Col:v[3],Tm:v[4],ColX:v[5]}}
        const D_P     =R=>{const v = (typeof R === "string" ? R : Extrat_Clss(R,'Rpai-' )).split('-') ; return {r:v[0],Typ:v[1],Row:v[2],Col:v[3],Tm:v[4],ColX:v[5]}}
        const DrPai   =R=>R.replace('Rastr','Rpai')
        const Coll    =x=>`td:nth-child(${x})`
        //const Col     =(Typ,col)=>`td:nth-child(${FIdx(OjKy(Typ),col)+1})`
        const Col     =(Typ,col)=>`td:nth-child(${Colx(Typ,col)})`
        const Colls   =(Typ,col,n=null)=>$$(`#H_${Typ} > tbody > tr${n?':not([class*=" n"])':''} > ${Col(Typ,col)} > div > .P-P`)
        const H_Col_p =(Typ,col)=>`#H_${Typ} > tbody > tr > ${Col(Typ,col)} p` // analisar se é realmente nessesário
        const TH      =(Typ,col)=>$(`#H_${Typ} > thead > tr ${Col(Typ,col).replace('td:','th:')}`)
        const RgxPixAV=e=>e.trim().match(/(\d+[\.,]?\d*)([a-zA-Z]+)/) || []
        const SunPix  =Stg=>Stg.split('|').map(p=>parseFloat(p.replace(/[^\d.,]/g,'').replace(',','.'))||0).reduce((sum,n)=>sum+n,0)
        const isBdj   =e=>!!e.closest('.BndjTBL')
        const Sib     =e=>$(e,Pai(event.target))
        const AllI    =(table,Atv=null)=>$$(`:scope > thead > tr > th ${Atv=='Atv'?'i.Atv':'i'}`,table)
        function criaCol_Typ(New,Typ){J[Typ].forEach(e=>{if(e[New]==null){e[New]=''}})}                          // criaCol_Typ('Qnt','PDDS') // pra quando for Fora!
        function criaCol_Col(New,Typ,Col){J[Typ].forEach(e=>{if(!e[Col]){return} ; e[Col].forEach(s=>{if(s[New]==null){s[New]=''}})})} // criaCol_Col('Qnt','PDDS','Serv') // pra quando for Dentro!
        
        // Epecíficas (as q Executa)
        const ALERT=Stg=>{Inn('#ALERT span',Stg);ShowTime2('#ALERT',5)}
        function Drag() {event.dataTransfer.setData("text",    event.target.id)}
        function Drag2(){event.dataTransfer.setData("text",Pai(event.target).id)}
        function Drop() {Prvn();event.target.appendChild($(`#${event.dataTransfer.getData("text")}`))}
        
        //Evento de Click na Página inteira, com a intenção de Ocultar tudo que for Bandeijas
        function NoneBndj(){if(event.target.closest('.bndj')||event.target.classList.contains('NObj')){return}else{None($$('.bndj'))}}
    // conferir se essa é realmente nessesária
        const DarkLite2=(e,Chk)=>{if(Chk){Trc2(e,'Dark','Lite')}else{Trc2(e,'Lite','Dark')} ; console.log('Chamou DarkLite',e,Chk)}
        const LOG=(...stg)=>console.log(...stg)
        //const Diferentes=(New,Atual)=>Object.fromEntries(ObjEtr(New).filter(([k,v])=>v!==Atual[k]))
</script>

<div> <!--JS e CSS das Tabelas-->
    <div>   <!--TABELAS  - ⭐⭐⭐_ _ -->
        <style> /*CSS apenas da Tabela*/
            /*essa bndj deveria ter "Shdw rd Cl"*/
            .BNdj    {transform:translate(-50%,0%); left:50%; z-index:500 ; width:250px ; max-height:250px;  box-shadow:0 0 9px #00000069}
            .BNdj > a{position:absolute ; bottom:100%; left:50%; transform:translate(-50%,0%); z-index:1; width:20px ; height:11px} /*essa é a Pontinha da Bndj*/
            /*Particularidades*/
            .BndjFOT,.BndjFLT{overflow: hidden}
            .BndjSUG .Sugg,.BndjCLT .Sugg,.BndjTBL .Sugg{border-radius:10px}
            .BndjSUG .Sugg > *,.BndjFOT .Sugg > *,.BndjCLT .Sugg > *{padding: 4px}
            .BndjSUG{width:390px !important}
            .BndjTBL{padding:5px ; width:auto !important; height:auto !important}
            .BndjFOT{border-radius:10px 10px 0 0; bottom:0px}
            .BndjFLT{border-radius:0 0 10px 10px}
            .BjConf         {color:#ffffff; height:24px}
            .BjConf img     {height:18px; width:18px}
            .BjConf span.Atv{fill:#ffff00; background:#00df00}
            .BndjFLT input  {height:18px ; width:80px}
            .Sugg {overflow-x: hidden; overflow-y: auto; max-height: 200px; width: 100%;}
            
                th .Sugg div:hover div{opacity:1}
                th .Sugg div div      {opacity:0;font-size:15px; background:#d822ab; color:#ffffff; width:18px; height:18px; text-align: center; margin-left:10px ;} /*Bolinhas + e -*/
    
            /*Fica apenas nas Tabelas*/
            .Antig{color: #ffffff; font-size: 7px; top: 0px;}
            .Ant-Blu{background:#0000ff !important}
            .Ant-Red{background:#ff0000 !important}
            .Ant-Grn{background:#008000 !important}
            .Ant-Bol{width:6px; height:6px; border-radius:255px}
                td        .grifoo{display:none  ; height:5px; width:5px ; left:0px}
                td.Grifo2 .grifoo{display:block ; background:#ff880060}
                td.Grifo1 .grifoo{display:block ; background:#ff8800fd}
                select.Psq {background:#ff7b00} /*Grifo do Select*/
            .TBLAA tfoot  [class*="Foot-Pgmt"] a{color:#00df00}
            .TBLAA tfoot .RS{color:#00df00; font-size:7px}
            .icoFone{height: 12px !important ; width: 12px !important ; top: -16px; right: -87px;}
            .CorID     {background:#94949473}
            /*Maneiras de Selecionar uma Célula*/
                .SelectSoma{background:#ff0000; color:#ffffff}
                .LinkAtv   {background:#028602; color:#ffffff}
                .LinkULT   {background:#1900ff; color:#ffffff}
                
            /*Cria as Linahs de Divisórias de Serv*/ /*Algo assim também pode ser Aplicado pra as Larguras das Colunas*/
            :is(.Bdj_SERV, #H_SERV) > * > tr > :is(td,th):is(:nth-child(3),:nth-child(9),:nth-child(13),:nth-child(18)){border-right:4px solid #bb0092}

            /*.TBLAA p.P-P{display: inline-block; white-space: nowrap; }*/
            .bnDJ .Bdj_ABCD td:nth-child(1){width: 23px;}
            .bnDJ .Bdj_ABCD td:nth-child(2){width: 190px;}
            .bnDJ .Bdj_ABCD td:nth-child(3){width: 50px;}
            .bnDJ .Bdj_ABCD td:nth-child(4){width: 23px;}
            .bnDJ .Bdj_ABCD td:nth-child(5){width: 80px;}
            .bnDJ .Bdj_ABCD td:nth-child(6){width: 50px;}
            .bnDJ .Bdj_ABCD td:nth-child(7){width: 80px;}
            /*.bnDJ .Bdj_ABCD td:nth-child(8){width: 200px;}*/
            .bnDJ .Bdj_ABCD td:nth-child(9){width: 30px;}

            table.Card > thead{display: none}
            table.Card > tfoot{display: none}
            table.Card > tbody{display:flex; flex-wrap:wrap; gap:12px ; padding:10px}
            table.Card > tbody > tr{ /*CARD*/
                padding: 8px;
                background:#ffffff;
                border-radius: 16px;
                box-shadow: 0 4px 12px #0000001a;
            }
            table.Card > tbody > tr {
                display: grid;
                grid-template-areas:
                    " Id   Id  Data"
                    "Clnt Clnt Stts"
                    "Serv Serv Serv"
                    "Valr Cust Pgmt"
                    "Obs  Obs  Obs ";
                grid-template-columns: 1fr auto auto;
                gap: 4px 4px
            }
            table.Card > tbody > tr[class^="n"]{display: none;}
            table.Card .AutoComp,table.Card .CorID{background: transparent !important;}
                                       table.Card > tbody > tr{width:calc(25% - 9px)}        /*Largura dos Cards 4 por Linha*/
            @media (max-width: 800px) {table.Card > tbody > tr {width: calc(33.333% - 8px)}} /* 3 por linha */
            @media (max-width: 500px) {table.Card > tbody > tr {width: 100%}}                /* 1 por linha */
            
            table.Card > tbody > tr > td{padding: 5px; height: auto !important; } /*border: 1px solid red;*/
            table.Card > tbody > tr > td:nth-child(1) { grid-area: Id   }table.Card > tbody > tr > td:nth-child(1) > div > .P-P {color:#780096; font-size: 10px ; font-weight:bold}
            table.Card > tbody > tr > td:nth-child(2) { grid-area: lin  ; display: none;}
            table.Card > tbody > tr > td:nth-child(3) { grid-area: Data }table.Card > tbody > tr > td:nth-child(3) > div > .P-P {color:#666666; text-align:right                        } table.Card > tbody > tr > td:nth-child(3) > div > .P-P > img{height:11px; margin-right:3px ; display: block;}
            table.Card > tbody > tr > td:nth-child(4) { grid-area: Clnt }table.Card > tbody > tr > td:nth-child(4) > div > .P-P {color:#666666; font-size: 17px ;                       } table.Card > tbody > tr > td:nth-child(4) > .Ct{justify-content:start}
            table.Card > tbody > tr > td:nth-child(5) { grid-area: Serv }table.Card > tbody > tr > td:nth-child(5) > div > .P-P {color:#000000;                 ;                       } table.Card > tbody > tr > td:nth-child(5) > .Ct{justify-content:start}
            table.Card > tbody > tr > td:nth-child(6) { grid-area: Valr }table.Card > tbody > tr > td:nth-child(6) > div > .P-P {color:#008000; font-size: 16px ; font-weight:bold      } table.Card > tbody > tr > td:nth-child(6) > .Ct{justify-content:start}
            table.Card > tbody > tr > td:nth-child(7) { grid-area: Pgmt }table.Card > tbody > tr > td:nth-child(7) > div > .P-P {color:#000000; }
            table.Card > tbody > tr > td:nth-child(8) { grid-area: Cust }table.Card > tbody > tr > td:nth-child(8) > div > .P-P {color:#c7380c; font-size: 12px}
            table.Card > tbody > tr > td:nth-child(9) { grid-area: Lucro; display: none;}
            table.Card > tbody > tr > td:nth-child(10){ grid-area: Stts }table.Card > tbody > tr > td:nth-child(10) > div > .P-P{color:#999999; width: 50px;}
            table.Card > tbody > tr > td:nth-child(11){ grid-area: Obs  ; display: none; color:#757575; font-size: 12px}
            table.Card > tbody > tr > td:nth-child(12){ grid-area: Lixo ; display: none;}

            table.Tbla td[class*="Data"] a:nth-child(2){display: none}
            table.Tbla td[class*="Data"] a:nth-child(3){display: flex}
            table.Card td[class*="Data"] a:nth-child(2){display: flex}
            table.Card td[class*="Data"] a:nth-child(3){display: none}
            
        </style>

        <script>// TABELAS (Transitar na Tabela com as Setas do Teclado)
            const Tm_R=(e,x,Typ,id)=>{ //Argumento 'id', recebe string 'ID' se for Obj, e recebe '0' se for array
                const BSBS=(typ,x,idx)=>BS[typ][OjKy(typ)[x]][idx]
                return `Rastr-${Typ}-${e=='Foot'?'Foot':e[isArr(e)?0:id]}-${OjKy(Typ)[x]}-${CRYPP[BSBS(Typ,x,0)]}-${x+1}`
            }
            const Tm_tdFoot=(arr,Typ)=>arr.map((e,x)=>`<td class="${Tm_R('Foot',x,Typ,'')} Rltv"></td>`).join('')
            const Tm_Antg=(A)=>A ? `<div class="Abslt Antig Ant-${A[0]} ${A[1]==''?'Ant-Bol':''}">${A[1]}</div>` : ''
            const BrevSrc={Grad:'Grad',Gimg:'Grad'}

            const Tm_Tm = {
                Fixo:(e,R,A)=>`${Tm_Antg(A)}<p class="P-P Ct" name="${e}">${e}</p>`, // o Fixo também tem Data por isso tinha informação de data aqui
                Auto:(e,R,A)=>`${Tm_Antg(A)}<p class="P-P Ct" name="${e}">${e}</p>`,
                Edit:(e,R,A)=>`${Tm_Antg(A)}<p class="P-P Ct" name="${e}" ${Edi} onkeydown="EntBlr(this)" onblur="Rmv(_td(this),'Foco');EditCell(this)" onfocus="Add(_td(this),'Foco')">${e}</p>`,
                Valr:(e,R,A)=>`${Tm_Antg(A)}<p class="P-P Ct" name="${e}" ${Edi} onkeydown="EntBlr(this)" onblur="Rmv(_td(this),'Foco');EditCell(this)" onfocus="Add(_td(this),'Foco');CurAll(this)" oninput="MaskR$(this)">${e?RS(e):'R$ -'}</p>`,
                Mdds:(e,R,A)=>`${Tm_Antg(A)}<p class="P-P Ct" name="${e}" ${Edi} onkeydown="EntBlr(this)" onblur="Rmv(_td(this),'Foco');EditCell(this)" onfocus="Add(_td(this),'Foco');CurAll(this)" oninput="MaskNumI(this)">${e?Cm(e):''}</p>`,
                Data:(e,R,A)=>`${Tm_Antg(A)}<p class="P-P Ct" name="${YMD(e)}" onclick="TrcFih(this)"><img class="none" src="./SVG/Tempo.svg"><a>${Tempo(YMD(e))}</a><a>${BrevData(DMY(e))}</a></p><input type="date" class="none" value="${YMD(e)}" onchange="EditCell(this)" onblur="TrcFih(this)">`,
                Slct:(e,R,A)=>`${Tm_Antg(A)}<select class="P-P w100" onchange="EditCell(this)">${R.Col==='Serv' ? Tm_OptsGraff(O[R.Col],e) : Tm_Opts(O[R.Col],e)}</select>`,
                Chek:(e,R,A)=>`${Tm_Antg(A)}<input  class="P-P"      onchange="EditCell(this)" type="checkbox" ${Bool(e)?'checked':''}>`,            
                Imgs:(e,R,A)=>`${Tm_Antg(A)}<img onclick="AbrirImg(this)" draggable="false" src="./Base/${BrevSrc[R.Col]||R.Col}/${R.Col=='Arte'&&ListARQ.includes(R.Row)?`${R.Row}.svg`:e}" ${Err}>`,
                Lixo:(e,R,A)=>`<a onclick="RmvROW(this)" name="${e}">${SVG.Lixo}</a>`,
                Grds:(e,R,A)=>`${e}`,
                Soma:(e,R,A)=>{const FiltID=id=>J['PDDS'].find(e=>e.Id==id)?.Serv??null ; const soma = SOMA_Obj2(FiltID(R.Row),'Valr') ;todoTitle['Soma'].push(soma) ; return `<p class="P-P Ct" onclick="CtrlSoma(this)" name="${soma}">R$ ${Cm(soma)}</p>`},
                Sugg:(e,R,A)=>`<div class="Rltv"><p class="P-P">${e}</p><div class="BndjSUG BNdj Abslt none Cl"><a>${SVG.Ponta}</a><span class="Sugg Cl"></span><button class="Mini Stky2" onclick="Linkar(this)">Linkar</button></div></div>`,
                Link:(e,R,A)=>`<div class="Rltv"><p class="P-P">  - </p><div class="BndjCLT BNdj Abslt none Cl"><a>${SVG.Ponta}</a><input class="Stky" placeholder="Clientes" oninput="LinkSug('CLNT',this,$('.Sugg',Pai(this)),'LinkCLnt')" onkeydown="KeyEntr(()=>TesteClnt(this))"><span class="Sugg Cl"></span></div></div>`
                
                // Quando o Clnt em PDDS vem vazio ele vira Link
                // se o Suggs tiver vazio deixar pelomenos uma mensagem avisando
                // Suggs e Links terão opções de "Troca" e de "Adição"
                // Adicionar um Input de pesquisa no SuggLink também igual o de Clnt
                // ocultar o botão de Lixo, quando tiver Link de PDDS no 'CLNT'
            }

            const Tm_Loade=(Typ)=>{
                return For(8).map(()=>`<tr>${OjKy(Typ).map(()=>`<td><div class="Sklt"></div></td>`).join('')}</tr>`).join('')
            }

            const Tm_Bndj=(arr,Typ,RPai)=>`<table class="Bdj_${Typ} ${arr[1][0]==""?'none':''}">
                <thead><tr>${arr[0].map(t=>`<th>${t}</th>`).join('')}</tr></thead>
                <tbody>${arr.slice(1).map((LL,X)=>`<tr class="tr-${LL[0]}-${X}">${LL.map((v,x)=>Tm_Td(v,LL,x,Typ,RPai)).join('')}</tr>`).join('')}</tbody>
                </table>`

            function Tm_Td(v,e,x,Typ,RPai=''){const r = Tm_R(e,x,Typ,'Id') ; const R = D_R(r) ; const Scd = TypBndj.includes(Typ) ? 'Secund' : ''
                const valid = Typ!=='CLNT' && R.Tm=='Bndj' && R.Col=='Clnt' && v=="" && RPai==''
                return valid        ? `<td class="${r} ${RPai} ${Scd} ${daClass(R)} Rltv" onclick="ShowBndj(this)"><div class="Ct">${Tm_Tm['Link'](v,R)}</div></td>` : // se for uma Bndj de Clnt e tiver vazio então chama SuggClnt
                        R.Tm=='Bndj' ? `<td class="${r} ${RPai} ${Scd} ${daClass(R)}     " onclick="ShowBndj(this)">${Tratamento(v,r)}</td>` :
                        R.Tm=='Sugg' ? `<td class="${r} ${RPai} ${Scd} ${daClass(R)}     " onclick="ShowBndj(this);SuggLink(this,'${r}')"><div class="Ct">${Tm_Tm[R.Tm](v,R)}</div></td>`
                                    : `<td class="${r} ${RPai} ${Scd} ${daClass(R)} Rltv"><div class="Ct">${Tm_Tm[R.Tm](v,R)}</div></td>`
            }

            function Tratamento(Arr,r){
                const R     = D_R(r)
                const col   = R.Col
                const Find  = col==='Clnt' ? [J[AA(col)].find(E=>E.Id==Arr.trim())].filter(Boolean) : Arr||[]
                const Title = col==='Abcd' ? Find.map(e=>`${e[ 'Id' ]}`             ).join(''   ) :
                                col==='Pgmt' ? Find.map(e=>`${e['Valr']}${e['Form']}` ).join(' | ') :
                                col==='Serv' ? Find.map(e=>`${e['Serv']} ${e['Desc']}`).join(' | ') :
                                col==='Cust' ? Find.map(e=>`${e['Valr']}`             ).join(''   ) :
                                col==='Finc' ? Find.map(e=>`${e['Lcro']}`             ).join(''   ) :
                                                Find.map(e=>`${e[  col ]}`             ).join(' | ')

                if(Title!=''){if(['Cust','Finc','Calc'].includes(col)){todoTitle[col].push(Title)}}
                col=='Serv' ? Find.map(e=>`${todoTitle[col].push(e['Serv'])}`) : null
                
                const Reordem =()=>{if(col=='Serv'||col=='Pgmt'||col=='Cust'||col=='Abcd'){ // Reordenar se Precisar ou seja se o Usuário quiser!
                    return OrdnCol(ArrObj_ArrArr(Find),ObjKey(BS[col.toUpperCase()]))
                    }else{return ArrObj_ArrArr(Find)}} // as demais permanecem iguais

                const Lista     = Find.map((e,x)=>x===0 ? Tm_Bndj(Reordem(),AA(col),DrPai(r)) : '').join('')
                const iconFone  = col==='Clnt'? Find[0] ? Find[0].Cntt==='' ? '' : `<img class="icoFone HOV" onclick="console.log('FONE')" src="./SVG/Icon_Fone.svg">`:'' : ''
                const ConcatIMG = col==='Serv'? Find.map(e=>`${ListARQ.includes(e['Id']) ? `<img onclick="AbrirImg(this)" src="./Base/Arte/${e['Id']}.svg">` : ''}`).join('|') : ''
                const Grifo     = `<i class="grifoo RD"></i>`

                return `<div class="Ct"><p class="P-P" ${col==='Pgmt'?`name="${SunPix(Title)}"`:`name="${Title}"`}>${Title}</p>${iconFone}${ConcatIMG}${Grifo}</div>
                            <div class="Rltv w100">
                                <div class="BndjTBL BNdj Abslt none Cl"><a>${SVG.Ponta}</a>${Lista}
                                    <button class="Mini" onclick="NewLinBdj(this)">+ Novo ${RmvPlural(N_Brev[AA(col)])}</button>
                                </div>
                            </div>`
            }

            const Tm_Table=(typ,arry)=>{ const IN = performance.now()

                const Retorno = arry.reverse().map((e,X)=>{ // Aplico Reverse se quero começar reverso
                    
                    const oID = Num(`${e.Id}`.split('_')[0])
                    if ((oID < Limit[typ]?.INN || oID > Limit[typ]?.OUT)) return; // Reduzir o Limit de linhas pra Exibir!
                    if(e.Lixo==true)       {return} // Remover os que estão Na Lixeira!
                    if(e.Stts=='Concluido'){return} // Remover as Concluidas
                    return `<tr class="tr-${e.Id}-${X}">${ObjOrdn(e,OjKy(typ)).map((v,x)=>Tm_Td(v,e,x,typ)).join('')}</tr>`
                }).join('')

                const Perform = (performance.now()-IN).toFixed(2)
                Perform < 0.5 ? null : console.log(`⏱️🔴 Tm_Tables(${typ}): ${Perform}ms`)
                return Retorno
                // acredito q posso simplificar exitando a pesquisa do nome do Clnt, em cada Bndj, pois ta procurando 3 vezes em cada Linha! uma pra PDDS, ai uma na Bndj Serv e PGMT
                // ao Clicar no ID, exibirá uma Bndj com um Relatório de (RG,USER) 'usuário basicamente é o responsavel'
            }
        </script>
    </div>

    <script> // CONFIGS  - ⭐_ _ _ _ Botão pra Ocultar ID e Ocultar outras coisas tbm na Tabela 
        const Tm_Config=Typ=>`<input type="checkbox" onchange="TrcTog($('#H_${Typ}'),'hMin','hMax');SaveConfig()"> <input type="checkbox" onchange="Tog($('#H_${Typ}'),'w100');SaveConfig()">`

        function CtrlSoma(Eu){Tog(Eu,'SelectSoma');Inn('#Sommma',`Soma: ${RS(SOMA($$('.SelectSoma').map(e=>Nm(e))))}`)}
        
        document.addEventListener('DOMContentLoaded', function(){ // Função do Esc
            document.addEventListener('keydown',function(event){
                if(event.key==='Escape'){
                    if(EShow($('#FModal'))){return}
                    else{$$(`${Atual.Pag} .BNdj, ${Atual.Pag} .BNfot`).forEach(e=>Add_N(e))}
                }// F_Clen(Atual.Pag) // se for outro botão
        })})
    </script>

    <script> // PESQUISA - ⭐⭐⭐⭐_
        const NavPesq =(Pesq   )=>{$$('.pPesq').forEach(e=>None(e));Show($$(Pesq))}
        const Grifar  =(e,Rgx  )=>e.replace(Rgx,match=>`<strong style="background:orange" name="">${match}</strong>`)
        const Espelhar=(Org,Dst)=>{Dst.forEach(e=>{e.innerHTML = Org.innerHTML ; $('input',e) ? $('input',e).value = $('input',Org).value : null})} // Provavelmnte da pra usar com outras coisas tbm fora Pesq
        let debounceTimer

        function Pesq(Inpt,Typ){                // ✔️ Fazer a Pesquisa
            clearTimeout(debounceTimer) // cancela chamadas anteriores
            debounceTimer = setTimeout(()=>{
                Espelhar(Pai(Inpt),$$(`.Pesq_${Typ}`).filter(e=>e!==Pai(Inpt)))
                if(Typ=='ORC'){
                    const r = new RegExp(RxClear(Inpt.value),'i')
                    $$('#Div-Prod > div').forEach(e=>{
                        $$(".rgx",e).forEach(Rx=>{Rx.innerHTML = Grifar(Rx.textContent,r)}) // Grifar
                        e.style.display = r.test(RxClear(e.textContent)) ? '' : 'none'      // Ocultar
                })}
                else if($(`#Pag_${Typ}`).classList.contains('TBLAA')){ // Conferir se a pesquisa é uma Tabela
                    const Aa=$(`.Pesq_${Typ} .Pesq-Aa.Atv`)?  '' :'i'
                    const A_=$(`.Pesq_${Typ} .Pesq-A_.Atv`)?'\\b':''
                    const Bj=$(`.Pesq_${Typ} .Pesq-Bj.Atv`)
                    const CleaVal = Inpt.value.replace(/\[[^\]]*\]/g,' ').replace(/\s+/g,' ').trim()
                    const regex = new RegExp(`${A_}${EscpRgx(CleaVal)}${A_}`,Aa)
                        const mtch = [...Inpt.value.matchAll(/\[([^\]]*)\]/g)]
                        const COL1 = mtch[0]?.[1] || false // Primeiro valor dentro de []
                        const COL2 = mtch[1]?.[1] || false // Segundo  valor dentro de []
                    TRs(Typ).forEach(tr=>{                                   
                        const P_P2  = !COL2 ? $$(`:scope > ${COL1?Col(Typ,COL1):'td'} ${Bj?'':'> div >'} .P-P`,tr)                                        // Fora ou Fora e Dentro
                                            : $$(`:scope > ${COL1?Col(Typ,COL1):'td'} .BndjTBL ${COL2?Col((COL1||'').toUpperCase(),COL2):'td'} .P-P`,tr)  // Apenas Dentro da Bandeja

                        const Cnct = P_P2.map(Rx=>VAL(Rx)).join('#')
                        P_P2.forEach(Rx=>{if(Rx.tagName=='P'){Inn(Rx,Grifar(Rx.textContent,regex))}else{regex.source!==''&&regex.test(VAL(Rx))&&Inpt.value!=='' ? Add(Rx,'Psq') : Rmv(Rx,'Psq')}})  // Grifar o Texto encontrado // o else é se n for tag p, provavelmente é um Select
                        $$(Rx2([Typ,'Bndj']),tr).forEach(e=>{                    // Cria a Bolinha
                            const Camada1_p = $$(':scope > div > .BndjTBL > table > tbody > tr > td > div > .P-P strong',e).some(E=>E.innerText!=='')
                            const Camada1_s = $$(':scope > div > .BndjTBL > table > tbody > tr > td > div > .Psq'       ,e).some(E=>VAL(E)!=='')
                            const Camada2_p = $$(               '.BndjTBL > table > tbody > tr > td > div > .P-P strong',e).some(E=>E.innerText!=='')
                            const Camada2_s = $$(               '.BndjTBL > table > tbody > tr > td > div > .Psq'       ,e).some(E=>VAL(E)!=='')
                            if(Camada1_p||Camada1_s){Add(e,'Grifo1')}else{Rmv(e,'Grifo1')}
                            if(Camada2_p||Camada2_s){Add(e,'Grifo2')}else{Rmv(e,'Grifo2')}
                        })                       
                        if(regex.test(Cnct)){Rmv(tr,'n0')}else{Add(tr,'n0')}      // Ocultar (Aplica None)
                    })
                    Rfresh_Foot(Typ)
                }
            },100)
            // Depois Encontrar mais de 1 Correpondência na mesma linha
            // Depois criar uma configuração de Pesquisa q troca de oninput para onkeyEnter (pra n ficar muito Pezado)
        }
        // Opção de pesquisar com Enter
        // não chamar a função se digitar bem Rápido
    </script>

    <div>   <!--FILTROS  - ⭐⭐⭐⭐_ -->
        <style> /*FILTROS - CSS*/
            /*Particularidades da BndjFLT*/
            .ThFilt > i    {position:absolute; cursor:pointer; font-size:9px; right:0px; top:50%; transform:translate(-0%,-50%);opacity:0.5}
            .ThFilt > i.Atv{opacity:1}
            .ThFilt > b    {position:absolute; border-radius:255px; width:15px; height:15px; text-align:center; top:-5px; }
            .ThFilt > b.Atv{background:#0c8f00; right:29px}
            .ThFilt > b.Rtv{background:#ff0000; right:10px}   

            .filtTrue{  color:#ffffff; background:#008000 !important} /*aplica no Tr*/
            .filtFals{  color:#ffffff; background:#ff0000 !important} /*aplica no Tr*/
            .ThFilt_Atv{color:#ffffff; background:#059b00}            /*aplica no Filt*/
            .ThFilt_Rtv{color:#ffffff; background:#ff0000}            /*aplica no Filt*/
        </style>
        <script> // FILTROS - SCRIPT
            const Tm_thSort=(arr,Typ)=>{             // ✔️ Carrega Todos os Cabeçalhos (melhorar os CSS do input=[date])
                return arr.map((e,x)=>e=='Lixo'?`<th><p>${e}</p></th>`:
                    `<th class="ThFilt Rltv noslt" onclick="ShowBndj(this);OpcyFilt(_table(this).id);Load_ThFilt(this,'${Typ}','${e}')">
                            <p class="ppt" name="${e}">${dbCol[e]}</p>
                            <i onclick="Orden(this,'${x}','p')">▼</i>
                            <b class="Ct none Atv">0</b>
                            <b class="Ct none Rtv">0</b>

                            <div class="Rltv w100">
                                <div class="BndjFLT BNdj Abslt none">
                                    <div class="BjConf Stky Ev" onclick="ShowDate(this,'${Typ}','${e}')"></div>
                                    ${e=='Data'?`<input type="date" onchange="RangeDate(this,'${Typ}','${e}')" class="D-Inn none">
                                                 <input type="date" onchange="RangeDate(this,'${Typ}','${e}')" class="D-Out none">` : ''}
                                    <span class="Sugg Cl">${e}</span>
                                </div>
                            </div>
                    </th>`).join('') // P=Texto, i=▼, b=Notfi, a=Config, span=Suggs
            }

            const Trato=(Arr,col)=>{                 // ❌ Corrige Palavras
                return col==='Valr' ?  FazArry(Arr).map(e=>Cm(e.replace('R$','').trim()))     // Remove os R$ (não tão nessesário caso os dados venham certinhos)
                    : col==='Pgmt' ?      Arr.flatMap(e=>e.replace(/\d*/g,'').split(' | ')) // Pega apenas os ['Pix','Av'...]
                    : Arr
            }

            function Palavras(Typ,Col,n,Brute){      // ✔️ Encontra e Modifica as Palavras q vai Exibir no Filtro
                const IN = performance.now()                                
                    const Clientes = ['Id','Clnt','Cmpt','Cntt','Lcal','Loja','CtLj','Cat','Stts','Lin','Link']
                    const Servicos = ['Id','Serv','Desc','Data','Valr','Detg','Grad','OS','Uber','Cmnt']
                    const Pagament = ['Id','Desc','Data','Link','Mpag','Valr']
                    const Pedidoss = ['Id','Lin' ,'Data']
                    const Mercapag = ['Id','Valr','Data','Hora','Mpag','Link']

                    const Valls =   Brute=='Brute'                        ? Uniq(Colls(Typ,Col,n).map(e=>VAL(e)))             :
                                    Typ=="SERV" && Col==='OK'             ? ['true','false']            :
                                    Typ=="SERV" && Col==='Entg'           ? ['true','false']            : 
                                    Typ=="CLNT" && Clientes.includes(Col) ? Uniq(J.CLNT.map(E=>E[Col])) :
                                    Typ=="MPAG" && Mercapag.includes(Col) ? Uniq(J.MPAG.map(E=>E[Col])) :
                                    Typ=="SERV" && Servicos.includes(Col) ? Uniq(J.PDDS.flatMap(e=>e['Serv'].map(E=>Trato(E[Col],Col)))) :
                                    Typ=="PGMT" && Pagament.includes(Col) ? Uniq(J.PDDS.flatMap(e=>e['Pgmt'].map(E=>Trato(E[Col],Col)))) :
                                    Typ=="PDDS" && Pedidoss.includes(Col) ? Uniq(J.PDDS.map(e=>e[Col])) :
                                    Col=='Clnt' ? ALL['CLNT'] :
                                    Typ=="PDDS" && ['Cust','Finc','Calc'].includes(Col) ? Uniq(todoTitle[Col]) :
                                    Typ=="PDDS" && Col==="Serv"                         ? Uniq(todoTitle[Col]) :
                                    Typ=="PDDS" && Col==='Valr'                         ? Uniq(todoTitle['Soma'].map(e=>Cm(e))) :
                                    AllList.includes(Col) ? O[Col] :
                                    // o Obigetivo central da Função é Evitar isso!
                                    Uniq(Colls(Typ,Col,n).map(e=>VAL(e))) // PEZADO

                    const Perform = (performance.now()-IN).toFixed(2)
                    Perform < 0.5 ? null : console.log(`⏱️🟡 Palavras:(${Typ},${Col}): ${Perform}ms`) // quando eu venho por F_Filt() não precisa do Typ
                    return Valls
            }

            function Tm_Filt(Eu,Typ,col){            // ✔️ Depende da Tabela Carregada
                const IN = performance.now()
                const ThSugg = $('.Sugg',Eu)
                const X = IdxDe(_th(ThSugg))+1           
                const qry   = `#H_${Typ} > tbody > tr > ${Col(Typ,col)} > div > .P-P`
                const Qry_N = qry.replace('tr',"tr:not([class*=` n`])") // Aplicar apenas para Linhas Visiveis // Pode Sair!
                const QRY = [Typ,col]
                const Ex = `Ex_Filt('${Typ}','${col}')`

                $('.BjConf',_th(ThSugg)).innerHTML = `
                    <span class="HOV ppt Ct" onclick="F_Filt(this,'${Typ}','${col}','Todos')"           ><img src="./SVG/Icon_Todos.svg">     <p class="none">Todos     </p> </span>
                    <span class="HOV ppt Ct" onclick="F_Filt(this,'${Typ}','${col}','${Qry_N}','${X}')" ><img src="./SVG/Icon_Filtados.svg">  <p class="none">Filtados  </p> </span>
                    <input class="" placeholder="pesq">
                    <span id="icnFront_${col}" class="HOV ppt Ct" onclick="TOV(this);${Ex}"             ><img src="./SVG/Icon_Lin.svg">                                      </span> 
                    <span class="HOV ppt Ct" onclick="F_Rndn(this,'${Qry_N}')"                          ><img src="./SVG/Icon_Randomizar.svg"><p class="none">Randomizar</p> </span>
                    <span id="icnFilt_${col}"  class="HOV ppt Ct" onclick="TOV(this);${Ex}"             ><img src="./SVG/Icon_Destacar.svg">  <p class="none">Destacar  </p> </span>
                `// no icon Linha ta afunção Ativa ou Desativa Frontira de Palavras

                const Lista = Palavras(Typ,col)
                const NovoArry = Lista.map(e=>e===''?"'Vazio'":e).sort(e=>e==="'Vazio'"?-1:1)

                ThSugg.innerHTML = NovoArry.map(e=>`<div class="Ct w100">
                                                    <div class="ppt RD HOV" onclick="F_Clik(this);${Ex}">-</div>
                                                    <p>${e}</p>
                                                    <div class="ppt RD HOV" onclick="F_Clik(this);${Ex}">+</div>
                                                    </div>`).join('')
                
                const Perform = (performance.now()-IN).toFixed(2)
                Perform < 0.5 ? null : console.log(`⏱️🔵 Tm_Filt:(${Typ},${col}): ${Perform}ms`)
            }

            function F_Filt(btn,Typ,cOl,Qry,Col){    // ✔️ Filtra o Filter (descobrir pq n funciona com Numeros)
                const ThSugg = $('.Sugg',_th(btn))
                const FotBndj = Col ? $(`:scope > tfoot > tr > td:nth-child(${Col}) .BndjFOT`,_table(btn)) : null
                const arry    = FotBndj ? $$('span',FotBndj).map(s=>s.innerText.split(':')[0]) : null
                const Plvrs   = !arry && Trato(Palavras(Typ,cOl,true,'Brute'),cOl) // tem q ser no Brute pra poder pegar apenas os visíveis
                    $$('p',ThSugg).forEach(E=>{
                        if(Qry==='Todos'){Rmv_N(Pai(E))
                        }else if(arry){
                            if(arry.includes(E.innerText)){Rmv_N(Pai(E))
                            }else{Add_N(Pai(E))}               // da pra remover isso
                        }else if(Plvrs.includes(E.innerText)){Rmv_N(Pai(E))
                        }else{Add_N(Pai(E))}                   // da pra remover isso
                    })
            }

            function F_Clik(Eu){                     // ✔️ Pinta o Filt com Ativo e Desativo
                Prvn()
                const PP = $('p',Pai(Eu)) // Valor Clicado
                if(Inn(Eu)=='+'){if(PP.classList.contains('ThFilt_Rtv')){Rmv(PP,'ThFilt_Rtv')}else{Tog(PP,'ThFilt_Atv')}} // Decide se é +
                if(Inn(Eu)=='-'){if(PP.classList.contains('ThFilt_Atv')){Rmv(PP,'ThFilt_Atv')}else{Tog(PP,'ThFilt_Rtv')}} // Decide se é -
                const Notifi=e=>{const l = $$(`.ThFilt_${e}`,_th(Eu)).length ; const n = $(`b.${e}`,_th(Eu)) ; if(l==0){None(n)}else{Show(n)} ; Inn(n,l) } // Atualiza Notificações + ou -
                Notifi('Atv') ; Notifi('Rtv')
            }

            function Ex_Filt(Typ,col){               // ✔️ Executa o Filto na Tabela (Adicioanr Maior < Menor >)
                const thh    = TH(Typ,col)
                const Corlor = $(`#icnFilt_${Inn($('p',thh))}.Atv`)
                const Front = $(`#icnFront_${col}.Atv`)
                const Ativos = $$('.ThFilt_Atv',thh).map(e=>Front?`\\b${Inn(e)}\\b`:Inn(e)).join('|') ; const RxAtv = new RegExp(Ativos,'i')
                const Rtivos = $$('.ThFilt_Rtv',thh).map(e=>Front?`\\b${Inn(e)}\\b`:Inn(e)).join('|') ; const RxRtv = new RegExp(Rtivos,'i')
                const x = IdxDe(thh)+1
                const Add_C=e=>Add(e,'filtTrue') ; const Add_F=e=>Add(e,'filtFals')
                const Rmv_C=e=>Rmv(e,'filtTrue') ; const Rmv_F=e=>Rmv(e,'filtFals')

                if(true){ // depois vira (Combinado = && E) ou (Independente = || OU)
                    const Qry   = `#H_${Typ} > tbody > tr > ${Col(Typ,col)} > div > .P-P`
                    $$(Qry).forEach(e=>{
                        const VaL = `${VAL(_td(e))}` || "'Vazio'"
                        const tr = _tr(e)
                        if(Ativos=='' && Rtivos==''){Rmv(tr,`n${x}`);Rmv_C(tr);Rmv_F(tr)}
                        else{
                                 if(Ativos!=='' && RxAtv.test(VaL)){Corlor ? Add_C(tr) : Rmv(tr,`n${x}`)}
                            else if(Rtivos!=='' && RxRtv.test(VaL)){Corlor ? Add_F(tr) : Add(tr,`n${x}`)}
                            else{ 
                                    if(Ativos!==''){Corlor ? Rmv_C(tr) : Add(tr,`n${x}`)}
                                    if(Rtivos!==''){Corlor ? Rmv_F(tr) : Rmv(tr,`n${x}`)}
                                }
                        }
                    })
                }
                Rfresh_Foot(Typ)
            }

            function F_Rndn(Eu,Qry,Clik){            // ✔️ Randomiza
                const noCopy = true // impedir que pinte quando não tem cópias
                const PermitOculta = true // opção pra ocultar quem n tem Randon
                const QRY = Qry.replace('` n`','" n"')
                const ObbjClnt=()=>$$(QRY).map(e=>Inn(e))
                let NewObj = {}
                const QntCores = Uniq(ObbjClnt()).length
                const CoresEtr = ObjEtr(cRepet(ObbjClnt())).sort((a,b)=>b[1]-a[1]).forEach(([k,v])=>{
                        if(noCopy&&v===1   ){} // não faz nada caso seja apenas 1 ocorrência
                    else if(!k||k.trim()==''){} // n faz nada caso seja vazio
                    else{
                        if(true){NewObj[k]=RandoCor()}  // cor Randon
                        else{NewObj[k]=v}               // do maior pra o menor
                                                        // corsin Cor Não
                    }
                })
                $$(QRY).forEach(e=>{
                    _tr(e).style.background = NewObj[Inn(e)]
                    if(PermitOculta && NewObj[Inn(e)]==undefined){Add(_tr(e),'none')}
                })
            }
            
            function F_Clen(Typ){                    // ✔️ Limpa todos os Filtros
                TRs(Typ).forEach(e=>{For(20).forEach(E=>Rmv(e,`n${E}`)) ; e.style.background = ''}) // Exibe todas as Linhas e Limpa o Random
                $$('.ThFilt b'  ).forEach(e=>None(e)) // Limpa Notifi dos Filter
                const Class = ['ThFilt_Atv','ThFilt_Rtv','filtTrue','filtFals','SelectSoma']
                Class.forEach(e=>{$$(`.${e}`).forEach(E=>{Rmv(E,e)})})
                Rfresh_Foot(Typ)
            }

            function OpcyFilt(Typ){                  // ❌ Ativar Desativa opacy do Icon do F_Filt() //SIMPLIFICAR//
                const Valid = $$(`#${Typ} .ThFilt b`).some(e=>e.innerText!=0)
                const Icon1 = $$(`#${Typ} .ThFilt .BNdj > div span:nth-child(1)`)
                const Icon2 = $$(`#${Typ} .ThFilt .BNdj > div span:nth-child(2)`)
                const Icon3 = $$(`#${Typ} .ThFilt .BNdj > div span:nth-child(4)`)
                const Icon4 = $$(`#${Typ} .ThFilt .BNdj > div span:nth-child(5)`)
                if(Valid){
                    Icon2.forEach(e=>e.style.opacity = 1)
                }else{Icon2.forEach(e=>e.style.opacity = 0.4)}
                // Precisa evitar o Click, tem q dar Return quando isso tiver Ativo!
            }

            function ShowDate(Eu,Typ,Col){           // ✔️ Oculta e Exibe a Bandeija de Range Data
                if(Col=='Data'){Tog($$(`.D-Inn,.D-Out`,_th(Eu)),'none')}
            }

            function RangeDate(Eu,Typ,col){          // ✔️ Seleciona o Intervalo de Data
                const inn   =  $(`.D-Inn`).value
                const out   =  $(`.D-Out`).value || inn
                $$('.Sugg > div',_th(Eu)).forEach(e=>{const D = $('p',e) // D é Data
                    if(Inn(D)>=inn && Inn(D)<=out){Add(D,'ThFilt_Atv')}
                    else{Rmv(D,'ThFilt_Atv')}
                })
                Ex_Filt(Typ,col)
                // Depois Evoluir pra Criar minha Próprio Calendário, pra eu poder fazer aquele Range de faixa
                // Adicionar Botão de Todo Período (oq seria Remover todos os Filtros)
            }
            



            function Orden(e,x,Cntd=null,order=null){// ✔️ se tiver 'Cntd' é conteudo, é por que o texto a ser coletado esta dentro de alguma tag especifica dentro do td, se não tiver ta no próprio td
                function TogSeta(e,asc){
                    AllI(_table(e)).forEach(i=>{DTV(i);i.textContent='▼'})
                    const Atual = SibQSl(e,'i') ; ATV(Atual) ; Atual.textContent = asc?'▼':'▲'
                }
                const table = _table(e)
                const cOl = $('p',_th(e))
                const tbody = $('tbody',table)
                const asc = order ? order === 'asc' : table.dataset.sortOrder !== "asc"
                const Get=e=> Cntd ? $(Cntd,e.children[x]) : e.children[x]
                const caracteres = true

                const Ordn = [...tbody.rows].sort((a,b)=>{
                    if(caracteres){
                        const lenA = (VAL(Get(a)) || '').length
                        const lenB = (VAL(Get(b)) || '').length
                        return asc ? lenA - lenB : lenB - lenA
                    }
                    if(cOl=='Data'){
                        // 📅 Se ambos forem datas válidas (ex: "2024-12-03")
                            const dateA = new Date(VAL(Get(a)).trim() || '2000-01-01')
                            const dateB = new Date(VAL(Get(b)).trim() || '2000-01-01')           
                            if(!isNaN(dateA) && !isNaN(dateB)){return asc ? dateA-dateB : dateB-dateA}
                    }
                    // Ordena se for Numeros
                        const valA = parseFloat(Txt(Get(a)).replace('R$',''))
                        const valB = parseFloat(Txt(Get(b)).replace('R$',''))
                        if(!isNaN(valA) && !isNaN(valB)){return asc ? valA-valB : valB-valA}
                        
                    // Ordena como texto se não forem números
                        const txtA = `${VAL(Get(a))}`.replace('R$','')
                        const txtB = `${VAL(Get(b))}`.replace('R$','')
                        return asc ? txtA.localeCompare(txtB) : txtB.localeCompare(txtA)
                })

                table.dataset.sortOrder = asc ? "asc" : "desc"
                Ordn.forEach(r=>tbody.appendChild(r))
                TogSeta(e,asc)

                // Opção de Ordenar pelo q tem mais caractére (textos maiores em cima textos menores em baixo)
                // orden n pega em Selcts e parece q tbm n ta pegando Numero!
                // Opção de mais de 1 Designer   
            }

            function IMGENS(){ // função q filtra linhas se existir imagem (e também opção de fazer o inverso!)
                $$(`#H_PDDS > tbody > tr`).forEach(tr=>{ //TRs(Typ)
                    const TD=(stg)=>$(`:scope > ${Col('PDDS',stg)}`,tr)
                    const ArryImg = $$(':scope > div > img',TD('Serv'))
                    const tem1 = ArryImg.some(e=>isImageLoaded(e))
                    if(tem1){Rmv_N(tr )}else{Add_N(tr)}
                })
            }
        </script>
    </div>

    <script> // RECOLOR  - ⭐⭐_ _ _
        const NoVazi=v=>v!=='' && v!==false && v!==undefined // isso pode virar Biblioteca
        const MinMax=(Atual,Lista)=>Math.min(Math.max(Atual/Lista,0),1) // Entre 0 e 1 
        const OB = { // Criterio 1 é Obrigaório
            SERV:['Serv','Tipo','Dsng','Forn','OK','Entg','Detg','Grad']
        }
        const OC = { // mas tbm terá outro critério de Comparação
            SERV:['Forn==Grad']
        }

        // Degrader de 2 cores formato de Matiz, do vermelho ao Verde
        const R_Cor=(e,opacy,Cor)=>{
            e.style.background   = `rgba(${Cor},${(opacy).toFixed(2)})`             // Colore o Fundo
            e.style.color        = `rgb(${Cor.split(',').map(e=>e/2).join(',')})`   // Colore o Fundo
            e.style.borderBottom = `1px solid rgba(${Cor},${(opacy).toFixed(2)})`   // Colore a Borda
            $$('select',e).forEach(E=>E.style.background = '#00000000')
        }

        function Re_colrAll(Typ){                // ✔️ Muda a cor de Todas 
            TRs(Typ).forEach(tr=>{R_Color(tr,Typ)})
            // Depois fazer Apenas para as Visiveis
            // Também seria bom Limpar tudo antes de Recolorir
        } 

        function R_Color(tr,Typ){ // Muda a cor apenas de 1 linha tr
            if(Typ==='SERV'){
                const Arr    = $$(':scope > td',tr).map(td=>VAL(td)||'')
                const newobj = zipObj(OjKy(Typ),Arr)
                const Atual  = OB[Typ].filter(k=>NoVazi(newobj[k]))
                const opacy  = MinMax(Atual.length,OB[Typ].length)
                const Coclui = Atual.length === OB[Typ].length
                const Cor    = $(`#${Typ}_Color`).value
                const [Atv1,Atv2] = [$(`#${Typ}_tdCor`).checked,$(`#${Typ}_trCor`).checked]
                //Opção de Permitir isso ou não (pq fica parecendo um Xadrez)
                Atual.map(e=>$(Rx2([Typ,e]),tr)).forEach(td=>{
                    td.style.background = ''                      // Zera Fundo
                    td.style.border = ''                          // Zera Brorder
                    if(Atv1){R_Cor(td,opacy/2,hexToRGB2(Cor))}
                    if(Coclui){R_Cor(td,opacy,hexToRGB2(Cor))}
                })
                    tr.style.background = ''                      // Zera Fundo
                    $$('td',tr).forEach(e=>e.style.border = '')   // Zera Borda
                    if(Atv2){R_Cor(tr,opacy/2,hexToRGB2(Cor))}
                    if(Coclui){R_Cor(tr,opacy,hexToRGB2(Cor))}
            }
            // Poder escolher a Cor do RGB por alguns critérios, q seria usar a cor do Random
            // ou usar uma cor predefinida q seria (Stock: Azul e Grads Verde) (Permitir poder escolher isso Livremente)
        }

        function RecolorBasico(tr){
            if(tr){
                const cor = {
                    'Orçamento'  :'#ffffff'
                    ,'Arte'      :'#b4a7d6'
                    ,'Impressão' :'#ffe599'
                    ,'Acabamento':'#ffe599'
                    ,'Pronto'    :'#a4c2f4'
                    ,'Entregue'  :'#93c47d'
                    ,'Devendo'   :'#ea9999'
                    ,'Concluído' :'#93c47d'
                }
                const td = $(Rx2(['Rastr-PDDS','Stts']),tr)
                $('select',td).addEventListener('change',function(){RecolorBasico(_tr(this))})
                const Val = VAL(td)
                tr.style.background = cor[Val]
            }
        }
    </script>
    
    <script> // AUTOCOMP - ⭐⭐_ _ _
        function RfreshJson(Typ){const IN = performance.now()

            // Virar Biblioteca
                const Dbbrev = {T:'Tatiane',G:'Grafit',B:'BPrint',I:'Inová'}    
                const Includ=(e,arr)=>arr.some(v=>e.includes(v)) // como usar Includ(e,['BPrint','Grafit'])

            const arrayss = {
                GRAD:['Id'  ,'Data','Forn','Grad','Cont'],
                SERV:['Forn','Abcd','OS','Gimg'],
                ABCD:['Valr']
            }
            const SplitNome=e=>(e.match(/(\d+,\d+)\s*x\s*(\d+,\d+)/) || []).slice(1)
            const LocIten=(Serv,Tipo)=>Prod[Serv]?.Variantes[Tipo]?.Grad || ""
            const extrairNomeSigla = e => (e.match(/-\s*([^\s]+\([^)]+\))/) || [])[1] || "";


            const Func = {
                 G_Id  :e=>(e.Emal.match(/(\d{3})°\s+(\w)/)||[]).slice(1,3).reverse().map((v,i)=>i?v:v.toUpperCase()).join('_')
                ,G_Data:e=>YMD(`${e.Emal.match(/(\d{2})(\d{2})$/)?.slice(1).join('/')||""}/${LocAno(e.Emal)}`)
                ,G_Forn:e=>e.Emal.match(/\d+°\s*(.*?)\s*-\s*\d+/)?.[1] || ""
                ,G_Grad:e=>`${e.Emal}.webp`
                ,G_Cont:e=>`${e.ABCD.length}`
                ,GA_Valr:a=>{const [v1,v2]=SplitNome(a.Nome) ; return v1&&v2 ? Num(v1)*Num(v2)*20 : 0 } // Melhorar pra (Banner, Adesivo, Transp)
                ,S_Forn:e=>{
                    const buxu = Prod[e.Serv]?.Forn ?? []
                    return e.Grad ? Dbbrev[e.Grad.split('_')[0]]||'' : buxu.length == 1 ?  buxu[0] : '' }
                ,S_Abcd:e=>{
                    if(!e.Grad){return ''} // se n tem dados return Vazio
                    else{ // também conferir o valor que já tem antes!
                        const ItenSERV = LocIten(e.Serv,e.Tipo)
                        const LinGrad = J.GRAD?.find(x=>x.Id==e.Grad)?.ABCD||'' // Consulta
                        if(isArr(LinGrad)){
                            const Linfilt = LinGrad.filter(G=>G.Nome!=="")
                                const Filtrado = Linfilt.filter(G=>ItenSERV == extrairNomeSigla(G.Nome))
                                if(Linfilt.length==1){return 'A'}
                                if(Linfilt.length==0){return 'Falta Nome'}
                                else if(Filtrado.length==1){return Filtrado[0].Id}
                                else{ return `${Linfilt.length}...`}
                                return ItenSERV
                        //    }
                        }else{return 'sem ID'}

                    } // Levar a Imagem da Grad pra dentro da Tabela de SERV
                }             
                ,S_OS  :e=>J.GRAD?.find(x=>x.Id==e.Grad)?.OS||'' // Consulta
                ,S_Gimg:e=>`${J.GRAD?.find(x=>x.Id==e.Grad)?.Emal||''}.webp`
            }

            function Exec2(e,c,tr,Tag){ // 'c' de Col // neste exec2 os dados são editados lá na const principal J[typ]
                const A = e[c] ; e[c] = Func[`${Tag}_${c}`](e)
                const Cor = A==""&&e[c]!==''?["Blu",'']:A==e[c]?['Grn','']:['Red',A]
                if(A=="" && e[c]==""){return}
                DarVAL($(Rx2([c]),tr),e[c],Cor)
            }

            function Exec(e,c,tr,Tag){ // 'c' de Col
                const A = e[c] ; const v = Func[`${Tag}_${c}`](e)
                const Cor = A==""&&v!==''?["Blu",'']:A==v?['Grn','']:['Red',A]
                if(A=="" && v==""){return}
                DarVAL($(Rx2([c]),tr),v,Cor)
            }

            // Separar a função que chama o Exec ajuda a reutilizar em várias tabelas e camadas
            // O Pre-AutoComplete é necessário para autocompletar tabelas que consultam outras (Mas antes, é preciso garantir que ele armazene o valor anterior)

            if(Typ=='GRAD'){
                TRs(Typ).forEach(tr=>{ // Camada1
                    const e = J[Typ][tr_X(tr)] // Encontrar pelo Idx
                        arrayss[Typ].forEach(c=>Exec(e,c,tr,Typ[0]))
                        $$('.Bdj_ABCD > tbody > tr',tr).forEach(tr2=>{ // Camada2
                            const a = e['ABCD'][tr_X(tr2)] // Encontrar pelo Idx
                            arrayss['ABCD'].forEach(c=>Exec(a,c,tr2,'GA'))
                    })
                })
                Re_color(Typ)
            }

            if(Typ=='SERV'){
                TRs(Typ).forEach(tr=>{
                    const e = J[Typ][tr_X(tr)] // Encontrar pelo Idx
                        arrayss[Typ].forEach(c=>Exec(e,c,tr,Typ[0]))
                        // Camada 2
                            // camada 2
                            // camada 1
                })

                $$(Rx(['SERV','Serv','Slct'])).forEach(e=>{ // seleção automática do forn baseada no serv select
                    if(Pai(_tr(e)).tagName=='TFOOT'){return} ; if(VAL(e)==''){return} // se for Tfoot ou tiver vazio n faz nada
                    // Ação para o Forn
                        const Forn = $(Rx(['Forn','Slct']),_tr(e))
                        if(AllForn[VAL(e)].length==1){$('select',Forn).value = AllForn[VAL(e)][0]} // mudar pra o Unico q tem, se tiver
                        $$('option',Forn).forEach(o=>{Add_N(o);if(AllForn[VAL(e)].includes(o.value)){Rmv_N(o)}}) // Ocultar os Options
                    // Ação para o Tipo
                        const Tipo = $(Rx(['Tipo','Slct']),_tr(e))
                        if(Vari(VAL(e)).length==1){$('select',Forn).value = Vari(VAL(e))[0]} // mudar pra o Unico q tem, se tiver
                        $$('option',Tipo).forEach(o=>{Add_N(o);if(Vari(VAL(e)).includes(o.value)){Rmv_N(o)}}) // Ocultar os Options
                })
            }           

            // Escolher para Todos ou Apenas 1 unica Linha! (Aplica na Linha ao Editar uma Célula)
            // Escolher a cor livremente por Fora!
            // Se Tiver Entregue Preenche OK Automatico

            // Fazer o Calculo automático da medida
            // Fazer a Soma dos Serv na tabela de Pedido (esse aqui já está dentro do Tm_Tm() mas se pá traz pra cá q é mais certo!) (pois ele tem q ser dinamico e mudar conforme altero valor)
            // se Pagamento é == ao Valor
            // atualiza o Finc pra Mostrar o Lucro
            // Atualiza o Status completo da Linha
            // Depois q terminar fazer isso atualizar a Const (se possível)
            // Cor e Intensidade de Serv (Forn, OK, Entregue, DataEntreg,  Grad, OS, Uber) de 0 á 7   |   no data-set a cor vai ser um concat de cor com Opacidade 'Blue-7'
            
            const FIM = performance.now() ; console.log(`⏱️ Autocompletation(): ${(FIM-IN).toFixed(2)}ms`)
        }
    
        function AutoClntPDDS(){
            $$(`#H_CLNT > tbody > tr`).forEach(tr=>{
                const ID = VAL($(Rx2(['CLNT','Id']),tr))
                const PddsLink = J['PDDS'].filter(e=>e.Clnt==ID).map(e=>e.Id).join(',')
                const Cell = $(Rx2(['CLNT','Link']),tr)
                Cell.innerHTML = PddsLink
                _td(Cell).onclick = _td(Cell).onclick = function(event){if(event.ctrlKey){Tog(this,'LinkULT')}else{Tog(this,'LinkAtv')}}
                if(PddsLink!==''){$(Rx2(['CLNT','Lixo']),tr).innerHTML = ""} // se tiver pedidos Atrelados Oculta Lixeira
            })
        }
    
        function EdicoesAgregadas(){ // seria basicamente ao editar uma célula
         // conferir se outras células da mesma linha também não precisam de edição
         // ou até da Linha Pai com (Valr em PDDS e Stts em Pedidos)
         // todos 2 devem ser modificados automáticamente conforme eu manipulo os dados dentro de 'Serv'
        }
    
    </script>

    <script> // REALTIME - ⭐⭐_ _ _
        function Load_ThFilt(Eu,Typ,Col){ // Acho q serve pra evitar q carregue novamente // Da um jeito de Remover daqui e Fundir dentro da Propria função
            if(BS[Typ][Col][1]==true){return} ; BS[Typ][Col][1]=true // ; console.log(BS[Typ])
            Tm_Filt(Eu,Typ,Col)
        }

        function SOMAPgmt(Arr){
            const Tm_PixAv=(Pix,Av)=>`<div class="Ct Ev"><div class="Ct">${Tm_RS(SOMA(Pix))}Pix</div> <div class="Ct">${Tm_RS(SOMA(Av))}Av</div></div>`
            let ArrPix = [] ; let ArrAv = []
            Arr.forEach(e=>{Inn(e).split('|').forEach(I=>{if(I===''){return}
                    if      (RgxPixAV(I)[2]==='Pix'){ArrPix.push(Num(RgxPixAV(I)[1]))}
                    else if (RgxPixAV(I)[2]==='Av' ){ ArrAv.push(Num(RgxPixAV(I)[1]))} }) })
            return Tm_PixAv(ArrPix,ArrAv)
        }

        function Rfresh_Foot(typ){  // Deixei ASYNC
            if(typ=='CLNT'||typ=='MPAG'||typ=='UBER'||typ=='OOSS'||typ=='GRAD'){return} // sair por q ainda n tem tfoot
            setTimeout(() => {
                let IN = performance.now()
                const IIN = performance.now()
                // Tentar usar esses Obj em Filter também pra carregar apenas 1 Vez
                    const IDclass = (p)=>{ const tr = $(`tbody > tr`,_td(p)) ; if(tr){return tr_ID(tr)}}
                    const objClnt = Colls(typ,'Clnt',true).map(p=>{const ID=IDclass(p) ; return {nome:Inn(p),Id:ID}})
                    const NovoOBJClnt = objClnt.reduce((acc,e)=>{acc[e.Id] = e.nome ; return acc},{})
                    const objClntID = objClnt.map(e=>e.Id)

                    const objServ = typ=="PDDS" ?
                        Colls(typ,'Serv',true).map(e=>_td(e)).flatMap(f=>$$(Rx2(['Serv','Slct']),f).map(t=>$('select',t).value))
                        : Colls(typ,'Serv',true).map(e=>VAL(e))

                //console.log(`⏱️ Rfresh_Foots:(OBJ): ${(performance.now()-IN).toFixed(2)}ms`) ; IN = performance.now() // manter em quanto Melhora

                IN = performance.now()
                // corrigir as condições para quando não existe deternimado foot no Typ ('ORC' não te nenhum) ('SERV' não tem 'Cust')
                // ai o Plano é o seguinte, fazer um objeto com os q tem e percorrer cada Tfoot da Tabela, se tiver faz a soma, se n tiver retorna "--"
                $(Rx2([typ,'Foot','Id'  ])).innerHTML = `<div onclick="Tog_N($('.BndjFOT',Pai(this)))">${        objClnt.length}         </div>`
                $(Rx2([typ,'Foot','Clnt'])).innerHTML = `<div onclick="Tog_N($('.BndjFOT',Pai(this)))">${Uniq(objClntID).length} Clientes</div> <div class="Abslt none Cl BndjFOT BNdj"><span class="Sugg Cl w100">${ObjEtr(cRepetID(objClnt)).sort((a,b)=>b[1]-a[1]).map(([k,v])=>`<a class="w100 ppt">${k} - ${NovoOBJClnt[k]}: ${v}</a>`).join('')}</span><div class="BjConf Stky2 w100 Ct">${Uniq(objClntID).length} Clientes</div></div>` // o Sort é só pra reordenar
                $(Rx2([typ,'Foot','Serv'])).innerHTML = `<div onclick="Tog_N($('.BndjFOT',Pai(this)))">${        objServ.length} Serviços</div> <div class="Abslt none Cl BndjFOT BNdj"><span class="Sugg Cl w100">${ObjEtr(  cRepet(objServ)).sort((a,b)=>b[1]-a[1]).map(([k,v])=>`<a class="w100 ppt">${k}: ${v}</a>`                    ).join('')}</span><div class="BjConf Stky2 w100 Ct">${        objServ.length} Clientes</div></div>` // o Sort é só pra reordenar
                Array.of($(Rx2([typ,'Foot','Valr']))).forEach(e=>{ LOG('1',e) ; const R=D_R(e) ; e.innerHTML = `<div>Total: R$ ${Cm(SOMA(Colls(R.Typ,R.Col,true),s=>Num(Inn(s))))}</div><div id="Sommma">Soma: 00,00</div>`})
                Array.of($(Rx2([typ,'Foot','Pgmt']))).forEach(e=>{ LOG('2',e) ; const R=D_R(e) ; e.innerHTML = `${              SOMAPgmt(Colls(R.Typ,R.Col,true))}`})
                Array.of($(Rx2([typ,'Foot','Cust']))).forEach(e=>{ LOG('3',e) ; const R=D_R(e) ; e.innerHTML = `Custo: R$ ${     Cm(SOMA(Colls(R.Typ,R.Col,true),s=>Num(Inn(s))))}`})

                //console.log(`⏱️ Rfresh_Foots:(ATRIBUI): ${(performance.now()-IN ).toFixed(2)}ms`) // manter em quanto Melhora
                console.log(`⏱️ Rfresh_Foots:(FINAL):   ${(performance.now()-IIN).toFixed(2)}ms`)
            },0)
        }

        function MudarFormatBndj1(Typ){
            const Div = $$(`${Rx(['ABCD','Bndj'])} .BndjTBL` )
            const Btn = $$(`${Rx(['ABCD','Bndj'])} .BtnMini`)
            const p   = $$(`${Rx(['ABCD','Bndj'])} > div > .P-P`)

            Div.forEach(e=>{
                e.classList.remove('BndjTBL','BNdj','Abslt','Shdw','rd','Cl','none')
                Add(e,'bnDJ') ; Add_N($('a',e)) ; Add_N($('thead',e))
            })
            Btn.forEach(e=>Add_N(e))
            p.forEach(e=>Add_N(Pai(e)))
        }

        function MudarFormatBndj2(Typ){
            const Div = $$(`${Rx(['ABCD','Bndj'])} .bnDJ` )
            const Btn = $$(`${Rx(['ABCD','Bndj'])} .BtnMini`)
            const p   = $$(`${Rx(['ABCD','Bndj'])} > div > .P-P`)

            Div.forEach(e=>{
                e.classList.add('BndjTBL','BNdj','Abslt','Shdw','rd','Cl','none')
                Rmv(e,'bnDJ') ; Rmv_N($('a',e)) ; Rmv_N($('thead',e))
            })
            Btn.forEach(e=>Rmv_N(e))
            p.forEach(e=>Rmv_N(Pai(e)))
        }

    </script>

    <div>     <!--LINKS  - ⭐⭐_ _ _ -->
        <style> /*CSS apenas no SuggLinks*/
            .Sugg_Atv  {background: #d822ab; color: #ffffff}
        </style>

        <script> // LINK (Voltar a Analizar ela!)
            function LinkSug(Typ,inpt,list,Func){
                if (inpt.value){
                    Show(list)
                    const Val   = inpt.value
                    const regex = new RegExp(`(${aa(Val)})`, 'gi'); // Cria um regex que ignora maiúsculas e minúsculas

                    list.innerHTML = J[Typ]
                    .filter(e=>aa(e[Aa(Typ)]).includes(aa(Val)) || String(e['Id']).includes(Val))
                    .map(e=>{
                        const ID   = String(e['Id']).replace(regex,'<span style="background: #8f007c;color:white">$1</span>') // Destaca no Id
                        const Nome =  aa(e[Aa(Typ)]).replace(regex,'<span style="background: #8f007c;color:white">$1</span>') // Destaca no Nome
                        return `<a class="ppt w100 Ct" onclick="${Func}(this,'${e[Aa(Typ)]}',${e['Id']});None(Pai(this))"><p>${ID}</p><p>${Nome}</p></a>`
                    }).join('')
                }else{None(list);Inn(list,'')}
                // esta é a função q carrega o Link de Clientes
                // desejo Fundir ela com os outros Suggs (pra q os outros também tenha campo de Pesquisa!)
            }

            const Tm_Exib = {
                 Mpag:(e)=> `${e.Id} - ${e.Clnt}, ${e.Valr} ${e.Form}`
                ,Pgmt:(e)=> `${e.Id} - ${FindClnt(e)} - R$ ${e.Valr} (${e.Form}) ${e.Data}`
                ,Serv:(e)=> `${e.Id} - ${SERV_Find_CLNT(e)} ${e.Serv} ${e.Desc}`
                // por enquanto isso aqui tá só uma Lista, mas quero deixar tipo uma tabela...
                // ...pra facilitar a visualização e separação das colunas
                // Trazer o de Clientes pra cá também, 
            }

            function SuggLink(Eu,R){ // será Exibido no Span todas as Linhas de uma determinada Tabela 
                // (deve servir pra achar:
                // Clnt em PDDS | MPag em PGMT | Grad em SERV | OS em GRAD | Uber em GRAD
                const r = D_R(R)
                const col = r.Col

                const Fillt=e=>{
                    return  col=='Serv' ? e.Grad=='' && !['Stock','Arte','-'].includes(e.Forn) :
                            col=='Pgmt' ? e.Mpag=='' && e.Form!='Av' :
                            col=='Grad' ? Dat(e.Data) <= Dat(VAL($(`${Col('UBER','Data')}`,_tr(Eu)))) && VAL($(`${Col('UBER','Prds')}`,_tr(Eu))).split(',').includes(e.Forn) :
                            true
                }

                if(col=='Mpag'){
                    // console.log(Eu,Typ)
                    // console.log(J[Typ.toUpperCase()].filter(e=>Fillt(e)))
                    $('span',Pai(Eu)).innerHTML = J[col.toUpperCase()].filter(e=>Fillt(e)).map(e=>`<div><a onclick="Tog(this,'Sugg_Atv')">${
                        col=='Mpag' ? Tm_Exib[col](e) :``
                    }</a></div>`).join('')
                    // deixar disponivel os que eu Permito selecionar mais de 1
                }
            }

            function Linkar(Eu){
                if(_table(Eu).id == 'H_MPAG'){EditCell(Eu,$$('.Sugg_Atv',Pai(Eu)).map(e=>Inn(e).split('-')[0].trim()))}
                if(_table(Eu).id == 'H_GRAD'){
                    const ArryAntg = Inn($('p',Eu.closest('td'))).split(',')
                    const NovoArry = $$('.Sugg_Atv',Pai(Eu)).map(e=>Inn(e).split('-')[0].trim())
                    if(Inn($('p',Eu.closest('td')))=='-'){
                        EditCell(Eu,NovoArry)
                    }else{EditCell(Eu,[...ArryAntg,...NovoArry])} 
                }else{console.log($('span',Pai(Eu)))}
            }
        </script>
    </div>

    <div>  <!--PREVIEWS  - ⭐_ _ _ _ -->
        <style> /*Preview*/
            .Ubuiaxik{width: 800px; height: 500px}
        </style>
        <script> // Previews

            function Tog_Card(Typ){
                console.log('Asus')
                //Tempo()
            }

            function AbrirImg(img){MdalShow('#FormIMG')
                Inn($('#FormIMG'),`<div class="Ubuiaxik Ct"><img class="h100" src="${img.src}"><span>aquificara fica Os<span><div>`)
            }

            function AbrirSVG(img,Nome){MdalShow('#FormIMG')
                $('#FormIMG').innerHTML = `<div class="Ubuiaxik Ct"><img class="h100" src="${img.src}">
                    <span>Nome: ${Nome}<span>
                    <button onclick="LimparNomeSVG('${_td(img).className.trim()}')">Limpar</button>
                <div>`
            }

            function LimparNomeSVG(Clss){
                const Edit=e=>`<p class="Ct" ${Edi} onfocus="Add(Pai(this),'Foco')" name="${Inn(e)}" onkeydown="EntBlr(this)" onblur="Rmv(Pai(this),'Foco');EditCell(this)">${Inn(e)}</p>`
                const td = $(`td[class="${Clss}"]`)
                EditCell(td,'')
            }
        </script>
    </div>
</div>

<body class="Dark Body1 CSS1 Ct" onclick="NoneBndj()">

    <header class="Bt"> <!--HEADER-->
        <style>
            /*Fixos*/
                header{padding:0px ; z-index:999 ; transition: width ease-in-out 0.2s}
                #PAGES{transition: width ease-in-out 0.2s}
                #Login-Top      , header nav div      {filter:drop-shadow(0px 0px 8px #3a002b)}
                #Login-Top:hover, header nav div:hover{filter:drop-shadow(0px 0px 5px #f030c0)}
            /*Body1*/
                .Body1{justify-content: flex-start}
                .Body1 > header{height:8vh  ; width:100vw ; position:sticky; top:0}
                .Body1 > #PAGES{height:92vh ; width:100vw }
                .Body1 > #PAGES > div{height:100% ; overflow-y:scroll} /*Aqui são as Páginas de Fato*/
                        .Body1 > header #Title      {margin-left:15px}                @media(max-width:500px){.Body1 > header #Title    {margin-left:3px}}
                        .Body1 > header #Title #Logo{margin:5px; height:30px}         
                        .Body1 > header #Title h1   {font-size:3vw}                   @media(max-width:500px){.Body1 > header #Title h1 {display:none}}   
                        .Body1 > header #recolhe    {display:none}
                    .Body1 > header nav     {margin:0px 10px}                         @media(max-width:700px){.Body1 > header nav       {display:none}}
                    .Body1 > header nav img {height:22px; margin:3px 3px}
                    .Body1 > header nav p   {display:none}
                    .Body1 > header nav div {border-radius:5px ; margin: 0px 2px;}
                    .Body1 #NavPerf         {flex-direction:row}
                    .Body1 #Login-Top       {display:none}
            /*Body2*/
                .Body2{justify-content: flex-start}
                .Body2 > header{height:100vh ; width:18% ; display:flex ; flex-direction: column}
                .Body2 > #PAGES{height:100vh ; width:82% ; overflow-y:scroll}
                .Body2.recolhe > header{width:5% }
                .Body2.recolhe > #PAGES{width:95%}
                .Body2.recolhe #Logo   {display: none}
                        .Body2 > header #Title      {width: 90%; justify-content: space-between}
                        .Body2 > header #Title #Logo{margin:5px; height:30px}
                        .Body2 > header #Title h1   {font-size:50% ; display:none}
                        .Body2 > header #recolhe    {height: 18px}
                    .Body2 > header nav     {margin:10px 0px; flex-direction:column; width: 100%}
                    .Body2 > header nav img {height:22px; margin:5px 0px ; margin-right: 9px}                            .Body2.recolhe > header nav img {margin-right: 0px}
                    .Body2 > header nav p   {display:block ; font-size: 14px}                                            .Body2.recolhe > header nav p   {display:none}
                    .Body2 > header nav div {width: 90% ; justify-content: start; margin: 3px 0px ; border-radius: 8px}  .Body2.recolhe > header nav div {justify-content:center}
                    .Body2 > header nav div:hover     {background: #ffffff15}
                    .Body2 > header nav #HNVDv_LIN img{display: none}
                    .Body2 > header nav #HNVDv_LIN    {border-bottom:1px solid #ffffff;opacity: 0.3}
                    .Body2 #NavPerf         {flex-direction:column; width: 90%}
                    .Body2 #Div-Pesq        {display:none}
                    .Body2 #DivNav          {width:90%}
                    .Body2 #BdjLogin        {width: 100% ; justify-content: flex-end; background: #38003fa6}
                    .Body2 #Login-Top       {display: flex; margin-right: 7px; font-size: 14px;}
                    nav > *.Atv             {background: #da00aa}
                    nav > *.Atv:hover       {background: #ff00c8 !important; filter:drop-shadow(0px 0px 5px #f030c0) !important}

            #ALERT{right:0px;bottom:0px;margin:10px;padding:10px;background:#696969; display: none;
                    opacity: 0;transform: translateY(20px);transition: opacity 0.4s ease, transform 0.4s ease}
            #ALERT.show {display: flex;opacity: 1;transform: translateY(0)}

            /*.TBLAA tbody > tr       {background:transparent;transition:background 0.5s ease-out} /*  Saída lenta   */
            /*.TBLAA tbody > tr:hover {background:#8000a0a6;transition:background 0.02s ease-in} /* Entrada rápida */
            
            .TBLAA tbody > tr:hover    {background:#8000a0a6 !important} /* Entrada rápida */
            .TBLAA tbody > tr td:hover {background:#dd56ffea !important} /* Entrada rápida */
        </style>
        <script>
            const OFF =()=> 'OFF'
            const    ArryMais=()=> OFF() ? ['Cnfg','Help','LOff','Term'] : ['Troc','Edit','Cnfg','Help','LOff','Term'] // fazer isso simplesmente só ocultar e mostrar oq tem abaixo do mais
            function ExieMais2(E,Off){Prvn();if(false/*Off*/){MdalShow('#ModalLogin')}else{TogShow('#H_Mais')}}
            function AbreLogin(){MdalShow('#ModalLogin');Inn('#Span-Login','');Foco('#Inpt-Senha')}
        </script>

        <div id="Title" class="Ct"> <!--Titulo-->
            <img id="Logo"  draggable="false" src="./Img/Logo.png" onclick="TrocaBody()">
            <h1 class="noslt ppt" onclick="TrocaBody()">InfinityAPP 7.5</h1>
            <img id="recolhe" src="./SVG/Recolhe.svg" onclick="Recolher()">
            <script>
                function TrocaBody() {
                    if(window.innerWidth>500){TrcTog($('body'),'Body1','Body2')
                    }else{
                        console.log("Tela pequena")
                    }
                }
                function Recolher(){Tog($('body'),'recolhe')}
                function TrocaCSS(nova){$('body').className = [...$('body').classList].filter(c=>!c.includes('CSS')).concat(nova).join(' ')}               
            </script>
        </div>

        <div class="w30"> <!--Pesquisa-->
            <style> /*Input de Pesquisa*/
                #Div-Pesq .H_Pesq{background:#00000018; color:#ffffff;border: 1px solid #ef3aff}
                #Div-Pesq .H_Pesq::placeholder{color: #ffffff;opacity:0.5}
                #Lupa{top:8px; right:6px; width:17px; opacity:0.5}
                #Lupa:hover{opacity:1}
                .Pesq-Aa{top:8px; right:50px ; color:#ffffff} .Pesq-Aa.Atv{color:#00ff0d !important}
                .Pesq-A_{top:8px; right:30px ; color:#ffffff} .Pesq-A_.Atv{color:#00ff0d !important}
                .Pesq-Bj{top:8px; right:70px ; color:#ffffff} .Pesq-Bj.Atv{color:#00ff0d !important}
                @media(max-width:500px){#Div-Pesq{width:50%}}
            </style>
            <div id="Div-Pesq" class="Rltv w100 hov"></div><!--Pesquisa-->
            <script>
                function Load_Pesq(Typ){
                    return `<div class="pPesq Pesq_${Typ}" class="none">
                        <input class="w100 H_Pesq" placeholder="Pesquisar em ${N_Brev[Typ]}..." oninput="Pesq(this,'${Typ}')">
                        <a class="Abslt HOV Pesq-Aa" onclick="TOV(this);Pesq($('input',Pai(this)),'${Typ}')">Aa</a>
                        <a class="Abslt HOV Pesq-A_" onclick="TOV(this);Pesq($('input',Pai(this)),'${Typ}')">A]</a>
                        <a class="Abslt HOV Pesq-Bj" onclick="TOV(this);Pesq($('input',Pai(this)),'${Typ}')">Bj</a>
                        <img id="Lupa" class="Abslt HOV" src="./SVG/Icon_Lupa.svg">
                    </div>`
                }
                Inn('#Div-Pesq',NavImg.map(Typ=>Load_Pesq(Typ)).join(''))
            </script>
        </div>

        <div id="DivNav"> <!--Nav-->
            <nav id="H_Nav" class="Ct"></nav>
            <script>
                function NAVPAG(Typ,Eu){ // Tudo que Acontece ao Navegar entre as Páginas
                    NavPag(`#Pag_${Typ}`,Eu)                                  // Trocar a Página
                    Atual['Pag']=`#Pag_${Typ}`                                // Dizer quem é a Página Atual
                    Rmv($$('.Atv',Pai(Eu)),'Atv') ; Add(Eu,'Atv')             // Acho q isso deve ser só pra os Icones
                    NavPesq(`.Pesq_${Typ}`)                                   // Trocar a Pesquisa
                    setTimeout(()=>loadtmtable(Typ),0)                        // 100% Assíncrono
                }
                Inn('#H_Nav',NavImg.map(e=>`<div id="HNVDv_${e}" class="Ct ppt HOV" onclick="NAVPAG('${e}',this)"><img draggable="false" src="./SVG/${e}.svg"><p>${N_Brev[e]}</p></div>`).join(''))
            </script>
        </div>  

        <div id="BdjLogin" class="Ct"> <!--Perfil-->
            <style>#Img-Perfil,#IMG-PerfiL{width:42px; height:42px; margin:4px 4px; top:3px}</style>
            <div id="Login-Top"  class="Ct LgTp2 none"  onclick="AbreLogin()"> Login </div>
            <div class="Rltv">
                <img id="LoginVazio" draggable="false" src="./Img/FundoLogo.png" class="ppt NObj" height="56px" top="0px"  onclick="AbreLogin()">
                <img id="IMG-PerfiL" draggable="false" src="./Img/LogOff.png"    class="Abslt NObj none"           onclick="AbreLogin()" oncontextmenu="ExieMais2($('#MAIS'),true)">
                <img id="Img-Perfil" draggable="false"                           class="ImgPerfil Abslt NObj none" onclick="ExieMais2($('#MAIS'),true)">
            </div>

            <style>
                .Body1 #H_Mais{top:55px; right:0px}
                .Body2 #H_Mais{bottom: 0%; left:170px}
                #MAIS{background:#4e4e4e; width:250px ; color:white}
                #MAIS div{padding:10px;cursor:pointer;font-size:15px; width:100%}
                #MAIS div:not(:last-child):hover{background:gray;color:var(--Txt-Wit-Hover)}
                #MAIS div:last-child{padding:10px}
                #MAIS img{height:25px;margin-right:10px}
                #MAIS p,#MAIS p a{font-size:10px}
            </style>

            <div id="H_Mais" class="Abslt none bndj">
                <div id="MAIS" class="Ct Pose">
                    <div class="Start" onclick="AbreLogin()">               <img draggable="false" src="./SVG/Mais_Troc.svg"><a> Trocar de Conta  </a></div>
                    <div class="Start" onclick="MdalShow('#EditarPerfil')"> <img draggable="false" src="./SVG/Mais_Edit.svg"><a> Editar Perfil    </a></div>
                    <div class="Start" onclick="MdalShow('#ConfigPag')">    <img draggable="false" src="./SVG/Mais_Cnfg.svg"><a> Configurações    </a></div>
                    <div class="Start" onclick="MdalShow('#PagSUPORTE')">   <img draggable="false" src="./SVG/Mais_Help.svg"><a> Central de Ajuda </a></div>
                    <div class="Start" onclick="LogOff()">                  <img draggable="false" src="./SVG/Mais_LOff.svg"><a> Sair             </a></div>
                    <div><p>Confira os <a class="Link">Termos de Serviço</a> e as <a class="Link">Política de Privacidade</a></p></div>
                </div>
            </div>
        </div>
        
        <div id="ALERT" class="Fixed rd none">
            <div class="Ct"><img draggable="false" src="./SVG/Plan.png" height="30px"><p style="margin-left: 5px;">Salvo com Sucesso</p></div>
            <span class="w100 Ct" style="height: 30px"></span>
        </div>
    </header>

    <div id="PAGES">

        <div id="Pag_HOME">
            <div class="Cl"></div><!--NÃO TEM NADA AQUI-->
                        <div><!--Arte-->
                <style>
                    .container {
                        max-width: 300px;
                        margin: auto;
                        padding: 20px;
                        border: 1px solid #ccc;
                        border-radius: 10px;
                        box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
                    }
                    .tootal, .tootal span {
                        font-size: 18px;
                        font-weight: bold;
                        color: #00df00;
                    }
                    .Pcntalmt{
                        margin-top: 15px;
                        color: gray;
                    }
                </style>

                <div class="container" style="margin-bottom: 150px;margin-top: 50px;">
                    <h3>Orçamento de Arte:</h3>

                    <select id="designOptions" onchange="EscolheARTE()" class="w100">
                        <option value="20" data-extra="0">Post Digital - R$ 20,00</option>
                        <option value="20" data-extra="4">Carrossel - R$ 20,00 (+R$ 4,00 por unidade)</option>
                        <option value="25" data-extra="0">Banner Digital - R$ 25,00</option>
                        <option value="25" data-extra="0">Cartão de Visita - R$ 25,00</option>
                        <option value="50" data-extra="0">Flyer - R$ 50,00</option>
                        <option value="30" data-extra="0">Panfleto - R$ 30,00</option>
                        <option value="20" data-extra="0">Wing Banner - R$ 20,00</option>
                        <option value="50" data-extra="10">Cardápio - R$ 50,00 (+R$ 10,00 por página)</option>
                        <option value="25" data-extra="3">Backdrop Simples - R$ 25,00 (+R$ 3,00 por patrocinador)</option>
                        <option value="100" data-extra="0">Logo - R$ 100,00</option>
                        <option value="400" data-extra="0">Identidade - R$ 400,00</option>
                        <option value="40" data-extra="0">Manipulação/Tratamento - R$ 40,00</option>
                        <option value="25" data-extra="0">Vetorização - R$ 25,00</option>
                        <option value="5" data-extra="0">Banner Simples Texto - R$ 5,00</option>
                        <option value="30" data-extra="3">Arte para Camisa - R$ 30,00 (+R$ 3,00 por variação)</option>
                    </select>
                    
                    <label for="quantidade">Quantidade:</label><input type="number" id="quantidade" value="1" min="1" oninput="EscolheARTE()">

                    </select>
                    <div id="Bruxos">
                        <label><input type="checkbox" value="20" onchange="EscolheARTE()"> Identidade Visual (20%)</label><br>
                        <label><input type="checkbox" value="15" onchange="EscolheARTE()"> Roteirizar (15%)</label><br>
                        <label><input type="checkbox" value="25" onchange="EscolheARTE()"> Criar Logomarca (25%)</label><br>
                        <label><input type="checkbox" value="8"  onchange="EscolheARTE()"> Digitação (8%)</label><br>
                        <label><input type="checkbox" value="7"  onchange="EscolheARTE()"> Escolha de Imagens (7%)</label><br>
                        <label><input type="checkbox" value="5"  onchange="EscolheARTE()"> Montagem (5%)</label><br>
                    </div>

                    <div class="Pcntalmt"></div>
                    <div class="tootal">Total: R$ <span id="total">0.00</span></div>
                </div>

                <script>
                    function EscolheARTE(){
                        const Slt = $("#designOptions")
                        const Qnt = $("#quantidade").value
                        const Val = parseFloat(Slt.value)
                        const Ext = parseFloat(Slt.options[Slt.selectedIndex].getAttribute("data-extra")) || 0
                        let Porcent = 0
                        $$('#Bruxos input[type="checkbox"]:checked').forEach(e=>{console.log(e) ; Porcent += parseFloat(e.value)})
                        const Pcnt = Porcent.toFixed(2)/100
                        const Total = Val+(Ext*(Qnt-1))
                        const Total2 = Total+(Total*Pcnt)

                        $(".Pcntalmt").innerHTML = `Porcentagem: R$ ${parseFloat(Pcnt)*100}%`
                        $(".tootal").innerHTML = `R$ ${Total2.toFixed(2).replace('.', ',')}`
                    }

                </script>
            </div>
        </div>

        <div id="Pag_PDDS" class="TBLAA none Cl">
            <div class="DivConf Ct Bt Stky">
                <button onclick="AddROW('PDDS')">+ Novo Pedido</button>
                <button onclick="RfreshJson('PDDS')">Recolor</button>
                <h1>Tabela de Pedidos</h1>
                <div id="PagPesq_PDDS" class="Rltv PagPEsq" onload="Inn(this,Load_Pesq('PDDS'))"></div>
                <button onclick="IMGENS()">FiltSoIMG</button>
                <button onclick="TrcTog($('#H_PDDS'),'Tbla','Card');Tog_Card('PDDS')">CARD</button>
                <button onclick="F_Clen('PDDS')">Limpar Filtro</button>
            </div>
            <style>#H_PDDS > tbody > tr > td:nth-child(1){width:0%;color:#4b4b4b}</style>
            <table id="H_PDDS" class="hMin Tbla">
                <thead class="Stky" style="z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.PDDS),'PDDS'))"></tr></thead>
                <tbody></tbody>
                <tfoot class="Stky2"><tr onload="Inn(this,Tm_tdFoot(ExtObj(BS.PDDS)[2],'PDDS'))"></tr></tfoot>
            </table>
        </div>

        <div id="Pag_SERV" class="TBLAA none Cl">
            <div class="DivConf Ct Bt Stky">
                <button onclick="RfreshJson('SERV')">Rfresh </button>

                <div onchange="Re_colrAll('SERV')">
                    <input id="SERV_Color" type="color">
                    <input id="SERV_tdCor" type="checkbox">
                    <input id="SERV_trCor" type="checkbox">
                </div>

                <button onclick="AddROW('SERV')">Nova Linha +</button>
                
                <div><!--Exibir cor coluna automaica-->
                    <input type="checkbox" checked onchange="Tog($$('#H_SERV .AutoComp'),'Cor')"><label>Auto</label>
                </div>
                <h1>Tabela de Serviço</h1>
                <div id="PagPesq_SERV" class="Rltv PagPEsq" onload="Inn(this,Load_Pesq('SERV'))"></div>
                <div id="COnf_SERV" class="Configs Ct"></div><script>Inn($('#COnf_SERV'),Tm_Config('SERV'))</script>
                <button onclick="F_Clen('SERV')">Limpar Filtro</button>
            </div>
            <table id="H_SERV" class="hMin">
                <thead class="Stky" style="z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.SERV),'SERV'))"></tr></thead>
                <tbody></tbody>
                <tfoot class="Stky2"><tr onload="Inn(this,Tm_tdFoot(ExtObj(BS.SERV)[2],'SERV'))"></tr></tfoot>
            </table>
        </div>

        <div id="Pag_PGMT" class="TBLAA none Cl">
            <div class="DivConf Ct Bt Stky">
                <button onclick="AddROW('PGMT')">Nova Linha +</button>
                <h1>Tabela de Pagamentos</h1>
                <div id="PagPesq_PGMT" class="Rltv PagPEsq" onload="Inn(this,Load_Pesq('PGMT'))"></div>
                <div id="COnf_PGMT" class="Configs Ct"></div><script>Inn($('#COnf_PGMT'),Tm_Config('PGMT'))</script>
                <button onclick="F_Clen('PGMT')">Limpar Filtro</button>
            </div>
            <table id="H_PGMT" class="hMin">
                <thead class="Stky" style="z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.PGMT),'PGMT'))"></tr></thead>
                <tbody></tbody>
                <tfoot class="Stky2"><tr onload="Inn(this,Tm_tdFoot(ExtObj(BS.PGMT)[2],'PGMT'))"></tr></tfoot>
            </table>

            <div class="Ct Bt">
                <button onclick="AddROW('MPAG')">Nova Linha +</button>
                <div id="COnf_MPAG" class="Configs Ct"></div><script>Inn($('#COnf_MPAG'),Tm_Config('MPAG'))</script>
                <button onclick="F_Clen('MPAG')">Limpar Filtro</button>
            </div>
            <table id="H_MPAG" class="w100 hMax">
                <thead class="Stky" style="z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.MPAG),'MPAG'))"></tr></thead>
                <tbody></tbody>
            </table>

        </div>

        <div id="Pag_GRAD" class="TBLAA none Cl">

            <div class="DivConf Ct Bt Stky">
                <button onclick="RfreshJson('GRAD')">Rfresh</button>
                <button onclick="AddROW('GRAD')">Grad +</button>
                <button onclick="AddROW('OOSS')">OS +</button>
                <button onclick="AddROW('UBER')">Uber +</button>
                <div id="COnf_GRAD" class="Configs Ct"></div><script>Inn($('#COnf_GRAD'),Tm_Config('GRAD'))</script>
                <div id="COnf_OOSS" class="Configs Ct"></div><script>Inn($('#COnf_OOSS'),Tm_Config('OOSS'))</script>
                <div id="COnf_UBER" class="Configs Ct"></div><script>Inn($('#COnf_UBER'),Tm_Config('UBER'))</script>
                <button onclick="MudarFormatBndj1('GRAD')">Bndj1</button>
                <button onclick="MudarFormatBndj2('GRAD')">Bndj2</button>
            </div>
            <table id="H_GRAD" class="w100 hMax">
                <thead class="Stky" style="z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.GRAD),'GRAD'))"></tr></thead>
                <tbody></tbody>
                <tfoot class="Stky2"><tr onload="Inn(this,Tm_tdFoot(ExtObj(BS.GRAD)[2],'GRAD'))"></tr></tfoot>
            </table>
            <table id="H_OOSS" class="w100 hMax">
                <thead class="Stky" style="top: 60px;z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.OOSS),'OOSS'))"></tr></thead>
                <tbody></tbody>
                <tfoot class="Stky2"><tr onload="Inn(this,Tm_tdFoot(ExtObj(BS.OOSS)[2],'OOSS'))"></tr></tfoot>
            </table>
            <table id="H_UBER" class="w100 hMax">
                <thead class="Stky" style="z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.UBER),'UBER'))"></tr></thead>
                <tbody></tbody>
                <tfoot class="Stky2"><tr onload="Inn(this,Tm_tdFoot(ExtObj(BS.UBER)[2],'UBER'))"></tr></tfoot>
            </table>
            
        </div>

        <div id="Pag_CLNT" class="TBLAA none Cl">
            <div class="DivConf Ct Bt Stky">
                <button onclick="AddROW('CLNT')">+ Nova Linha</button>
                <h1>Tabela de Pagamentos</h1>
                <button onclick="MesclarContato()">Mesclar</button>
                <div id="PagPesq_CLNT" class="Rltv PagPEsq" onload="Inn(this,Load_Pesq('CLNT'))"></div>
                <button onclick="F_Clen('CLNT')">Limpar Filtro</button>
            </div>
            <table id="H_CLNT" class="hMin">
                <thead class="Stky" style="z-index:510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.CLNT),'CLNT'))"></tr></thead>
                <tbody></tbody>
            </table>
        </div>

        <div id="Pag_LOJA" class=" none Cl">
            <style>
                #Pag_LOJA img {width: 50%;margin: 15px}
            </style>
            <!--
            <img src="./Fotos/001_Camisa.webp">
            <img src="./Fotos/002_Calão.webp">
            <img src="./Fotos/003_WindFlag.webp">
            <img src="./Fotos/004_Cartão.webp">
            <img src="./Fotos/005_Panfleto.webp">
            <img src="./Fotos/005_Panfleto.webp">
            <img src="./Fotos/006_Talão 2.webp"> -->

            <div id="DivListaKits"></div>
            <script>
                $('#DivListaKits')
            </script>

            <input type="file" id="svgInput" accept=".svg">
            <input id="SVGLarg" type="text" placeholder="Largura"><input id="SvgAlt" type="text" placeholder="Altura"><input id="SvgQnt" type="text" placeholder="Qnt">
            <div id="RsultsImgSvg"></div>
            <p id="resultadoSVG"></p>

            <script> // Render SVG

                function contarNos(d) {
                const comandos = d.match(/[a-zA-Z]|-?\d*\.?\d+/g);
                if (!comandos) return 0;

                let totalNos = 0;
                let i = 0;

                while (i < comandos.length) {
                    const cmd = comandos[i++].toUpperCase();

                    switch (cmd) {
                    case 'M':
                    case 'L':
                    case 'T':
                        while (i + 1 < comandos.length && !isNaN(Number(comandos[i])) && !isNaN(Number(comandos[i + 1]))) {
                        totalNos++;
                        i += 2;
                        }
                        break;

                    case 'H':
                    case 'V':
                        while (i < comandos.length && !isNaN(Number(comandos[i]))) {
                        totalNos++;
                        i++;
                        }
                        break;

                    case 'C':
                        while (i + 5 < comandos.length) {
                        totalNos++; // conta só o ponto final
                        i += 6;
                        }
                        break;

                    case 'S':
                    case 'Q':
                        while (i + 3 < comandos.length) {
                        totalNos++;
                        i += 4;
                        }
                        break;

                    case 'A':
                        while (i + 6 < comandos.length) {
                        totalNos++;
                        i += 7;
                        }
                        break;

                    case 'Z':
                        // não conta nó
                        break;

                    default:
                        if (!isNaN(Number(cmd))) {
                        i++;
                        }
                    }
                }

                return totalNos;
                }


                const ContPoly=p=>p?Math.floor(p.trim().split(/[\s,]+/).length/2):0

                $('#svgInput').addEventListener('change',function(event){
                  const file = event.target.files[0]
                  if (!file) {return}

                  const reader = new FileReader()
                  reader.onload = function (e) {
                    const svgText = e.target.result
                    const parser = new DOMParser()
                    const svgDoc = parser.parseFromString(svgText, "image/svg+xml")

                    let totalNosPath = 0 ; let totalNosPoly = 0
                    $$('path'   ,svgDoc).forEach(path=>{totalNosPath += contarNos(path.getAttribute('d'     )||'')}) // Conta <path>
                    $$('polygon',svgDoc).forEach(poly=>{totalNosPoly += ContPoly( poly.getAttribute('points')||'')}) // Conta <polygon>

                    const Qnt = svgText.length
                    const qtdVirgulas = (svgText.match(/,/g) || []).length;
                    const valor = Num($('#SVGLarg').value) * Num($('#SvgAlt').value) * Num($('#SvgQnt').value) * 100
                    const TotalNos = totalNosPath+totalNosPoly
                    const Porcent = (TotalNos/100)*1.7
                    $('#resultadoSVG').textContent = `${TotalNos} Nós, R$ ${Cm(valor+(valor*Porcent))} - Porcent ${valor*Porcent}`
                    $('#RsultsImgSvg').innerHTML = svgText
                  }

                  reader.readAsText(file)
                })
            </script>
        </div>

        <div id="Pag_GBRT" class=" none Ct" style="overflow: hidden">
            <!--
//______________________________________________________________________________________________________________________________________________________________________________________________________
//______________________________________________________________________________________________________________________________________________________________________________________________________
//______________________________________________________________________________________________________________________________________________________________________________________________________
//______________________________________________________________________________________________________________________________________________________________________________________________________
//______________________________________________________________________________________________________________________________________________________________________________________________________
            -->
            <style> /*CSS da Aba de Config*/
                #Config svg {cursor: pointer}
                #Config .fil0{fill: #ff7300; width: 20px; margin: 5px; height: 20px}
                #Config .fil0:hover {transform: scale(1.1)}
                #Config .fil0:active{transform: scale(1.05)}
                #Config .fil1{fill:#ff000000; width: 25px;height: 25px}
                #Config .Cor1{fill: #ff4800}
                #Config .Cor2{fill: purple}

                #DivCnvs{width:75% ; height:100% ; overflow-y:auto ; padding-top: 70px;}
                #Config {width:25% ; height:100% ; overflow-y:auto}
                #Config > div {background:#50505025; border-radius:15px; margin:3px; width:97%; padding:20px}
                #Config input[type="range"]{width:50%}
                #IconsCofng{top:-10px; right:-10px}
                #CropedID{top:5px; right:5px}
                .Close{border-radius:5px; background:#ff3232; padding:1px; width:16px; height:16px; opacity: 0;top: 0; right: 0}
                .Moldura{padding: 2px;border: 1px solid #ff480000}
                .ConfigTxt canvas{margin:3px}
                .ConfigTxt label {margin:2px}
            </style>

            <script> // Const Apenas para GABARITO
                const OBJOBJ=[
                    [{id:'C_PP'  ,W:'1333',H:'1956'},{id:'F_PP'  ,W:'1333',H:'1899'},],
                    [{id:'C_P'   ,W:'1503',H:'2211'},{id:'F_P'   ,W:'1503',H:'2154'},],
                    [{id:'C_M'   ,W:'1559',H:'2353'},{id:'F_M'   ,W:'1559',H:'2296'},],
                    [{id:'C_G'   ,W:'1701',H:'2466'},{id:'F_G'   ,W:'1701',H:'2381'},],
                    [{id:'C_GG'  ,W:'1815',H:'2504'},{id:'F_GG'  ,W:'1815',H:'2468'},],
                    [{id:'C_XG'  ,W:'2041',H:'2565'},{id:'F_XG'  ,W:'2041',H:'2560'},],
                    [{id:'C_XXGG',W:'2239',H:'2749'},{id:'F_XXGG',W:'2239',H:'2743'},],
                ]

                let ObjCanvs = []
                const ObjFundo = {F:'',V:''}
            </script>

            <script>
            // Biblioteca dos GBRT
                const PrcAryObj=(e,Stg)=>e.find(E=>E.tamn===Stg)?.qnt || 'nada'
                function Centlizar(e){e.value = 50}
                const SplitFundo =e=>/costa|c\b/i.test(e)?'C':'F'
            // Funções Pequenas GABARITO
                function Mdal_Area(e){ShowModal($(FMdal),'#Mdal-Area') ;  $(e).value = '' ; Foco(e)}
                function Limpar(){$$('#Lista-001 tbody tr:not(:first-child)').forEach(e=>e.remove()) ; Clen_Alls($('#Lista-001 tbody tr:first-child'))}
                function LimpObj(){ObjCanvs = []}
                function AddRoW(){const newRow = $('#Lista-001 tbody tr:last-child').cloneNode(true) ; Clen_Alls(newRow) ; $('#Lista-001 tbody').appendChild(newRow)}
            // Funções Grandes GABARITO
                function Upload(div,srcList){ // depois mudar de inner pra append pois inner ta subistituindo
                    const btnX = `<div class="Ct Abslt Close Opacy" onclick="Pai(this).remove();Read_Obj_Img()">X</div>`
                    $(div).innerHTML = srcList.map((src,x)=>`<div id="ImgDrop${x}" class="DivImgRsut Ct Rltv">${btnX}<img src="${src}" ondragstart="Drag2()"></div>`).join('')
                    $$(`${div} img`).forEach(img=>{img.onload=()=>{if(img.naturalWidth>img.naturalHeight){Add(img,'Larg')}else{Add(img,'Alt')}}})
                    Read_Obj_Img()
                }  
                async function ColarTudo(inpt){
                    const valor = await navigator.clipboard.readText()
                    if(!valor.match(/\n/g)&& valor.match(/\t/g)){Read_Ipt_Lin(inpt,valor) ; return}
                    if(!valor.match(/\n/g)&&!valor.match(/\t/g)){return}
                    $('#Area').value = valor ; Read_Obj_Area('#Area',inpt)
                }
            </script>

            <script> // Read OBJ area img inpt
                function Read_Obj_Area(Area,inpt){ // Atualiza Objeto Baseado na Area     // Depois tentar para Sincronizar
                    ObjCanvs.splice(IdxDe(Avo(inpt)))
                    $(Area).value.split('\n').map(match=>{
                    const {Nome,Tamn,Qnt} = SplitAvanc(match)
                    ObjCanvs.push({qnt:Qnt, tamn:Tamn, nome:Nome,src:'',Orgn:''})
                    })
                    Read_Ipt_Obj()
                }

                function Read_Obj_Img(imgs){       // Atualiza Objetos Baseado nas Imagens (Fundo e Nomes) // Depois tentar Sincronizar
                    ObjFundo['F'] = $('#DropsF img')?.src || ''
                    ObjFundo['V'] = $('#DropsV img')?.src || ''
                    
                    console.log('OBJ_IMG',ObjFundo)
                    /*
                    if(Imgss.length==0){Imgss.map(e=>{
                            const {Nome,Qnt,Tamn} = SplitAvanc(e.name)
                            ObjCanvs.push({qnt:Qnt,tamn:Tamn,nome:Nome,Orgn:'Imgs',src:e.src})});Read_Ipt_Obj()
                    }
                    */
                }
                
                function Read_Ipt_Obj(){           // Atualiza Inputs Baseado no Objeto
                    None(FMdal)
                    Limpar()
                    ObjCanvs.forEach((i,x)=>{
                        if(x>0){AddRoW()}
                        const lastRow = $('#Lista-001 tbody tr:last-child')
                        $('.qnt',lastRow).value = i.qnt
                        $('.tamn',lastRow).value = i.tamn
                        $('.nome',lastRow).value = i.nome
                        $('.td-Src',lastRow).innerHTML = i.src
                        $('.td-Org',lastRow).innerHTML = i.Orgn
                    })
                }
                
                function Read_Ipt_Lin(inpt,obj){   // Atualiza Inputs Baseado no CntrlV Unico
                    const {Nome,Tamn,Qnt} = SplitAvanc(obj)
                    const RowAtual = $('#Lista-001').rows[IdxDe(Avo(inpt))+1]
                    $('.qnt',RowAtual).value = Qnt
                    $('.tamn',RowAtual).value = Tamn
                    $('.nome',RowAtual).value = Nome
                    $('.td-Src',RowAtual).innerHTML = ''
                    $('.td-Org',RowAtual).innerHTML = ''
                    
                }

                function Read_Obj_Ipt(){           // Atualiza Objeto Baseado no Inputs
                    ObjCanvs = []
                    $$('#Lista-001 tbody tr').map(e=>{
                        const qnt  = $('.qnt',e).value
                        const tamn = $('.tamn',e).value
                        const nome = $('.nome',e).value
                        const src  = $('.td-Src',e).innerHTML
                        const org  = $('.td-Org',e).innerHTML

                        ObjCanvs.push({qnt:Number(qnt),tamn,nome,src,org})

                    //if(qnt&&tamn&&nome){console.log('tem tudo');}else{}
                    })
                    console.log('Objeto Atualizado',ObjCanvs)
                }
            </script>

            <div id="Config" class="Cl"> <!--CONFIGURAÇÕES-->
                <div class="Ct">           <!--NOME DO PEDIDO-->
                    <div><input id="NomeCliente" type="text" placeholder="Nome do Pedido"></div>
                </div>

                <div class="Ct Rltv">      <!--CONFIGURAÇÕES DE TAMANHO-->
                    <div id="CropedID" class="Ct DivCrop Abslt"> <!--Da pra Simplificar isso pra um Unico SVG-->
                        <div onclick="$('#Crop').click()" id="CropSvg" onload="Inn(this,IcoCrop('fil0','Opacy'))"></div>
                        <input id="Crop" type="checkbox" class="none" onchange="Tog('.Croped','Opacy');Read_Canvs()">
                    </div>
      
                    <div class="w100"> <!--Aqui é o Controlador de Posições-->
                        <img src="./Testes/Tudi.jpg" height="150px">                          
                    </div> 
                    
                    <div class="controls">
                        <div class="w100">
                            <div class="Ct"><label>Tamanho</label><input type="range" id="size" min="0" max="150" value="50" oninput="Read_Canvs()"></div>
                            <div class="Ct"><label>Largura</label><input type="range" id="left" min="0" max="150" value="50" oninput="Read_Canvs()"><Button class="btnX" onclick="Centlizar($('#left'));Read_Canvs()">X</Button></div>
                            <div class="Ct"><label>Alturaa</label><input type="range" id="top"  min="0" max="150" value="50" oninput="Read_Canvs()"><Button class="btnY" onclick="Centlizar($('#top' ));Read_Canvs()">Y</Button></div>
                        </div>
                    </div>
                </div>

                <div class="ConfigTxt Ct"> <!--CONFIGURAÇÕES DE TEXTO-->
                    <div class="Ct w100"><label>Sombra:   </label><input class="w30" id="shadowColor"   type="color" value="#000000"> <input class="w30" id="shadowBlur"   type="number" value="10" oninput="Read_Canvs()"></div>
                    <hr class="w100">
                    <div class="Ct w100"><label>Contorno: </label><input class="w20" id="outlineColor"  type="color" value="#FFFFFF"> <input id="outlineWidth" type="range" value="2" min="1" max="10" step="0.2" oninput="Read_Canvs()"></div>
                    <hr class="w100">
                    <div class="Ct w100">
                        <div class="Ct"><label class="ppt" id="TypeColor" onclick="InnTogg(this,'Cor:','Degradê:');Tog($$('.inptcolor1,.inptcolor2'),'none')">Degradê:</label></div>
                        <div class="Ct w30 none inptcolor1">
                            <input id="FontColor" type="color" value="#000000" oninput="Read_Canvs()">
                        </div>
                        <div class="Ct inptcolor2">
                            <canvas id="controlCanvas" class="Rd Moldura ClickCanv FOC" width="70" height="70"></canvas>
                            <input class="Opacy noClk" type="color" id="colorPicker1" style="display: none;">
                            <input class="Opacy noClk" type="color" id="colorPicker2" style="display: none;">
                            <div class="Cl">
                                <div class="ClickCanv" id="alignX" onload="Inn(this,IconAling('fil1'    ,'white','white'))">X</div>
                                <div class="ClickCanv" id="alignY" onload="Inn(this,IconAling('fil1 g90','white','white'))">Y</div>
                            </div>
                        </div>
                    </div>
                    <hr class="w100">
                    <div class="Ct w100"><label>Fonte:</label><select class="w50" id="fontFamily" onchange="CssFont('#fontFamily',this.value);Read_Canvs()"></select><script>load_OptsFnt($('#fontFamily'),KitFonts)</script></div>
                </div>

                <div class="Ct">           <!--ABA DE LISTAS-->
                    <div class="Cl Rltv">
                        <button onclick="Mdal_Area('#Area')">Editar Inputs</button>

                        <div id="IconsCofng" class="Ct Abslt">
                            <div onload="Inn(this,IcoMais('fil0'))" onclick="AddRoW()"          ></div>
                            <div onload="Inn(this,IcoClen('fil0'))" onclick="Limpar();LimpObj()"></div>
                        </div>

                        <table id="Lista-001">
                            <thead><tr><th class="w60">Nome</th><th class="w20">Tamnh</th><th class="w20">Qnt</th></tr></thead>
                            <tbody>
                                <tr>
                                    <td class="w60"><input  class="w90 nome" type="text"   placeholder="Nome" oninput="Rmv(this,'Error')" onchange="Read_Obj_Ipt()" onpaste="ColarTudo(this)" autocomplete="off"></td>
                                    <td class="w20"><select class="w90 tamn" onchange="Read_Obj_Ipt()"></select><script>load_Opts($('#Lista-001 .tamn'),O['Cams'])</script></td>
                                    <td class="w20"><input  class="w90 qnt"  type="number" placeholder="Qnt"  oninput="Rmv(this,'Error')" onchange="Read_Obj_Ipt()" autocomplete="off"></td>
                                    <td><div class="td-Src none"></div></td>
                                    <td><div class="td-Org none"></div></td>
                                </tr>
                            </tbody>
                        </table>


                    </div>
                </div>
            </div>

            <div id="DivCnvs" class="Ct"> <!--ÁREA DE EXIBIÇÃO CANVAS-->
                <style>
                    .DropZone{background:#50505023; padding:10px; border-radius:15px}
                    .DropZone .DivImgRsut{cursor: move; border:1px solid #ffffff2a; padding:2px; width:50px; height:50px}
                    .DropZone img.Larg{width:100%; height:auto}
                    .DropZone img.Alt {width:auto; height:100%}
                    .DivImgRsut:hover .Close{opacity:1}

                    .CanvBox{width: 380px;height: 350px; margin-top: 10px}
                    .CanvBox canvas {background:#505050;margin:5px}
                    .CanvBox canvas{width: 40%}
                    #Rodape{height: 200px}
                </style>
                <div class="w100" onload="Inn(this,IptFile('#DropIMG'))"></div>
                <div class="Ct w100" style="margin-top:30px">
                    <div class="Cl"><label>Drop  </label><div class="DropZone Ct" ondrop="Drop();Read_Obj_Img()" ondragover="Prvn()" id="DropIMG"></div></div>
                    <div class="Cl"><label>Frente</label><div class="DropZone Ct" ondrop="Drop();Read_Obj_Img()" ondragover="Prvn()" id="DropsF"></div></div>
                    <div class="Cl"><label>Costas</label><div class="DropZone Ct" ondrop="Drop();Read_Obj_Img()" ondragover="Prvn()" id="DropsV"></div></div>
                    <div class="Cl"><label>Manga </label><div class="DropZone Ct" ondrop="Drop();Read_Obj_Img()" ondragover="Prvn()" id="DropsM"></div></div>
                    <div class="Cl"><label>Nomes </label><div class="DropZone Ct" ondrop="Drop();Read_Obj_Img()" ondragover="Prvn()" id="DropsN"></div></div>
                </div>                   
                <div id="AllCanvas" class="Ct"></div>
                <canvas id="gradientCanvas" width="400" height="400"></canvas>
                <div id="Rodape" class="w100"></div>
            </div>

            <div id="FinaisCnvs" class="Ct Fx"> <!--CONFIRMAÇÕES FINAIS-->
                <style>
                    #FinaisCnvs{left:45%; top:83vh; background:#1f1824f1; height:100px; width:500px; -webkit-backdrop-filter:blur(5px) ; backdrop-filter:blur(5px); border-radius: 255px}
                    #FinaisCnvs{border: 2px solid #2e2e2e96}
                </style>
                <button onclick="Load_Cnvs('#AllCanvas')">Carregar Canvas</button>
            </div>

            <script>     
                LoadDegade($('#controlCanvas'))   
                const FMdal = $('#FModal')

 
//______________________________________________________________________________________________________________________________________________________________________________________________________
//______________________________________________________________________________________________________________________________________________________________________________________________________
//______________________________________________________________________________________________________________________________________________________________________________________________________
//______________________________________________________________________________________________________________________________________________________________________________________________________
//______________________________________________________________________________________________________________________________________________________________________________________________________
            </script>
        </div>

        <div id="Pag_ORC" class="none Cl">

            <div class="Pesq_ORC PagPEsq" style="display:none">
                <input id="PesqPROD" type="text" oninput="Pesq(this,'ORC')" placeholder="Pesquisar Produto..."> <!--Pesquisa PROD-->
            </div>

            <div id="DivIMGProd" class="Bt w90"> <!--IMAGENS dos PRODUTOS-->
                <style>
                    #Div-Prod              {overflow-x:scroll; flex-wrap:nowrap}
                    #Div-Prod, #Div-Detalhes {transition: width 0.2s ease-in-out ; height:360px ; margin-bottom:30px}
                    #DivIMGProd     #Div-Prod {width: 100%}
                    #DivIMGProd.Atv #Div-Prod {width:  59%}
                    #DivIMGProd     #Div-Detalhes {width:  0% ; background: #00df0000}
                    #DivIMGProd.Atv #Div-Detalhes {width: 39% ; background: #00df0000 ; padding: 8px;}
                    #IconDtlh                     {top: 0px; left: 0px;}
                    #Div-Detalhes h3              {height: 10% ; font-size: 20px;}
                    #DetalheFotinha               {height: 90%}

                    #Div-Prod > div        {margin:9px 4px; display:flex; flex-direction:column}
                    #Div-Prod span         {margin-left:10px; margin-bottom:10px}
                    #Div-Prod span p       {margin:0px; font-size:9px}
                    #Div-Prod span p strong{font-size:9px}
                    #Div-Prod span img     {margin:5px; height:30px; width:30px}
                    #Div-Prod span h3, #Div-Prod span h3 strong{font-size:19px}
                    #Div-Prod .DivVrnts    {margin-top:20px}
                    

                    #Div-Prod .Opts               {top:45px; width:100%; height:30px; left:4px}
                    #Div-Prod .Opts img           {height:23px; width:23px; margin:3px 7px}
                    #Div-Prod .Opts div           {bottom:0; height:30px; width:50%; transition:all 0.1s ease-in-out; color: #000000;}
                        #Div-Prod .Opts div.Pre   {border-radius: 20px 0px 0 0 !important ; background:linear-gradient(to left,#bdb5be,#ffffff)}
                        #Div-Prod .Opts div.Pos   {border-radius: 0px 20px 0 0 !important ; background:linear-gradient(to right, #bdb5be,#ffffff)}
                        #Div-Prod .Opts div:hover {height: 35px ; border-radius: 20px 20px 0 0 !important}
                        #Div-Prod .Opts div.Atv   {z-index: 99 !important; border-radius: 20px 20px 0 0 !important ; box-shadow: -5px 0 10px #3c363f59, 5px 0 10px #3c363f59 ;  background:linear-gradient(to right,#ffffff,#ffffff)} /*background:white;  era pra ter background mas ele ta fazendo Piscar, ai tirei*/ 

                    #Div-Prod .Conteudo{padding-top:10px; z-index:999}
                    #Div-Prod .Conteudo,.offf{height:240px ; width:200px; margin:4px ; padding-bottom:15px; border-radius: 0px 0px 20px 20px ;background:linear-gradient(to top,#b3b3b3,#ffffff); color:#575757;}
                    .offf{ top: 40px; background: #808080d7; color: #ffffff;font-size: 20px;}
                    #Div-Prod .Conteudo .fotO{height:160px; width:150px}
                    .tec2 { z-index: 999; top: 310px; left: 20%; width: 60%;}

                    /*esse Basicalmente é o Modal das Fotinahs q aparece a clicar na foto do Protudo*/
                    #Mdal-Prod     >.FotinhAA{width:500px; height:500px} /*Quando ela ta no Modal   */
                    #DetalheFotinha>.FotinhAA{width:76%  ; height:100% } /*Quando ela ta no Detalhes*/
                    .FotinhAA img            {top:0px; left:0px;}
                    .FotinhAA .Fotnh         {background:#00df00f8; width:18%; height:8%}
                    .FotinhAA .Fotnh2        {background:#00df0000; width:18%; height:8%}
                    .FotinhAA .Fotnh2:hover  {background:#f586ff63; border: 2px solid #ff00b3;}
                </style>
                <div id="Div-Prod" class="Start"></div>
                <script>
                    function ShowVrnts(e){$$('.DivVrnts > div',Avo(e)).forEach((E,x)=>{
                        $$('div',Pai(e)).forEach((B,x,l)=>{Rmv(B,'Atv')
                            if(x < IdxDe(e)){Add(B,'Pre');Rmv(B,'Pos') ; B.style.zIndex = (l.length+x)-IdxDe(e)+10}
                            else{            Add(B,'Pos');Rmv(B,'Pre') ; B.style.zIndex = (l.length-x)+IdxDe(e)+10}})
                        Add(e,'Atv')
                        if(x===IdxDe(e)){Show(E)}else{None(E)}
                    })}

                    function ReOrdenar(){Inn('#Div-Prod',AllProd.map(e=>tmplt_Prod(e)).join(''))} ; ReOrdenar()

                    function tmplt_Prod(e){ //GRANDE
                        const Fora = ListaFora.includes(e)
                        return `<div class="Rltv Start2">
                            <span class="Start"><img src="${Fora?'./SVG/placeholder.svg':`./Prod/IconProd/${e}.svg`}"><div class="Start2"><h3 class="rgx">${e}</h3><p class="rgx">${Prod[e].Desc}</p></div></span>
                            <div class="KeyInn none">...</div>
                                <div class="Ct w100 Opts Abslt">${
                                    Vari(e).map((vv,x,l)=>{
                                        const pose = `left:${(x*(200/l.length))-(x===0?0:15)}px;`
                                        const Larg = `width:${(200/l.length)+15}px;`
                                        const Zidx = `z-index:${(l.length-x)+10};`
                                        return `<div style="${pose+Larg+Zidx}" onclick="ShowVrnts(this)" class="Ct Abslt ppt Pos ${x===0?'Atv':''}"><a class="none rgx">${vv}</a> <img name="${vv}" src="${Fora?'./SVG/placeholder.svg':`./Prod/IconProd/${e}_${vv}.svg`}"></div>`
                                }).join('')}</div>
                            <div class="Ct DivVrnts">
                            ${Vari(e).map((V,x)=>{ const OBJ = Prod[e].Variantes[V]
                                return `<div class="Conteudo Cl ${x===0?'':'none'}">
                                            ${Prod[e].Stts==="Offff"?`<div class="Ct Abslt offf">Indisponível no momento...</div>`:''}
                                            <div class="KeyVariants rgx">${V}</div>
                                            <img class="fotO" src="${Fora?'./SVG/placeholder.svg':`./Prod/${e}_${V}.webp`}" onclick="ExibeFotinha('${e}')">
                                            <div class="Ct w100 ${OBJ.Calc==="QNT" || OBJ.Calc==="OFS"?'none':''}">${''}</div>
                                            <div class="Ct">${RS_HTML(OBJ.Valr)}</div>
                                            <div class="rgx none">${(HotKy[e] || []).map(e => e).join(',')}</div>
                                            <div class="RsutProduto w100 Ev">${/*OBJ.Valr.map((e,idx)=>{return tmplt_VlrTtl(OBJ.Valor[idx],e)}).join('')*/''}</div>
                                            <img class="Abslt tec2 HOV" onclick="AddCarrinho('${e}','${V}')" src="./SVG/Adicionar.svg">
                                </div>`
                            }).join('')}
                            </div>
                        </div>`
                    }

                    function AddCarrinho(Serv,Tipo,Cbmt,Gram,Qntt){ // ta dando erro quando n tem Cbmnt, ou tipo ou outros
                        const  ult = $$('#ORC .OrcAdd').slice(-1)[0]
                        if($('#ORC .OrcServ').value!==""){DispClick(ult)}
                        const SERV = $$('#ORC .OrcServ').slice(-1)[0] ; SERV.value = Serv ; SERVChang(SERV) // Delay(0.2)
                        const TIPO = $$('#ORC .OrcTipo').slice(-1)[0] ; TIPO.value = Tipo ; TIPOChang(TIPO) 
                        const CBMT = $$('#ORC .OrcCbmt').slice(-1)[0] ; CBMT.value = Cbmt ; CBMTChang(TIPO)
                        const GRAM = $$('#ORC .OrcGram').slice(-1)[0] ; GRAM.value = Gram ; GRAMChang(TIPO)
                        const QNTT = $$('#ORC .OrcQntt').slice(-1)[0] ; QNTT.value = Qntt ; QNTTChang(TIPO)
                    }
                    
                    function ExibeFotinha(Serv){
                        const valid = $('#TrocaDetalheE').checked
                        console.log('check: ',valid)
                        const Exib  = valid ? '#Mdal-Prod' : '#DetalheFotinha'
                        if(valid){MdalShow('#Mdal-Prod')}
                        if(Prod[Serv].Prvw !== 'Fotinha'){Inn(Exib,`<div>${Prod[Serv].Prvw}</div>`)}
                        const procTab=(T,V)=>T.Table.flatMap(([l,p,i])=>i.map(s=>[V,l,p,s[0],s[3]]))
                        const Variants = Vari(Serv).flatMap((V,x)=>procTab(Prod[Serv].Variantes[V],V))
                        $(Exib).innerHTML = `<div class="FotinhAA Rltv">
                            <img class="Abslt w100 h100" src="./Fotos/${Serv}.webp">
                            ${Variants.map((e,x)=>`<div class="Abslt Fotnh2 Fotnh_Btn${x}" style="${e[4]||'left:0px;top:0px'}" onclick="AddCarrinho('${Serv}','${e[0]}','${e[1]}','${e[2]}','${e[3]}')"></div>`).join('')}
                        </div>`
                    }

                    function FotinhaMove(){ // serve só pra Mover as Fotinahs
                        const procTab=(T,V)=>T.Table.flatMap(([l,p,i])=>i.map(s=>[V,l,p,s[0],s[1]]))
                        const Variants = Vari(Serv).flatMap((V,x)=>procTab(Prod[Serv].Variantes[V],V))
                        $('#Mdal-Prod').innerHTML = `<div class="Rltv">
                                <img class="Abslt w100 h100" src="./Fotos/${Serv}.webp">
                                ${Variants.map((e,x)=>{
                                    return `<div class="Abslt movel Fotnh Fotnh_Btn${x}">
                                        ${e}
                                        <div class="dimens"></div>
                                        </div>`
                                }).join('') }
                            </div>`
                    }
                    //FotinhaMove('Cardápio') // só pode chamar ela no final, pq tem q esperar o Modal Carregar! mas se pá eu jogue os Modais pra antes do Page

                    function ReloadDetalhes(){
                        None($$('#Div-Detalhes .canvi'))
                        const serv = $('#ORC tr.Atv .OrcServ')?.value || ""
                        console.log('ReloadDetalhes',serv,Prod[serv].Prvw)
                        if(serv==""){// n exibe nada
                        }else if(Prod[serv].Prvw=='CanvMdd'){Show($('#CanvasMedidas'))
                        }else if(Prod[serv].Prvw=='Fotinha'){Show($('#DetalheFotinha'));ExibeFotinha(serv)
                        }else if(Prod[serv].Prvw=='PrevCAM'){
                        }else if(Prod[serv].Prvw=='CnvEcut'){
                        }else if(Prod[serv].Prvw=='MdalArt'){
                        }else if(Prod[serv].Prvw=='Canva3D'){Show($('#NewCanvas'))
                        }
                    }

                    // Inventar o Add Folhas
                    // Adicionar as quantidade mínima
                    // Aumenta 15 pra talões 2 Vias
                    // Criar os Limites de Medidas
                    // Mostrar Valor por UND de Cartões tbm
                    // o Modal agora n precisa se restringir a 500 x 500
                </script>
                
                <div id="Div-Detalhes" class="Rltv">
                    <h3 class="Start" onclick="TOV($('#DivIMGProd'))">Detalhes</h3>
                    <div id="IconDtlh" class="Abslt ppt" onclick="TOV($('#DivIMGProd'))">⭐</div>
                    <div id="DetalheFotinha"   class="canvi Ct"></div>
                    <div id="NewCanvas"        class="canvi Ct Cnvs"></div>
                    <canvas id="CanvasMedidas" class="canvi Cnvs"></canvas>
                    <div id="ResutArea"></div>
                </div>
            </div>
            
            <div id="NovoForm" class="Cl w90 Rltv Rd" style="background:#ffffff0a;padding:10px">

                <div id="CONFIG" class="Abslt" style="right:10px;top:10px"> <!--CONFIGURAÇÕES-->
                    <img draggable="false" src="./SVG/CONFIG.svg" class="NObj" style="width:20px;opacity:0.2" onclick="TogShow($('#CONFIG_Bdj'))">
                    <script>
                        function Hdd_Cblh(Valid){if(Valid){Add($$(`#ORC thead`),'none')}else{Rmv($$(`#ORC thead`),'none')}}
                        function Hdd_Cust(){Tog($$(`[class^="ORC_CUST_"]`),'none')}
                        function Hdd_Crct(){Tog($$(`[class^="ORC_CRCT_"]`),'none')}
                        document.addEventListener("keydown",function(e){if(e.key==="'"){Prvn();Hdd_Cust()}})
                    </script>
                    <style>#CONFIG_Bdj{width: 150px; right: 0px; background: #363636; padding: 10px}</style>
                    <div id="CONFIG_Bdj" class="Abslt none Start2 bndj">
                        <div class="Ct"><input id="Hdd-Cbclh" class="GETConfig" type="checkbox" onchange="Hdd_Cblh(this.checked)" onclick="SaveConfig(this)"><label>Exibir Cabeçalho</label></div>
                        <div class="Ct"><input type="checkbox" onchange="Hdd_Cust()"><label>Exibir Custo</label></div>
                        <div class="Ct"><input type="checkbox" onchange="Hdd_Crct()"><label>Exibir Crescente</label></div>
                        <div class="Ct"><input type="checkbox" id="TrocaDetalheE"><label>Trocar Detalhes</label></div> <!--q siguinfica mudar de Modal para Fixo na tela-->
                    </div>
                </div>

                <script> // Templates e Ações para Tabela de Orçamento
                    // Biblioteca
                        const cla = `[class^="ORC_CUST_"],[class^="ORC_CRCT_"],[class^="ORC_RSUT_"]`
                        const AddTrue=(e,Clss,True)=>$$(cla).forEach(e=>{if(True(e)){Add(e,Clss)}else{Rmv(e,Clss)}})
                        const InNa_RS=(e,val)=>{Inn(e,Tm_RS(val)) ; Nm(e,val)}
                        const ClrSlct=(arry)=>arry.forEach(e=>e.selectedIndex=0) // Deixar Junto com o Clear e Levar pra Biblioteca const Clear = e=>[e].flat().forEach(el=>$(el).value='')
                    // Templates
                        const Tm_ORC_Th=ary=>ary.map(e=>`<th class="${e==''?'':'O_Tx'}">${e==''?'':`<a>${e}</a><p>${D_brev[e]}</p>`}</th>`).join('')
                        const Tm_RmvAll=()=>Inn($('#ORC thead th:nth-child(1 )'),`<div class="ppt HOV O_All" onclick="RmvAll()">❌</div>`)
                        const Tm_ClrAll=()=>Inn($('#ORC thead th:nth-child(10)'),`<div class="ppt HOV O_All" onclick="ClrAll()">🧹</div>`)
                        const Tm_Total=E=>[`CUST_${E} none`,`CRCT_${E} none`,`RSUT_${E}`].map(e=>`<div class="ORC_${e}" name="0">${Tm_RS(0)}</div>`).join('')
                    // Ações
                        function Check_W_Pag(){
                            if(window.innerWidth<=650){$$('#ORC .O_Tx').forEach(th=>Show($('a',th),$('p',th)))}
                            if(window.innerWidth> 650){$$('#ORC .O_Tx').forEach(th=>Show($('p',th),$('a',th)))}
                        }
                        const RecolorVlr=()=>AddTrue($$(cla),'Branc',(e)=>Nm(e)==0)
                        const Zerar=tr=>$$(cla,tr).forEach(e=>InNa_RS(e,0))
                        const AddRow=tr=>{const a = tr.cloneNode(true) ; $$('input',a).forEach(e=>e.value='') ; Zerar(a) ; Insert(Pai(tr)).After(a,tr)}
                    // Clean e Remove
                        const RmvAll=()=>{$$(`#ORC tbody td:nth-child(1 ) > div`).forEach((E,X)=>{if(X==0){return}else{DispClick(E)}}) ; ReloadTotal()}
                        const ClrAll=()=>{$$(`#ORC tbody td:nth-child(10) > div`).forEach(E=>DispClick(E)) ; ReloadTotal()}
                        const ClrRow=tr=>{Clear($$('input',tr)) ; ClrSlct($$('select',tr)) ; Zerar(tr)}
                        const RmvRow=tr=>tr.remove()
                    
                    // Objetivo aqui é remover o Tamanho dessas Strings (Principalmente os Querys)
                </script>
                <style>  /*CSS da Tabela de Orçamento*/
                    #ORC input,#ORC select{width:100% !important ; margin:0}
                    #ORC .RS{font-size:7px}
                    #ORC td{padding: 1px}
                    #ORC th a,#ORC th p{display: flex;align-items: center;justify-content: center;}
                    #ORC .Atv{border: solid 2px #ff008c;}
                    .Branc{color: #ffffff5d !important}
                    .imita{height: 30px !important; background: #ffffff11}
                    .Final a{font-size:20px ; font-family:var(--Medi)}
                    .Final .RS{margin-right:3px}
                    .sOFF{opacity:0.3}
                    [class^="ORC_CUST_"]{color:#ff6565}
                    [class^="ORC_CRCT_"]{color:#65b5ff}
                    [class^="ORC_RSUT_"]{color:#48ff00}
                </style>

                <table id="ORC" class="w90" onkeydown="HandArrow(this,event)">
                    <thead class="none"><tr onload="Inn(this,Tm_ORC_Th(['','','Serv','Tipo','Lrg','Alt','Qnt','Und','SbTt','']));Tm_RmvAll();Tm_ClrAll()"></tr></thead>
                    <tbody>
                        <tr class="TrRow" oninput="ORC_Calc(this);RecolorVlr()" onchange="ValidOpts()">
                            <td width="15px" style="fill:#ff0000"><div class="ppt OrcRmv" onclick="RmvRow(_tr(this));Rload_Tbl('#ORC');ReloadTotal()" onload="Inn(this,SVG.Fexa)"></div></td><!--❌-->
                            <td width="15px" style="fill:#ffa500"><div class="ppt OrcAdd" onclick="AddRow(_tr(this));Rload_Tbl('#ORC');ReloadTotal()" onload="Inn(this,SVG.Mais)"></div></td><!--➕-->
                            <td><select class="OrcServ" onchange="SERVChang(this)" onload="Inn(this,Tm_OptsGraff(['Serviços',...AllProd]))"></select></td>
                            <td><select class="OrcTipo" onchange="TIPOChang(this)" onload="Inn(this,Tm_Opts(['Tipo']))"></select></td>
                            <td width="10%">
                                <select class="OrcCbmt none" onchange="CBMTChang(this)" onload="Inn(this,Tm_Opts(['Acabamento']))"></select>
                                <input class="ORC_INPT_Lrg" placeholder="Largura" oninput="MaskNum(this)">
                            </td>
                            <td width="10%">
                                <select class="OrcGram none" onchange="GRAMChang(this)" onload="Inn(this,Tm_Opts(['Gramatura']))"></select>
                                <input class="ORC_INPT_Alt" placeholder="Altura" oninput="MaskNum(this)">
                            </td>
                            <td width="10%">
                                <select class="OrcQntt none" onchange="QNTTChang(this)" onload="Inn(this,Tm_Opts(['Qnt']))"></select>
                                <input class="ORC_INPT_Qnt" placeholder="Quantidade">
                            </td>
                            <td width="10%"  onload="Inn(this,Tm_Total('Vund' ))" class="imita RD"></td>
                            <td width="10%"  onload="Inn(this,Tm_Total('SbTt' ))" class="imita RD"></td>
                            <td width="15px" style="fill:#ffa500"><div class="ppt OrcClr" onclick="ClrRow(_tr(this));Rload_Tbl('#ORC');ReloadTotal()" onload="Inn(this,SVG.Cler)"></div></td><!--🧹-->
                        </tr>
                    </tbody>
                </table>

                <script> // Funções do Tbody
                    function SERVChang(e){const Lista = ObjKey(Prod[e.value].Variantes);Inn($('.OrcTipo',_tr(e)),Tm_Opts(['Tipo',...Lista])) ; Tog_M2_OFS_UND(e)}
                    function TIPOChang(e){const Lista = Prod[$('.OrcServ',_tr(e)).value].Variantes[$('.OrcTipo',_tr(e)).value].Table;Inn($('.OrcCbmt',_tr(e)),Tm_Opts(['Acabamento',...Uniq(Lista.map(e=>e[0]))]))}
                    function CBMTChang(e){const Lista = Prod[$('.OrcServ',_tr(e)).value].Variantes[$('.OrcTipo',_tr(e)).value].Table;Inn($('.OrcGram',_tr(e)),Tm_Opts(['Acabamento',...Uniq(Lista.map(e=>e[1]))]))}
                    function GRAMChang(e){const Lista = Prod[$('.OrcServ',_tr(e)).value].Variantes[$('.OrcTipo',_tr(e)).value].Table;Inn($('.OrcQntt',_tr(e)),Tm_Opts(['Acabamento',...Uniq(Lista.map(e=>e[2])[0].map(e=>e[0]))]))}
                    function QNTTChang(e){const Lista = Prod[$('.OrcServ',_tr(e)).value].Variantes[$('.OrcTipo',_tr(e)).value].Table;ORC_Calc(_tr(e),Lista)}

                    function ORC_Calc(tr,Lista=null){
                        const TotalCress=(Valr,e)=>Math.round(e*(Valr+Valr*Crecent(e)))

                        const Serv = $('.OrcServ',tr).value
                        const Tipo = $('.OrcTipo',tr).value
                        const Cbmt = $('.OrcCbmt',tr).value
                        const Gram = $('.OrcGram',tr).value
                        const Qntt = $('.OrcQntt',tr).value
                        const Lrg = Num($('.ORC_INPT_Lrg',tr).value)
                        const Alt = Num($('.ORC_INPT_Alt',tr).value)
                        const Qnt = Num($('.ORC_INPT_Qnt',tr).value)

                        const Calc = Prod[Serv].Calc
                        const M2 = Prod[Serv]['Variantes'][Tipo]
                        const QNT = Num(Qntt.replace('.',''))

                        let F_Cust = 0
                        let F_Valr = 0
                        // Só pra OFS
                        if(Calc=='OFS'){
                            const filt   = Lista.filter(e=>e[0]===Cbmt && e[1]===Gram)
                            const filt2  = filt [0][2].filter(e=>e[0]===Qntt)
                            F_Cust = filt2[0][2]
                            F_Valr = filt2[0][1]
                        }

                        const Adicional = Serv=='Trofeu' ? 1*Qnt : 0

                        const oMetro  = Lrg*Alt*Qnt
                        const DESCt   = oMetro <= 5 ? 0 : oMetro >= 15 ? 0.15 : oMetro/100  // Melhorar Progressivo
                        const DescQtn = (oMetro <= 1 ? 0 : (Qnt/100))/2

                        const Cust = M2?.Cust ?? 0
                        const Valr = M2?.Valr ?? 0
                        const CUSTO = Calc=='M2' ? Cust*Lrg*Alt*Qnt                       : F_Cust
                        const CRCT  = Calc=='M2' ? Valr*Lrg*Alt*Qnt+Adicional             : F_Cust
                        const VALOR = Calc=='M2' ? TotalCress(Valr,Lrg*Alt*Qnt)+Adicional : F_Valr
                        
                        const VALOR_D = Math.floor(VALOR-(VALOR*(DESCt-(DescQtn))))
                        
                        console.log(`${oMetro}m² - `,'Desc1:',DESCt,' - Desc2:',DescQtn)

                        InNa_RS($('.ORC_CUST_Vund',tr),CUSTO/Qnt)
                        InNa_RS($('.ORC_CUST_SbTt',tr),CUSTO)
                        InNa_RS($('.ORC_CRCT_Vund',tr),CRCT/Qnt)
                        InNa_RS($('.ORC_CRCT_SbTt',tr),CRCT)
                        InNa_RS($('.ORC_RSUT_Vund',tr),VALOR_D/Qnt)
                        InNa_RS($('.ORC_RSUT_SbTt',tr),VALOR_D)

                        ReloadTotal()
                    }
                    
                    function Tog_M2_OFS_UND(e){
                        if(Prod[e.value].Calc === 'M2'){console.log('M2')
                            None($$('.OrcCbmt,.OrcGram,.OrcQntt',_tr(e)))
                            Show($$('.ORC_INPT_Lrg,.ORC_INPT_Alt,.ORC_INPT_Qnt',_tr(e)))
                        }
                        if(Prod[e.value].Calc === 'OFS'){console.log('OFS')
                            Show($$('.OrcCbmt,.OrcGram,.OrcQntt',_tr(e)))
                            None($$('.ORC_INPT_Lrg,.ORC_INPT_Alt,.ORC_INPT_Qnt',_tr(e)))
                        }
                        if(Prod[e.value].Calc === 'UND'){console.log('UND')
                            None($$('.OrcCbmt,.OrcGram',_tr(e)))
                            Show($$('.ORC_INPT_Qnt',_tr(e)))
                        }
                    }

                    function ValidOpts(){$$('#ORC select').forEach(e=>$$('option',e).length==1 ? Add(e,'sOFF') : Rmv(e,'sOFF'))}

                    function Tm_OptsGraff(Ary,Stg=null){ //  Função que Carrega os Serviços dentro dos Grupos
                        const GpIt={}, GpOF={}
                        ObjEtr(Prod).forEach(([k,v])=>{GpIt[k] = v.Calc ; GpOF[k] = v.Stts})

                        return `<option value="" disabled selected>${Ary[0]}</option>
                            ${Object.entries(Ary.slice(1).reduce((a,e)=>{
                                (a[GpIt[e]]||=[]).push(`<option value=\"${e}\" ${Stg === e ? 'selected' : ''} ${GpOF[e] === 'Offf' ? 'style=\"color:red;\"' : ''}>${e}</option>`);return a
                            },{})).map(([g,o]) => `<optgroup label=\"${g}\">${o.join('')}</optgroup>`).join('')}
                        `}
                </script>

                <div> <!--Valores TOTAL-->
                    <p>Total</p>
                    <div class="ORC_CUST_FINAL Final none"></div>
                    <div class="ORC_CRCT_FINAL Final none"></div>
                    <div class="ORC_RSUT_FINAL Final"     ></div>
                    <script>
                        function ReloadTotal(){
                            Inn($('.ORC_CUST_FINAL'),Tm_RS(SOMA($$('.ORC_CUST_SbTt').map(e=>Nm(e)))))
                            Inn($('.ORC_CRCT_FINAL'),Tm_RS(SOMA($$('.ORC_CRCT_SbTt').map(e=>Nm(e)))))
                            Inn($('.ORC_RSUT_FINAL'),Tm_RS(SOMA($$('.ORC_RSUT_SbTt').map(e=>Nm(e)))))}
                    </script>
                </div>

                <script> // Funções Dedicadas a Tabelas de ORÇAMENTO
                    function Rload_Tbl(Tbl){Upp_Tabela(Tbl) ; Upp_RowCol(Tbl) ; RecolorVlr(Tbl) ; RecolorVlr()} ; Rload_Tbl('#ORC')
                    function Upp_Tabela(Tbl){
                        $$(`${Tbl} tbody tr`).length == 1 ? None($$('.OrcRmv',$(Tbl))) : Show($$('.OrcRmv',$(Tbl))) // Remover o X
                        $$(`${Tbl} tbody tr`).length == 1 ? None($$('.O_All')) : Show($$('.O_All'))
                        // aqui pode ter mais coisas pra Atualizar a Tabela
                    }
                    function Upp_RowCol(Tbl){
                        const Lmt = $$(`${Tbl} tr:nth-child(1) input`).length
                        $$(`${Tbl} input`).forEach((I,x)=>{
                            I.dataset.row = Math.floor(x/Lmt)
                            I.dataset.col = x % Lmt})
                    }
                    function HandArrow(Tbl,e){
                        if (e.key === "Enter"){
                            const Inpts = $$(`input`,Tbl)
                            const Elemt = $(':focus')
                            const Next = Inpts[Array.from(Inpts).indexOf(Elemt)+1]
                            if(Next){Next.focus() ; Next.select() }}
                        let act = document.activeElement
                        if (act.tagName !== "INPUT") return
                        let r = +act.dataset.row, c = +act.dataset.col, nxt
                        if (e.key === "ArrowRight") nxt = `[data-row='${ r }'][data-col='${c+1}']`
                        if (e.key === "ArrowLeft")  nxt = `[data-row='${ r }'][data-col='${c-1}']`
                        if (e.key === "ArrowDown")  nxt = `[data-row='${r+1}'][data-col='${ c }']`
                        if (e.key === "ArrowUp")    nxt = `[data-row='${r-1}'][data-col='${ c }']`
                        if (nxt){$(nxt)?.focus() ; setTimeout(()=>$(nxt)?.select(),0)}
                    }

                    window.addEventListener("resize",Check_W_Pag)
                    Check_W_Pag()
                    ValidOpts()
                </script>

                <div class="w100 Ct none" style="margin-top: 80px"> <!--Informações Extras-->
                    <div class="Cl"><label>Nome</label><input placeholder="Nome"></div>
                    <div class="Cl"><label>Contato</label><input placeholder="Contato"></div>
                    <div class="Cl"><label>Endereço</label><input placeholder="Endereço"></div>
                    <div class="Cl"><label>Comentário</label><input placeholder="Comentário"></div>
                </div>
                <button onclick="VerNota()">Ver Nota</button>
            </div>

            <div id="G_Cores" class="Ct none"> <!--AJEITAR-->
                <!-- Ajeitar  
                    isso ficará disponível apenas para coisas com cores sólidas como Recorte e Router
                    deverá ser transformado em um Menu suspenso, uma Bandeija, pra n atrapalhar
                    pois ele vai ficar dentro da tabela
                    essa tabela terá uma Coluna Extra, [Serv, Tipo, Larg, Alt, Qnt, Extra]
                    esse extra quando for algo q tenha cor, será a Cor o extra
                    se for Placa, Plotagem o extra será comprimento
                -->
                <style>
                    #G_Cores div{width:80%;  height:30px; border:2px solid #ffffff2f}
                    #G_Cores p  {width:30px; height:30px; margin:2px}
                </style>
                <script>  
                    const Load_Cor =()=>StockjVinil.map(e=>`<p class="RD ppt" style="background:${e}" onclick="mudarCor('${e}');VariasCor(this,'${e}')"></p>`).join('')
                    const mudarCor =cor=>$('#I_Cor').style.backgroundColor=cor
                    const VariasCor=Cor=>{Cor.innerHTML = Cor.innerHTML==='1'?'':'1';Tog(Cor,'Atv')}
                </script>
                <div id="I_Cor" class="Ct Rd ppt" onclick="Tog_N(Sib('a'))">Escolha uma Cor</div>
                <a class="Ct none" onload="Inn(this,Load_Cor())"></a>
            </div>

            <div class="Ct">
                <div id="Div-Inpt-Larg"><input placeholder="Larg" oninput="MaskNum(this);RodaCanvMdds()"></div>
                <div id="Div-Inpt-Alt"> <input placeholder="Alt"  oninput="MaskNum(this);RodaCanvMdds()"></div>
                <div id="Div-Inpt-Qnt"> <input placeholder="Qnt"></div>
                <!--Comprimento n precisa ser Value 0 aqui, se for Vazio então da Zero no Gera3D-->
                <div class="Cl"><input id="Compmnt" type="text" placeholder="Comprimento" value="0"></div>
            </div>

            <div class="Cl">
                <div class="Ct w100">    
                    <div id="AreaX" class="Cl"><label for="I_AreaX">Largura Area</label><input id="I_AreaX" placeholder="Largura Area" oninput="MaskNum(this);RodaCanvMdds()"></div>
                    <div id="AreaY" class="Cl"><label for="I_AreaY">Altura Area </label><input id="I_AreaY" placeholder="Altura Area"  oninput="MaskNum(this);RodaCanvMdds()"></div>
                </div>
                
                <!--Não preciso de um Input aqui pra receber 0 ou 1, isso pode fica diretamente na class do Button q deveria ser um CheckBox e Xuva-->
                <div class="Cl"><button class="Ct" onclick="ValTogg('#BackCub','0','1')">Completar Cubo</button><input id="BackCub" class="none" value="0"></div>

                <div id="LoadCanvaaas">Lugar do Botão ShowCanvas</div>
                <button onclick="Gera3d($('#NewCanvas'))">Roda 3D</button>
                <div>
                    <!--
                        Permitir q cada linha Gere seu Canvas
                        ambos os Canvas, de Mdds e de Gera3D
                        Redimensionar canva 3D com base na altura se passar do preview (como no drop img do GBRT)
                    -->
                </div>
            </div>
        </div>
    </div>

    <style> /*CSS dos Modais*/
        .Dark #FModal>div{background:#1b1b1b}
        .Lite #FModal>div{background:#ffffff}
        .Dark #FModal > #ModalNota{background:#ffffff;color:black}
              #FModal h1{font-size:25px}

        #ModalLogin{width:300px;height:400px}
        #ModalCadastro{width:70%}
        #Modal-Item .Feed{width:400px;height:400px}
        #Modal-Item .Stry{width:250px;height:440px}
        #Modal-Info1,#Modal-Info2{padding:30px}
        #InnerVazio input{position:absolute;width:200px}

        #ModalNota>div{padding:5px 0px}
        #Nota-Clnt>div>div>div{margin:0px 5px}
        #ModalNota img{width:50px;height:50px}
        .Start2 p{margin:1px 5px}
        #LugarFotoNotta{margin-right:3px}

        #TabelaNotinha{text-align: center;border-collapse: collapse;border: #d8d8d8 solid 1px;}
        #TabelaNotinha tr{background: #5F009E;color: white;font-size: 13px;}
        #TabelaNotinha td{background: #ffffff;color: black; padding: 3px;font-size: 13px;}
        #TabelaNotinha tfoot > tr > th {background: #575757}
        #TabelaNotinha td:nth-child(5){font-size: 13px;color:#4f4f4f;}
        #TabelaNotinha td:nth-child(6){font-weight: bold}
    </style>

    <div id="FModal" class="Ct">
        <script>function SairMdal(){None('#FModal')} </script>

        <div id="Mdal-Area">
            <textarea id="Area" placeholder="Digite aqui..." oninput="ResizeArea(this)" onkeydown="KeyEntr(()=>Read_Obj_Area('#Area'))"></textarea>
        </div>

        <div id="ModalLogin" class="Ct Rltv Rd">
            <div class="Close Ct" onclick="SairMdal()">X</div>
            <div class="Bt Loginn">Login</div>
              <div class="Ct Start">
                <label for="Senha">Senha</label>
                <input id="Inpt-Senha" class="Inputss" type="password" onkeyup="TestSenha(event,this)">
              </div>
              <span id="Span-Login" class="erro"></span>
              <div class="Bt">
                <button class="Ct w40" onclick="TestSenha('','#Inpt-Senha')">Logar</button>
                <button class="Ct w40" onclick="Deslogar();SairMdal()">Sair</button>
              </div>
        </div>

        <div id="FormIMG"></div>

        <div id="Mdal-Prod">
            fotrinhas
        </div>
    
        <div id="ModalNota" class="Cl Rltv Rd media30">
        <div class="Close Ct" onclick="SairMdal()">X</div>
        <div id="Titulo-Nota" class="w100 Bt Hr"></div>
            <div id="Nota-Empresa" class="Ct Row Hr Bt w100">
                <div class="Ct">
                <div id="LugarFotoNotta"><img src="Img/Logo2.png"></div>
                <div>
                    <h2>INFINITY GRAFF</h2>
                    <h2>IMPRESSÃO DIGITAL</h2>
                </div>
                </div>
        
                <div class="Start2">
                    <div class="FtBd Ct">Endereço: <p>Estrada do Tip, N° 54A</p></div>
                    <div class="FtBd Ct">Cidade: <p>SÃO LOURENÇO DA MATA</p></div>
                    <div class="FtBd Ct">Email: <p>infinitygraff@outlook.com</p></div>
                    <div class="FtBd Ct">Contato: <p class="B">(81) 98726.5401</p></div>
                </div>
            </div>
        
            <div class="Ct Cl Hr">
                <h2>CUPOM FISCAL</h2>
                <div id="DataNota"></div>
            </div>
        
            <div class="Start2 Hr">
                <div class="Ct"><p class="FtBd">ORDEM DE SERVIÇO:<p><p>${id}</p></div>
                <div class="Ct"><p class="FtBd">Data:</p><p>00/00/2023</p></div>
            </div>
        
            <div id="Nota-Clnt" class="Row w100 Ev">
                <div>
                <div class="Ct FtLt">Nome:     <div data="Clnt"></div> </div>
                <div class="Ct FtLt">Fone:     <div data="Cntt"></div> </div>
                </div>
                <div>
                <div class="Ct FtLt">Endereço: <div data="Local"></div></div>
                <div class="Ct FtLt">Cidade:   <div data="City"></div> </div>
                </div>
                <div>
                <div class="Ct FtLt">CPF/CNPJ: <div data="CNPJ"></div> </div>
                </div>
            </div>
        
            <div id="ConteudoNota" class="w100">
                <table id="TabelaNotinha" class="w100"><thead><tr><th style="color: white">Serviços</th></tr></thead></table>
                <div id="DescrNota" class="Ct Cl"></div>
                <h2 id="TotalNotta" class="Hr Ct"></h2>
            </div>
        
            <div class="w100 Ct">
            <button id="trocatroca" class="BTNota Ct RD magem" onclick="troctroc()">Troca-Troca</button>
            <button class="BTNota Ct RD magem" onclick="SairMdal()">Cancelar</button>
            <button class="BTNota Ct RD magem" onclick="NewPDF()">Imprimir<div id="imgnotta" class="Ct"></div></button>
            </div>
        </div>

        <div id="EditarPerfil" class="Cl Rltv Rd">
            <div class="Close Ct" onclick="SairMdal()">X</div>
            <div>Foto</div>
            <img src="./Img/Perfil_Allan.png" width="100">
            <div>Nome do Usuário</div>
            <input type="text" placeholder="Senha Atual">
            <input type="text" placeholder="Nova Senha">
            <input type="text" placeholder="Repetir Senha">
        </div>

        <div id="ConfigPag" class="Cl Rltv Rd">
            <div class="Ct Close" onclick="SairMdal()">X</div>
            <div><input id="DarkLite" type="checkbox" class="GETConfig" onchange="DarkLite2('body',this.checked)" onclick="SaveConfig(this)"> <label>Modo Escuro</label></div>
            <div><input id="TamFonte" type="range"> <label>Tamanho de Fonte</label></div>
            <button onclick="TrocaCSS('CSS1')">CSS1</button>
            <button onclick="TrocaCSS('CSS2')">CSS2</button>
            <button onclick="TrocaCSS('CSS3')">CSS3</button>
            
        </div>

        <div id="PagSUPORTE" class="Cl Rltv Rd">
            <div class="Close Ct" onclick="SairMdal()">X</div>
            <div>informações de Suporte</div>
            <div>dicas de como usar o APP, principalmente pra mim</div>
            <button onclick="CopyGRAFF('Pix',this)">Copiar Pix</button>
        </div>
    </div>
</body>

<script> // Manipulações de Dados
    // MiniLib pra ser usada principalmente por essas Func de manipulações
        const LocLinId=(Typ,ID)=>J[Typ].find(e=>e.Id==ID)
        const orArr   =(e,fallback=[])=>Array.isArray(e) ? e : fallback
        const ClrObj  =obj=>Object.fromEntries(ObjKey(obj).map(k=>[k,'']))

        function EditCell(e,vall=null){ // ⭐⭐⭐⭐_
            const[ras,Typ,ID2,col,Cry]=D_Rastr(_td(e))
            // R_Color(_tr(e),Typ)
            const Val = vall===""?"":VAL(e)
            if(Val===Nm(e)){return} // quando não foi Aterado
            const ID     = isBdj(e) ? tr_ID(Pai(_td(Pai(_td(e))))) : Typ=='SERV' ? ID2.split('_')[0] : Typ=='PGMT' ? VAL($(`${Rx2(['Link'])}`,_tr(e))) : ID2
            const NewVal = vall===""?"":vall?vall:Val
            const Antg   = Nm(e)
            Nm(e,e.textContent.trim()) // Mudar o Name
            $$(Rx2([`${Typ}-${ID2}-${col}`])).forEach(td=>{if(td!==_td(e)){if(VAL(td)!==NewVal){DarVAL(td,NewVal)}}}) // Editar Cópias em outra Tabela
            const Nv = {PDDS:1,CLNT:1,MPAG:1,OOSS:1,UBER:1,GRAD:1,SERV:'PDDS',PGMT:'PDDS',CUST:'PDDS',ABCD:'GRAD'} // em qual camada a linha está
            //O Ato de Editar
            if(Nv[Typ]==1){J[Typ][col] = NewVal ; UpdateSupa(Typ,col,ID,NewVal)} // Edição de Valor Simples
            else{
                const X = J[Nv[Typ]].find(e=>e.Id==ID)  // encontra a Linha nivel 1
                const x = X[Aa(Typ)].find(e=>e.Id==ID2) // encotnra a linha nivel 2
                x[col] = NewVal
                UpdateSupa(Nv[Typ],Aa(Typ),ID,X[Aa(Typ)])
            }
        }

        function insertOrden(Typ,arr){  // ⭐⭐⭐_ _ (ainda não testei dentro da Bndj | bndj não tem ordem ent sempre vai ser ID)
            const NEWtr = NewTag('tr') ; Inn(NEWtr,Tm_Table(Typ,arr))
            const tbody= $(`#H_${Typ} > tbody`)
            const trs = [...tbody.rows]
            const Ordn= AllI(_table(tbody),'Atv')                    // orden Ativa
            const asc = Ordn.length==0?true:Ordn[0].innerText == '▼' // Conferir se é Desc ou Asec
            const col = Ordn.length==0?'Id':Nm(SibQSl(Ordn[0],'p'))  // Nome da Coluna
            const colX= Colx(Typ,col)                                // index da coluna
            const vall= arr[0][col]
            const compare=(a,b)=> asc ? b.localeCompare(a)<0 : a.localeCompare(b)<0
            const Alvo= trs.find(tr=>{const a = VAL($(Rx2([Typ,col]),tr)) ; return compare(a,vall)}) //(a,b)=>b<+a, quando é Valor
            tbody.insertBefore(NEWtr,Alvo||null)
        }
        
        function NewLinBdj(Eu){         // ⭐⭐⭐⭐_ (Ta bem BOA!)
            const R = D_R(_td(Eu)) ; const col = AA(R.Col)
            if(TypBndj.includes(col)){            // só pra col q tem bndj
                const row = LocLinId(R.Typ,R.Row) // Localizar Linha pelo 'Id' LocLinId()
                const arr = orArr(row[R.Col])     // se n for um array, return []
                const lngh= l0(arr)               // conferir se é a Primeira vez!
                const Def = ClrObj(BS[col])       // Cria um Default Baseado na bndj
                if(['Serv','Pgmt']){
                    Def.Id   = `${row.Id}_${arr.length+1}`// Novo Id
                    Def.Data = row.Data                   // Clona Data ⚠️⚠️(Pgmt não pode clonar Data)⚠️⚠️
                    Def.Clnt = row.Clnt                   // Clona Cliente
                }
                /*Obj*/ arr.push(Def)
                /*DOM*/ lngh ? Inn(_td(Eu),Tratamento(arr,Extrat_Clss(_td(Eu),'Rastr-'))) : Befor($('table tbody',_td(Eu)),Tm_Table(col,[Def]))
                /*Sub*/ UpdateSupa(R.Typ,R.Col,R.Row,arr) // da um jeito de informar o Alert q é NewLin
            }
        }LOG('Fome')

        function RmvROW(eu,SuB){        // ⭐⭐_ _ _
            // se vier do supabase então não tem acesso a 'eu' então deve procurar ele antes de começar com tudo!
            const Lxra = true
            const IsBdj = isBdj(eu)
            const R=D_R(_td(eu)), P= IsBdj ? D_P(_td(eu)) : null
            const [Typ,col,id] = IsBdj ? [P.Typ,P.Col,P.Row] : [R.Typ,R.Col,R.Row]
            const Secund = _td(eu).classList.contains('Secund')
            
            function Poxuca(r,p){
                const X = tr_X(_tr(eu))      // encontra o Index da Linha da Tabela 'Typ'
                const ID= tr_ID(_tr(eu))     // encontra o ID    da Linha da Tabela 'Typ'
                const F = J[r.Typ][X]||null  // encontra a linha do J[Typ] Principal
                if(!Secund && p==null){return {TYP:[X,F]}} // se não for uma tbela secundária nem está em uma Bandeija retorna apenas o TYP
                if( Secund && p==null){
                    
                    const idddd = r.Typ=='SERV' ? ID.split('_')[0]
                                 :r.Typ=='PGMT' ? VAL($(`${Rx2(['Link'])}`,_tr(e)))
                                 :null
                    
                        const XOrig = (i=>i>=0?i:false)(J[LocSecund[r.Typ]].findIndex(e=>e.Id==ID))
                    return {TYP:[,],Bndj:[X,F]}}

                const x  = IsBdj ?(i=>i>=0?i:false)(F[P.col].findIndex(o=>o.Id==R.Row)):null // encontra o Index a linha dentro da Bndj do J[Typ] Principal
                const find = IsBdj && x!==false ? F[P.col][x] : null                       // encontra a linha dentro da Bndj do J[Typ] Principal
                return {TYP:[X,F],Bndj:[x,find]}
            }
            LOG(Poxuca(R,P))
            
            return
            
            if(Lin && Lxra){J[R.Typ][Lin]['Lixo']=true}else{J[R.Typ].splice(Lin,1)} 
            const vall = IsBdj ? JsonEditado : true
        }LOG('RatsAAs')

        function AddROW(Typ,obj=null){  // um Obj no segundo argumento se Tiver
            if(Typ=='PGMT'||Typ=="CUST"||Typ=="SERV"){
                // Modal pedindo pra Escolher em quam "PDDS" vai querer Linkar, inclusive criar um Novo
            }
            
            function AddRowPratic(Typ,obj,Pose){
                let tbody =  $(`#H_${Typ} > tbody`)
                let Clone =  $('tr',tbody).cloneNode(true)
                ClearRow(Clone) // isso poderia recarregar chamando Tm_Tables apenas pra essa Linha (Limpará rapidinho)
                Pose === "<" ? tbody.prepend(Clone) : tbody.appendChild(Clone)
            }

            function AddROWConst(Typ,obj=null){ // depois mudar pra inserir no Inicio ou no Final
                const LastRow=(obj,id)=>obj.reduce((max,e)=>Math.max(max,e[id]),0)
                const Arq = J[Typ]
                const Novo = {...Arq[Arq.length-1]}                    // Clona Nova Linha
                ObjKey(Novo).forEach(k=>(Novo[k]=''))                  // Limpa tudo
                Novo['ID'] = LastRow(Arq,'ID') + 1                     // Muda Id para um Novo
                if(obj){ObjEtr(obj).forEach((K)=>{Novo[K[0]] = K[1]})} // Atualizar o Restante dos Dados
                J[Typ].push(Novo)
                console.log(Novo)
            }
                                      // add Nova Linha, só clonar a linha default
            AddRowPratic(Typ,obj,'<') // Antes de mais nada tem q Adicionar Pedido na Prática
            AddROWConst(Typ,obj)      // Depois Atualiza a Const adicionando o novo pedido a ela
            CREATESupa(Typ,id)        // Depois da o Fetch no SupaBase // na vdd quem deveria dar o ID é o Supabase
            const ObjPresset = { // para Pedidos, clonar os Jsons
                RG:AGORA(),
                OFF:1,
                Data:DMY(e[0]),
                Clnt:TesteClnt(nome)
            }
            // Ao adicionar uma linha tanto em PGMT ou em SERV, estarei fazendo nada mais nada menos
            // que adicionando uma linha em PDDS
        }LOG('Existes')
        
        function MesclarContato(){      // ⭐_ _ _ _ // Não tem efeito Prático, ao fazer isso tem q atualizar a Página
            const Fim = $('#H_CLNT .LinkULT') // futuramente n precisar disso pois ele vai ser oq tiver mais pedidos atrelado
            // se for a mesma quantidade então escolhe qualquer um
            if(!Fim){console.log('Faltou o Link Final') ; return}
            // também da erro se tiver mais de uma Selecioanda
            $$('#H_CLNT .LinkAtv').forEach(td=>{
                const [dR,dRf] = [D_Rastr(td),D_Rastr(Fim)]
                const Ids_PDDS = td.innerText.split(',')
                Ids_PDDS.forEach(ID=>{UpdateSupa('PDDS','Clnt',ID,dRf[1])}) // Editar PDDS
                RmvROW(td) // remove a Linha
                
                // Editar Pedidos Prático e Const
                //const Obj_PDDS   = J['PDDS'].filter(e=>e.Clnt==dR[1])
                //Obj_PDDS['Clnt'] = linkFinal
            })
            // quando terminar Limpa o Filtro
        }

        function TesteClnt(inpt){       // isso é pra Saber se o Cliente existe na Tabela de CLNT
            // if($('#ConfirCliente').checked){console.log('Perguntar')} // Ativar ou não o ato de Perguntar pra confirmar
            if(confirm(`Tem Certeza que quer salvar: ${inpt.value} como Cliente?`)){
                if(Nmame(inpt)){return Nmame(inpt)
                }else{
                    AddROW('CLNT',{Clnt:inpt.value}) // Adiciona Nova Linha já com Novo Valor
                    // dentro do AddRow terá os 3 (Prático, Const, SupaBase)
                    // Reload nesta Célula
                    }
            }
        }

        function loadtmtable(Typ){
            const LOAD = (TYP)=>{
                const tbody = $(`#H_${TYP} > tbody`)
                Add($(`#H_${TYP}`),'w90')
                Inn(tbody,Tm_Loade(TYP)) // mostrar um Load Carregando até completar
                // settimeout aqui
                setTimeout(()=>{
                    Inn(tbody,Tm_Table(TYP,J[TYP]));Rfresh_Foot(TYP);AutoClntPDDS()
                    $$('#H_PDDS > tbody > tr').forEach(tr=>RecolorBasico(tr)) // depois remover isso pq é Gambiarra!
                    Rmv($(`#H_${TYP}`),'w90')
                },0)
                
            }

            if(ObjKey(J).includes(Typ)){
                if(PreTable[Typ]==true){ALERT(Mnsg['PreTbl'](N_Brev[Typ]));return} // Conferir se essa Aba já foi Aberta!
                     if(Typ=='PGMT'){LOAD(Typ);LOAD('MPAG')                      } // tem 2 Tabelas na #PagPGMT
                else if(Typ=='GRAD'){LOAD(Typ);LOAD('OOSS');LOAD('UBER')         } // tem 3 Tabelas na #PagGRAD
                else{LOAD(Typ)}                                                    // os demais tem só 1 tabela
                PreTable[Typ]=true                                                 // Declarar que a Aba já foi Aberta!
            }
        }

        // Adicionar e trocar Cliente
</script>

<script> // SupaBASE ⭐_ _ _ _

    function getSB(){
        async function gett(Typ){ // isso apenas traz os dados e Joga na Const!
            let todas = [], lim = 1000, ofs = 0, data
            do{({data}=await supabase.from(Typ).select('*').order('Id',{ascending:true}).range(ofs,ofs+lim-1))
                if (!data) return console.error('Erro ao carregar dados')
                todas.push(...data) ; ofs+=lim
            }while(data.length===lim)
            
            if(Typ=='PDDS'){
                J['PDDS']=NULL__(todas.map(e=>PDDSconverterJSON(e)))
                criaCol_Col('Qnt' ,'PDDS','Serv') // Adicionar Coluna Qnt dentro de 'Serv' q n tem por Padrão!
                criaCol_Col('Lag' ,'PDDS','Serv') // Adicionar Coluna Qnt dentro de 'Serv' q n tem por Padrão!
                criaCol_Col('Alt' ,'PDDS','Serv') // Adicionar Coluna Qnt dentro de 'Serv' q n tem por Padrão!
                criaCol_Col('TArt','PDDS','Serv') // Adicionar Coluna Qnt dentro de 'Serv' q n tem por Padrão!
                J['SERV']=J['PDDS'].flatMap(e=>e.Serv)
                J['PGMT']=J['PDDS'].flatMap(e=>e.Pgmt)
            }else{
                J[Typ] = NULL__(todas.map(e=>PDDSconverterJSON(e)))
                if(Typ=='CLNT'){Listagem('CLNT')}
            }
            console.log(`✔️ ${Typ}`)
        }
        ['PDDS','CLNT','MPAG','GRAD','UBER','OOSS'].forEach(Typ=>{gett(Typ)}) // Tabelas Disponíveis no SB!
    }getSB()

    function configurarRealtime() {
        return supabase.channel('SuBs-CLNT').on('postgres_changes',{event:'*',schema:'public',table:'*'},e=>{
            const [crud,nEw,old,Typ] = [e.eventType,e.new,e.old,e.table]
            Supa_RealTime(crud,nEw,Typ,old)
        }).subscribe()
    }

    function Supa_RealTime(crud,nEw,Typ,old){
        LOG('realTIME foi Ativado')
        if(crud==='UPDATE'){
            const NOVOO = NULL__([nEw])[0]
            const Atual = J[Typ].find(e=>e.Id==nEw.Id)
            LOG(Atual)
            const Difff = Diferentes(NOVOO,Atual,Typ)
            if(Difff==null){LOG(`⚠️ RealTime() J[${Typ}] ja Tava Igual`) ; return}
            LOG(Difff)
            ObjEtr(Difff).forEach(([col,Vlr])=>{if(col!=='Id'){Atual[col]=NOVOO[col]}})// Atualiza a Const primeiro           
            flatenObject(Difff,Typ).forEach(([TYP,ID,col,Vlr])=>{
                $$(Rx2([`${AA(TYP)}-${ID}-${col}`])).forEach(td=>{ // Atualiza na Prática cada td
                    // Add ou Rmv Linha da Bndj  (aqui é fácil só conferir o .length do atual e do novo!)
                    if(col=='Lixo'){if(Vlr){_tr(td).remove() ; return}else{
                        return
                       // Descobrir qual ordem está
                    }} // dentro e fora da bandeija
                    
                    if(td){if(VAL(td)!==Vlr){DarVAL(td,Vlr) // Editou valor
                         LOG(`✏️ RealTime() "${TYP}-${ID}-${col}" >> ${Vlr}`)} // chamar R_Color()
                    else{LOG('⚠️ RealTime() P-P ja Tava Igual')}}
                    else{LOG('⚠️ RealTime() P-P não Existe')}
                })
            })
        }else if(crud==='DELETE'){// Linha foi Exluida de Verdade
            const Antigo = old // comparar com quem ela é igual! pra poder remover
            // remove da Const, e o Prático!
        }else if(crud==='INSERT'){// Linha foi Adicionada de Verdade
            const novaLin = nEw
            // dar Push na Const
            // insertbefore, e tm_Table() para criar tr novo!

        }
        // antes de qualquer ação descobrir se o efeito foi feito por mim ou por outra pessoa
        // se foi feito por mim, então não precisa seguir com o RealTime!
        // RealTime deve execultar as coisas Chamando as Próprias funções Pre-estabelecidas! em Manipulações de Dados
        // insertOrden()
        // NewLinBdj()
        // RmvROW()

    }
    
    async function Sb_DELETE(Typ,id){
        const {err} = await supabase.from(Typ).delete().eq("Id",id)
        err ? console.error("Erro ao excluir:",err) : console.log(`Linha ${id} excluída da Tabela ${Typ}!`)
    }


    const NOVALINHA = [{Cat:"Adesivo", Clnt:"João Pereira", Cmpt:"Recorte eletrônico", Cntt:"(11) 91234-5678", CtLj:"Whatsapp", Id:"0052", Lcal:"Loja Física - SP", Link:"", Lixo:"", Loja:"Infinity Graff", Stts:""}]
    //insertOrden('CLNT',NOVALINHA)
    

    async function UpdateSupa(Typ,col,id,valor){
        try {const {error} = await supabase.from(Typ).update({[col]:valor}).eq('Id',id)
            if (error){console.error('Erro ao atualizar:',error)}
            else  {    console.log('💾 UpdateSupa(✏️) Atualizado') ; ALERT(`"${valor}" Atualziado no SubaBase! (${Typ},${id},${col})`)}
        } catch (err){ console.error('Erro:',err                  ) ; ALERT('Erro ao atualizar serviço')}
    }
    // Editar elementos por dentro da Bndj

    async function CREATESupa(Typ,coluna,id,valor){
        try {const { error } = await supabase.from(Typ).update({[coluna]:valor}).eq('Id',id)
            if (error) {console.error('Erro ao atualizar:', error) // showToast('Erro ao atualizar serviço','error')
            } else {console.log('Atualizado')  //showToast('Atualizado com sucesso!')
            }
        } catch (err){console.error('Erro:',err) //showToast('Erro ao atualizar serviço', 'error')
        } finally {console.log('Salvo')}
    }

    async function criarLinhaNova(dados,btn){
        btn.disabled = true
        btn.textContent = 'Criando...'

        try {
            const { error } = await supabase
                .from('servicos') // nome da tabela
                .insert([dados]);

            if (error) {
                console.error('Erro ao criar:', error);
                //showToast('Erro ao criar linha', 'error')
            } else {
                //showToast('Linha criada com sucesso!');
            }

        } catch (err) {
            console.error('Erro:', err);
            //showToast('Erro ao criar linha', 'error');

        } finally {
            btn.disabled = false;
            btn.textContent = 'Criar';
        }
    }

</script>

<script> // Login ⭐_ _ _ _
    let LgTp = {'Nome':'','Cod':'','Img':''}
    function TestSenha(e,ipt=null){

        function CrypPass(senha){
            const Cryp = senha.split('').map((c,idx)=>{
                if(/[0-9]/.test(c)){let N=parseInt(c)
                N=N===9?0:N+(idx%2===1?4:1);return N.toString()}
                else if(/[A-Za-z]/.test(c)){
                let L=c.charCodeAt(0)+(idx%2===1?5:1)
                if(L>90&&L<97)L-=26
                else if(L>122)L-=26
                return String.fromCharCode(L)}else{return c}})
            var par = [] ; var imp = []
            Cryp.forEach((e,idx)=>{idx%2===0?par.push(e):imp.push(e)})
            const Par=par.reverse().flatMap(C=>[`3${C}$`,`r${C}-`,`3${C}&`])
            const Imp=imp.reverse().flatMap(C=>[`-${C}e`,`V${C}9`,`@${C}K`])
            return Par.concat(Imp).join('')
        }
        
        const User={
            '31$r1-31&-4eV49@4K':['(Baby)','Baby Massia'   ,'Img/Perfil_Baby.png'   ],
            '32$r2-32&-6eV69@6K':['(Alan)','Allan MacLovin','Img/Perfil_Allan.png'  ],
            '34$r4-34&-7eV79@7K':['(Lisa)','Lisa Caramelo' ,'Img/Perfil_Lisa.png'   ],
            '36$r6-36&-9eV99@9K':['(Segu)','Segunda Hippie','Img/Perfil_Segunda.png']
        }

        if(e==='Deslog'){
            Nm($('#Login-Top'),'')
            Inn('.LgTp2',IconLogin)
            Show('.LgTp')
            None('.ImgPerfil')
            $('.ImgPerfil').src=''
        
        }else if(e==='Storage'){ if(User[ipt] === undefined || User[ipt] === null){return}
            else{
                // localStorage.removeItem('SenhaCryp')
                // localStorage.setItem('SenhaCryp',input)
                Nm($('#Login-Top'),'Logado')
                Inn('.LgTp2',User[ipt][1])
                Show('.ImgPerfil')
                $('.ImgPerfil').src=User[ipt][2]
            }
        }
        else{
            let inpt=e==='' ? $(ipt) : ipt
            if(KeyEnter(e)||e===''){
                const Cryp = CrypPass(inpt.value)
                if(User[Cryp]){

                    None($('#IMG-PerfiL'))
                    SairMdal()
                    localStorage.removeItem('SenhaCryp')
                    localStorage.setItem('SenhaCryp',Cryp)
                    Nm($('#Login-Top'),"Logado")
                    Inn('.LgTp2',User[Cryp][1])
                    Show('.ImgPerfil')
                    Show('.ImgPerfil2')
                    $('.ImgPerfil').src=User[Cryp][2]

                }else{Inn('#Span-Login','Senha Inválida') ; inpt.placeholder='Senha Inválida'}
                inpt.value='';inpt.focus()
                console.log('Logou')
            }
        }
    }
    
    function SemLogin(){return LgTp.Cod===''}
    function LoginStorage(){const Pass = localStorage.getItem('SenhaCryp');if(Pass===null){return};TestSenha('Storage',Pass)}
    function Deslogar()    {localStorage.removeItem('SenhaCryp');TestSenha('Deslog','')}
    LoginStorage()
    // deixar o CryPass() na BaseDados da Biblioteca
    // levas as config do Usuáio para o SupaBase
</script>

<script> // Nota  ⭐_ _ _ _
    function estaOculta(e) {return getComputedStyle(e).display === "none"}
    function VerNota(){
        MdalShow('#ModalNota')
        const dados = $$('#ORC tbody tr').map(tr=>$$('td input, td select',tr).map(e=>{if(estaOculta(e)){return}else{return e.value}}))
        console.log(dados)
    }
</script>

<script> // Storage
    function AtivaEventos(){window.addEventListener("scroll",()=>{scrollPosition=[window.scrollX,window.scrollY]})}
    // AtivaEventos()
    function Disparos(e){/*console.log('Dispoaro >')*/ ; e.dispatchEvent(new Event('change')); /* console.log('< Dispoaro') */}
    function SaveConfig(e){StogeSet(e.id,Vll(e)) ; /* console.log('Save',e.id,Vll(e)) */ }
    function GetConfig(){$$('.GETConfig').forEach(e=>{
        const Valor = StogeGet(e.id)
        if(Valor){ llv(e,Valor);Disparos(e)  }})}
    window.onload = () => {GetConfig()}
    // function GetConfigOrdem(){OrdenarRows($(`#H_PDDS thead tr th:nth-child(${8}) a`),7,'p','desc')}
    // function savecoifigTABLE(){StogeSet('Orden',x)}
    // Save para MenuNav
</script>

<script>// Iniciação

    function PosGet(){
        Onloads('body')
        NavPag(Atual['Pag']);NavPesq(Atual['Pag'].replace('#Pag_','.Pesq_'))
        console.log('✅ Página Carregada!')
    }
    PosGet()
    
    document.addEventListener('click',e=>{const targ = e.target // isso Deve virar Padão tipo algo genético, pra usar em varios
        // esta serve só pra ativar u desativar tr q estão dentro da tabela de ORC
        Rmv($$('#ORC tr.Atv'),'Atv') // Remover todos Ativos
        if($('#ORC').contains(targ)){
            ATV(_tr(targ));ReloadDetalhes()
        } 
    })

    document.addEventListener('click',e=>{const targ = e.target // isso Deve virar Padão tipo algo genético, pra usar em varios
        Rmv('.Moldura','Atv')
        if(S(targ).Coten('ClickCanv')||targ.closest('.ClickCanv')){ATV('.Moldura.ClickCanv')}
        else{DTV('.Moldura.ClickCanv')}
    })
    // Atalhos C e E
    document.addEventListener('keydown',e=>{
        if($('.Moldura.ClickCanv.Atv')){
            if(e.key==='c'){$('#alignX').click()}
            if(e.key==='e'){$('#alignY').click()}
        }
    })   
    

    // Trexo relacionado a Mover os Botões das Fotinhas
    let alvo,dx,dy
    document.querySelectorAll('.movel').forEach(el => el.onmousedown = e => {alvo = el; dx = e.clientX - el.offsetLeft; dy = e.clientY - el.offsetTop});
    document.onmousemove = e => {if(alvo) {const x = e.clientX - dx, y = e.clientY - dy; alvo.style.left = x + 'px'; alvo.style.top = y + 'px'; $('.dimens',alvo).textContent = `${x}, ${y}`}};
    document.onmouseup = () => {if (alvo) {navigator.clipboard.writeText(`top: ${alvo.style.top}; left: ${alvo.style.left};`); alvo = null}};


    configurarRealtime()
</script>

<script> // comentários ⏳ ❌ ✔️
    // Orçamento
        // Mostrar o Valor por M2 ao Lado do Option
        // Permitir Drag nas Linhas
        // imitar Bureal no Futuro (deixando todas bandeijas Aberta)
        // no Select se oq está atualmente selecionado, existir no option da próxima rodada, então mantem ele
        // selecionar option automaticamente caso tenha apeans 1
        // Proibir Drag em Imagens
        // a soma de metros de produtos do mesmo tipo tem q resultar na Diminuição da Crescente
        // o Valor Crescente deve ficar verde, se ele for igual ao valor Final
        // qual foi o PC q deu a entrada, precisa registrar tbm, Adicionar RG tbm em Pedidos, e em Clientes e Pagamento
        // Poder Diferenciar oq foi preenchido Automatico, e o q foi preenchido Manualmente
        // deixar maior os botões de Limpar tudo, e excluir tudo (CSS mobile)
        // Adicionar um Botão pra Limpar os ta imcompleto, deixando apenas os orçamentos Certinhos
        // quero criar meu próprio Teclado Numerico, com Opções de cm, m, e mm (Oculpando espaço nessesário na Tela, sem mover o Scroll)
        // como impedir q a página dê zoom, pelo celular
        // No preview podia ser um Gif
        // RG:[Login,Data,Hora,Origem,Dispositivo,Pontuação]
        // ID cria Sozinho no BackEnd na PLanilha
        // Tipos de Aplicação: Plana, Irregular, Alto e Baixo

    // Tabelas
        // Dica pra mover Linha igual Movimenta as Linhas na Planilha, aparece só o contorno e o grad bem simplifciado
        // ao exibir o SVG grande, mostra o tamanho das coisas
        // remover Abreviação dos Thead se precisar
        // se a bandeijinha quebrar Linha então aumenta ela se não fica tamanho da Div
        // Mostrar a Soma do valor na Barra de Config
        // fica ruim pra clicar na célula quando n tem Nada
        // do Jeito q o Recolor acontece idivudual o Rfresh poderia tbm
        // Poder trocar o nome do Cliente
        // Selecionar Várias Células e Colar uma coisa só
        // o Hover precisa ta por cima das cores verde
        // ter uma opção no thead na qual eu possa Ocultar a coluna e deiaxar apenas um Icone, e quando clicar q exibe uma Bandeja, ou voltar pra o normal
        // isso vai ser bem igual aquela troca de bandeija que tem dentro de ABCD grad, só q funcionando também com um unico valor

    // Modos de Preview da Tabela (Pra Variar)
        // bandeja{
        //     Modo1 = Bandeija Flutiante, o modelo q já tem
        //     Modo2 = Bandeija Dentro da tabela Misturada
        // }
        // conteúdo{
        //     Modo1 = Formato de Tabela, (com ou sem Cabeçalho)
        //     Modo2 = Formato de Lista , igual oq já tem no Suggs
        //     Modo3 = Formato de Card  , ficará dentro será várias tags montando com tudo junto
        // }
</script>

</html>