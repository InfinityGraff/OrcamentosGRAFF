<!DOCTYPE html>
<html lang='pt-BR'>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orcamento</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/CSSBiblioteca.css">
    <link rel="stylesheet" href="./cssGRAFF.css">
    <script                 src="https://raw.githack.com/InfinityGraff/MyBiblioteca/main/PreScript.js"></script> <!--https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/PreScript.js-->
    <script                 src="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/Base.js"     ></script>
    <script                 src="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/BaseGRAFF.js"></script>
    <script                 src="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/Templates.js"></script>
    <script src="./Dados.js"></script>
</head>

<style> /*CSS Genérico*/
    .svg-Lixo {width:auto; height:100px; fill:#ffbb00}
    .ClntATV{background:#ff4500}
    p,div{cursor: default}
    #FormServ{width: 500px; background: #363636}
    input[type="checkbox"]{height: auto;}
    select{background: #7e7e7e28 !important}
    .SelectSoma{background: red}
    .Ubuiaxik{width: 800px; height: 500px;}
    .Nuevoevo{color: white;background: #53004873;padding: 2px;}

    .Formt_Verd  {background:rgba(95, 219, 95 );color:#274e24;font-weight:bold}
    .Formt_VerdOK{background:rgb(43, 211, 43  );color:#274e24;font-weight:bold}
    .Formt_Azul  {background:rgb(104, 180, 224);color:#131a5f;font-weight:bold}
    .Formt_Redd  {background:rgb(224, 104, 104);color:#910000;font-weight:bold}
    .Formt_Yell  {background:rgb(228, 252, 94 );color:#910000;font-weight:bold}
    .Formt_Orag  {background:rgb(255, 187, 0  );color:#910000;font-weight:bold}

    .Dark optgroup{color:#ffffff3f;background:#3d3d3d;font-size: 10px; text-align: left;padding-left: 80px}
    .Dark option{color:white;background:#3d3d3d}
    .Lite optgroup{color:#00000038;background:white;  font-size: 10px; text-align: left;padding-left: 80px}
    .Lite option{color:black;background:white}

    .footbndjj{background:white; bottom: 0px;  overflow: scroll; height: auto;max-height: 300px}
    .footbndjj span{color: black}
</style>

<script> // Base de Dados
    const Edi   = 'contenteditable="true"'
    const Link  = 'http://localhost:3000'
    const Atual = {Pag:'#Pag_PDDS'}
    const Navv  = ['Pedidos','Servicos','Pagamentos','Grades','MPago','Clientes']
    const NavImg= ['LOJA','PDDS','SERV','LIN','PGMT','GRAD','LIN','CLNT']
    let scrollPosition = [0,0]
    const D_brev={Tipo:'Tipo',Serv:'Serviço',Lrg:'Largura',Alt:'Altura',Cmp:'Comprimento',Cbmt:'Acabamento',Gram:'Gramatura',Qnt:'QNT',Und:'Valor UND',SbTt:'SubTotal'}
    const O = {
        Forn:['','Grafit','BPrint','Tatiane','Inová','Bureal','Stock','Arte','JLTal','Varyus','NovaImp','Barraca','Jailson','-'], // 'WM SilkSing','Casas leo'
        Serv:['','Adesivo','Banner','...'],
        Dsng:['','Allan','Baby','Fexta','Italo','Eurik','Canva','Ja Tinha','n tem',''],
        Form:['','Pix','Av','Card'],
        Pgmt:['','Pix','Av','Card'],
        Dstn:['','Serv1','Serv2'],
        Stts:['','Devendo','Entregue','JaFeito','Produção']
    }
    const Prod = { // Adicionar pra todos eles a proporção do Desconto pela quantidade // adicionar também o comporta das cores
        'Adesivo'  :{Calc:'M2' , Stts:'Disp' , Prvw:'CanvMdd' , Desc:'Adesivo Impresso'     , Forn:['Grafit','BPrint','Tatiane'  ] , Prdc:['Arte','Refile',{'Aplicação':10}            ] , Extra:[            ] , HotKey:["colar", "adesivar", "autocolante"       ] ,
                        Variantes:{
                            'Brilho'          :{item:'1',Tipo:'',Valr:60 ,Cust:20},
                            'Fosco'           :{item:'2',Tipo:'',Valr:60 ,Cust:20},
                            'Blackout'        :{item:'3',Tipo:'',Valr:70 ,Cust:25},
                            'Transparente'    :{item:'4',Tipo:'',Valr:70 ,Cust:25},
                            'Laminado'        :{item:'6',Tipo:'',Valr:70 ,Cust:20},
                            'Espelhado'       :{item:'7',Tipo:'',Valr:80 ,Cust:20},
                            'Perfurado'       :{item:'5',Tipo:'',Valr:100,Cust:35},
            }},
        'Etiqueta' :{Calc:'M2' , Stts:'Disp' , Prvw:'CanvMdd' , Desc:'Impressão + Recorte'  , Forn:['Grafit','BPrint','Tatiane'  ] , Prdc:['Arte','Recorte'                            ] , Extra:[            ] , HotKey:["rótulo", "identificação", "label", "tag"] ,
                        Variantes:{
                            'Refilada'        :{item:'6',Tipo:'',Valr:70 ,Cust:20},
                            'Redonda'         :{item:'7',Tipo:'',Valr:75 ,Cust:30},
                            'Personalizada'   :{item:'7',Tipo:'',Valr:80 ,Cust:30},
            }},
        'Lona'     :{Calc:'M2' , Stts:'Disp' , Prvw:''        , Desc:'Banner, Faixa, ilhós' , Forn:['Grafit','BPrint','Tatiane'  ] , Prdc:['Arte'                                      ] , Extra:[            ] , HotKey:["painel"                                 ] ,
                        Variantes:{
                            'Banner'          :{item:'8' ,Tipo:''                              ,Valr:70,Cust:22 , Limit:['0,00 x 1,20'] , Mdds:['0,50 x 0,70' , '0,80 x 1,20' , '2,00 x 1,00']}, 
                            'Faixa'           :{item:'9' ,Tipo:['Só Madeira','Madeira e ilhós'],Valr:70,Cust:22 , Limit:['0,00 x 1,20'] , Mdds:['2,00 x 0,50']}, 
                            'com ilhós'       :{item:'11',Tipo:['Completo'  ,     'nas Pontas'],Valr:70,Cust:22 , Limit:['0,00 x 3,20'] , Mdds:['1,00 x 1,00']},
                            'Sem Acabamento'  :{item:'13',Tipo:''                              ,Valr:60,Cust:20 , Limit:['0,00 x 3,20'] , Mdds:[]},
            }},
        'Quadro'   :{Calc:'M2' , Stts:'Disp' , Prvw:'CanvMdd' , Desc:'Quadro sem Moldura'   , Forn:['Grafit','BPrint','Tatiane'  ] , Prdc:['Arte','Aplicação',{'Laminação':10},'Reflie'] , Extra:['PVC','Fita'] , HotKey:["moldura", "pôster", "cartaz"            ] ,
                        Variantes:{  
                            'PS 1mm'          :{item:'17',Tipo:'',Valr:100,Cust:21.25 + 20, Limit:['2,00 x 1,00'] , Mdds:['0,30 x 0,20']}, // Folha de PVC com (2,00 x 1,00) R$ 42,50
                            'PS 2mm'          :{item:'18',Tipo:'',Valr:130,Cust:'        ', Limit:['2,00 x 1,00'] , Mdds:['0,30 x 0,20']},  
                            'PVC 2mm'         :{item:'14',Tipo:'',Valr:150,Cust:'        ', Limit:['2,44 x 1,22'] , Mdds:['0,30 x 0,20']},
                            'PVC 3mm'         :{item:'15',Tipo:'',Valr:170,Cust:43.00 + 20, Limit:['2,44 x 1,22'] , Mdds:['0,30 x 0,20']}, // Folha de PVC com (2,44 x 1,22) R$ 86,00
                            'PVC 5mm'         :{item:'16',Tipo:'',Valr:' ',Cust:'        ', Limit:['2,44 x 1,22'] , Mdds:['0,30 x 0,20']},
            }},
        'ímã'      :{Calc:'M2' , Stts:'Disp' , Prvw:'CanvMdd' , Desc:'Geladeira ou Carro'   , Forn:['Grafit','BPrint','Tatiane'  ] , Prdc:['Arte','Aplicação','Reflie'                 ] , Extra:['Manta'     ] , HotKey:["magneto", 'manta magnética'             ] ,
                        Variantes:{ // Adicional de Calendário (Acima de 500 UND)
                            '0.3 - Geladeira' :{item:'19',Tipo:'',Valr: 70.00+60,Cust:35.00 , Limit:['0,00 x 0,60'] , Mdds:['0,05 x 0,06']}, // 0.3 - R$ 21,00 (0,60 x 1,00) || o Metro fica: 
                            '0.4 - Geladeira' :{item:'20',Tipo:'',Valr: 95.00+60,Cust:48.33 , Limit:['0,00 x 0,60'] , Mdds:['0,05 x 0,06']}, // 0.4 - R$ 29,00 (0,60 x 1,00) || o Metro fica: 
                            '0.8 - Carro'     :{item:'21',Tipo:'',Valr:180.00+60,Cust:98.33 , Limit:['0,00 x 0,60'] , Mdds:['0,60 x 0,30']}, // 0.8 - R$ 59,00 (0,60 x 1,00) || o Metro fica: 
            }},
        'Recorte'  :{Calc:'M2' , Stts:'Offf' , Prvw:'CanvMdd' , Desc:'Adesivo Recortado'    , Forn:['Stock'                      ] , Prdc:['Arte','Aplicação','Reflie'                 ] , Extra:[            ] , HotKey:["Ploter",'Lamina','Siluet','Vetor'       ] ,
                        Variantes:{
                            'Vinil'           :{item:'22',Calc:'M2',Tipo:'',Valr:150,Valor:70  , Limit:[] , Mdds:[]},
                            'Holografico'     :{item:'23',Calc:'M2',Tipo:'',Valr:200,Valor:100 , Limit:[] , Mdds:[]},
        }},
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        'Cartão'   :{Calc:'OFS', Stts:'Disp' , Prvw:''        , Desc:'Medida: 9cm x 5cn'    , Forn:['BPrint','Bureal'] , Prdc:[] , Extra:[] , HotKey:["cartão de visita", "business card", "papel", "folha"] , 
                        Variantes:{
                'Brilho'      :{Table:[
                    ['Frente' ,'250g',[['500', 90,31],['1.000',135,45]]],
                    ['F.Verso','250g',[['500',115,42],['1.000',150,54]]], 
                    ['Frente' ,'300g',[['500',130,49],['1.000',145,56]]], 
                    ['F.Verso','300g',[['500',150,58],['1.000',165,65]]], ]},
                'Brilho Local':{Table:[
                    ['Frente' ,'300g',[['500',155,62],['1.000',190,78]]],
                    ['F.Verso','300g',[['500',190,80],['1.000',230,99]]], ]},
            }},
        'Panfleto' :{Calc:'OFS', Stts:'Disp' , Prvw:''        , Desc:'Gramatura: 90g'       , Forn:['Bureal'         ] , Prdc:[] , Extra:[] , HotKey:["folheto", "papel", "informativo",'folha'] , 
                        Variantes:{
                '10 x 15':{Table:[
                    ['Frente' ,'90g',[['1.000',130, 67],['2.500',180, 85],['5.000' , 270,170],['10.000',650,340]]],
                    ['F.Verso','90g',[['2.500',280,135],['5.000',320,220],['10.000', 720,392]]], ]},
                '15 x 20':{Table:[
                    ['Frente' ,'90g',[['1.000',270,127],['2.500',340,170],['5.000' , 650,340],['10.000',900,600]]],
                    ['F.Verso','90g',[['2.500',500,270],['5.000',700,440],['10.000',1200,800]]], ]},
            }},
        'Talão'    :{Calc:'OFS', Stts:'Disp' , Prvw:''        , Desc:'Gramatura: 90g'       , Forn:['JLTal']           , Prdc:[] , Extra:[] , HotKey:[] , 
                        Variantes:{
                '10 x 15':{Table:[
                    ['Preto e Branco','1 Via',[['4',60,30],['8', 90,45],['12',130,65],['20',170, 85]]],
                    ['Colorido'      ,'1 Via',[['4',80,40],['8',110,55],['12',150,75],['20',200,100]]],
                    ['Preto e Branco','2 Via',[['4',75,35],['8',105,55],['12',145,70],['20',185, 80]]],
                    ['Colorido'      ,'2 Via',[['4',95,45],['8',125,65],['12',165,85],['20',215,110]]],
                ]},
                '15 x 20':{Table:[
                    ['Preto e Branco','1 Via',[['2',60,30],['4', 90,45],['10',170, 85],['20',300,150]]],
                    ['Colorido'      ,'1 Via',[['2',80,40],['4',110,55],['10',200,100],['20',350,175]]],
                    ['Preto e Branco','2 Via',[['2',75,35],['4',105,55],['10',185, 90],['20',315,165]]],
                    ['Colorido'      ,'2 Via',[['2',95,45],['4',125,65],['10',215,110],['20',365,195]]],
                ]},
                '9 x 21' :{Table:[
                    ['Preto e Branco','1 Via',[['3',60,30],['6', 90,45],['9',130,65],['12',150,75]]],
                    ['Colorido'      ,'1 Via',[['3',80,40],['6',110,55],['9',170,85],['12',190,95]]],
                    ['Preto e Branco','2 Via',[['3',75,35],['6',105,55],['9',145,70],['12',165, 80]]],
                    ['Colorido'      ,'2 Via',[['3',95,45],['6',125,65],['9',185,85],['12',205,100]]],
                ]},
        }},
        'Tag'      :{Calc:'OFS', Stts:'Offf' , Prvw:''        , Desc:'Gramatura: 90g'       , Forn:['Bureal'         ] , Prdc:[] , Extra:[] , HotKey:["etiqueta", "rótulo", "marcador",'furo'  ] , 
                        Variantes:{
                    'Reto' :{},
                    'Curva':{},
            }},
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        'Cardápio' :{Calc:'OFS', Stts:'Offf' , Prvw:''        , Desc:'Gramatura: 90g'       , Forn:['BPrint']          , Prdc:[] , Extra:[] , HotKey:["menu", "lista de pratos", "menu de restaurante", "opções de comida", "restaurante", "cozinha"] ,
                        Variantes:{
                    '1Pag':{},
                    '2pag':{},
        }},
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        'Camisa'   :{Calc:'QNT', Stts:'Offf' , Prvw:''        , Desc:'Sublimação Total'     , Forn:['Inová']   , Prdc:[] , Extra:[           ] , HotKey:["blusa", "camiseta", "roupa", "estampa", "moda", "vestuário","Pano","Tecido"] ,
                        Variantes:{
            'M.Curta'  :{Tipo:'',Tamn:['PP','P','M','G','GG'],Valr:['Helanquinha','Dry Furado'],Valor:0,},
            Regata     :{Tipo:'',Tamn:['PP','P','M','G','GG'],Valr:['Helanquinha','Dry Furado'],Valor:0,},
            Polo       :{Tipo:'',Tamn:['PP','P','M','G','GG'],Valr:['                        '],Valor:0,},
            'M.Longa'  :{Tipo:'',Tamn:['PP','P','M','G','GG'],Valr:['Helanquinha','Dry Furado'],Valor:0,},
        }},
        'Calção'   :{Calc:'QNT', Stts:'Offf' , Prvw:''        , Desc:'Sublimação Total'     , Forn:['Inová']   , Prdc:[] , Extra:[           ] , HotKey:['Short','Sublimação','roupa','pano'] ,
                        Variantes:{
                'Bermuda' :{},
                'Short'   :{},
        }},  
        'WindFlag' :{Calc:'QNT', Stts:'Offf' , Prvw:''        , Desc:'Tecido: Oxford'       , Forn:['NovaImp'] , Prdc:[] , Extra:[{'Base':80}] , HotKey:['Sublimação',"Pano","Tecido",'BigFlag','WindBanner','Bandeira do Vento'] ,
                        Variantes:{
            Faca         :{Tipo:['P','M','G'],Valr:0,Cust:0},
            Vela         :{Tipo:['P','M','G'],Valr:0,Cust:0},
            Pena         :{Tipo:['P','M','G'],Valr:0,Cust:0},
            Gota         :{Tipo:['P','M','G'],Valr:0,Cust:0},
            }},
        'BigBall'  :{Calc:'QNT', Stts:'Offf' , Prvw:''        , Desc:'Tecido: Oxford'       , Forn:['NovaImp'] , Prdc:[] , Extra:[{'Base':80}] , HotKey:['Sublimação',"Pano","Tecido"] ,
                        Variantes:{
                P         :{Tipo:[''],Valr:0,Cust:0},
                M         :{Tipo:[''],Valr:0,Cust:0},
                G         :{Tipo:[''],Valr:0,Cust:0},
            }},   
        'Bandeira' :{Calc:'QNT', Stts:'Offf' , Prvw:''        , Desc:'Tecido: Oxford'       , Forn:['Inová']   , Prdc:[] , Extra:[           ] , HotKey:['Sublimação',"Pano","Tecido"] ,
                        Variantes:{
                'Oxford' :{},
                'Cettin' :{},
        }},    
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
        'Arte'           :{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['Arte']      ,
        Variantes:{
                    'Reto' :{}}
        },
        'Router'         :{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['Barraca','Jailson']      ,
        Variantes:{
                    'Reto' :{}}
        },
        'Envelopamento'  :{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['Stock']      ,
        Variantes:{
                    'Reto' :{}}
        },
        'Serigrafia'     :{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['Stock']      ,
        Variantes:{
                    'Reto' :{}}
        },
        'Figurinha'      :{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['Stock']      ,
            Variantes:{
                    'Reto' :{}}
        },
        'Topo de Bolo'   :{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['BPrint']      ,
            Variantes:{
                    'Reto' :{}}
        },
        'Vendas'         :{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['Stock']      ,
        Variantes:{
                    'Reto' :{}}
        },
        'Placa'          :{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['-']      ,
        Variantes:{
                    'Reto' :{}}
        },
        'sinalização'    :{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['-']      ,
        Variantes:{
                    'Reto' :{}}
        },
        'Cartela'        :{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['Stock']      ,
        Variantes:{
                    'Reto' :{}}
        },
        'Plotagem'       :{Calc:'UND', Stts:'Offf' , Prvw:'' , Forn:['Stock']      ,
        Variantes:{
                    'Reto' :{}}
        }
        }

    const ListaFora = ['Arte','Router','Envelopamento','Serigrafia','Figurinha','Topo de Bolo','Vendas','Placa','sinalização','Cartela','Plotagem']
    
    // Const Importante pra Compilar a Tabela pra deixa o Load Mais Rápido
    const EtrProd = ObjEtr(Prod)
    const AllProd = ObjKey(Prod)
    const HotKy   = Object.fromEntries(EtrProd.map(([k,v])=>[k,v.HotKey||[]]))
    const AllForn = Object.fromEntries(EtrProd.map(([k,v])=>[k,v.Forn  ||[]]))
    const Vari=e=>ObjKey(Prod[e].Variantes)
    const AllList = ObjKey(O)
    const AllClnt = Uniq(J.CLNT.map(E=>E['Clnt']))

    const D = {PDDS:0,SERV:0,CLNT:0,PGMT:0,GRAD:0,OOSS:0,UBER:0,MPAG:0,CUST:0}
        
    const CRYPP = {F:'Fixo',B:'Bndj',S:'Slct',A:'Auto',C:'Chek',G:'Sugg',M:'Imgs',E:'Edit',T:'Grds',V:'Valr',D:'Data',O:'Soma',X:'Lixo'}
    const BS = {
        PDDS:{Id:['F',''], Lin:['E',''],Data:['D',''],Clnt:['B',''],Serv:['B',''],Valr:['O',''],Pgmt:['B',''],Cust:['B',''],Finc:['B',''],Stts:['S',''],Lixo:['X','']},
        SERV:{Id:['F',''],Data:['D',''],Clnt:['B',''],Serv:['S',''],Desc:['E',''],Calc:['B',''],Valr:['V',''],Dsng:['S',''],Arte:['M',''],Forn:['S',''],OK:['C',''],Entregue:['C',''],DataEntg:['E',''],Grad:['E',''],OS:['E',''],Uber:['E',''],Coment:['E',''],'Lixo':['X','']},
        PGMT:{Id:['F',''],Data:['D',''],Clnt:['B',''],Valr:['V',''],Form:['S',''],Desc:['E',''],Stts:['E',''],Link:['E',''],Mpag:['G',''],Lixo:['X','']},
        CUST:{Id:['F',''],Data:['D',''],Item:['E',''],Valr:['V',''],Forn:['S',''],Dstn:['E',''],Pcnt:['A',''],Lixo:['X','']},
        FINC:{Valr:['F',''],Cust:['F',''],Lcro:['F','']},

        CLNT:{ID:['F',''],Clnt:['E',''],Cmpt:['E',''],Cntt:['E',''],Lcal:['E',''],Loja:['E',''],CtLj:['E',''],Cat: ['E',''],Stts:['E',''],Link: ['E',''],Lixo:['X','']},
        GRAD:{ID:['F',''],Data:['D',''],Emal:['E',''],Forn:['S',''],OS  :['E',''],Nome:['T',''],Cont:['E',''],Uber:['E',''],Valr:['E',''],Valr2:['E',''],NSrv:['E',''],Link:['G',''],Imag:['M',''],Lixo:['X','']},
        UBER:{ID:['F',''],Data:['D',''],Dest:['E',''],Hora:['E',''],Valr:['E',''],Dirc:['E',''],Prds:['E',''],Desc:['E',''],Grad:['E',''],Link: ['G',''],Lixo:['X','']},
        MPAG:{Id:['F',''],Data:['D',''],Clnt:['E',''],Valr:['E',''],Hora:['E',''],Form:['E',''],Mpag:['E',''],Link:['G',''],Lixo:['X','']}, // Removi 'Cpvt'
        OOSS:{ID:['F',''],Nome:['E',''],Link:['E',''],Desc:['E',''],Lixo:['X','']},
        CALC:{}
    }

    const ListaKits=['Zebu','Zimaz',]

    const JServ = NovoJson.flatMap(obj=>obj.Serv)
    const JPgmt = NovoJson.flatMap(obj=>obj.Pgmt)

    let todoTitle = {Serv:[],Cust:[],Finc:[],Soma:[],Calc:[]}
</script>

<script> // Bibliotecas Curta
    const Dat=e=>new Date(e)
    const Rx2=arry=>Rx(['Rastr',...arry])
    const OjKy=Typ=>ObjKey(BS[Typ])
    const ExtObj=Obj=>[0,1,2].map(i=>ObjVal(Obj).map(arr=>arr[i]))
    const D_Rastr=e=>Extrat_Clss(e,'Rastr-').split('-') // Simplificar pra D_R e incluir closeset aqui dentro mesmo, caso precise.
    const TogTd=e=>$('input',e)!==event.target && TogNoSh([$('input', e),$('p',e)])
    const ALERT=e=>{Inn('#ALERT span',JSON.parse(e).Dados.map(e=>`<div style="margin:3px">"${e}"</div>`).join(''));ShowTime('#ALERT',3)}
    const RgxPixAV=e=>e.trim().match(/(\d+[\.,]?\d*)([a-zA-Z]+)/) || []
    const SunPix=Stg=>Stg.split('|').map(p=>parseFloat(p.replace(/[^\d.,]/g,'').replace(',','.'))||0).reduce((sum,n)=>sum+n,0)
    const J_Filt=(Typ,e)=>J[Typ].filter(E=>E.ID==(e+"|").split('|')[0])
    const J_Find=(Typ,e)=>J[Typ].filter(E=>E.ID==(e+"|").split('|')[0])[0]
    const BSBS=(typ,x,idx)=>BS[typ][OjKy(typ)[x]][idx]
    const Coll=(x)=>`td:nth-child(${x})`
    const Col=(typ,col)=>`td:nth-child(${FIdx(OjKy(typ),col)+1})`
    function EnterBlur(e){KeyEntr(()=>e.blur())}
    const SERV_Find_CLNT=e=>J_Find('CLNT',J_Find('PDDS',e.ID).Clnt).Clnt
    const FindClnt=e=>J_Find('CLNT',e.Clnt).Clnt
    const Block=e=>e.style.display = 'block'
    const ConvertDATA=e=>/^\d{4}-\d{2}-\d{2}$/.test(e)?DMY(e):e
    const H_Col_p=(Typ,col)=>`#H_${Typ} > tbody > tr > ${Col(Typ,col)} p`
    const reorderArr_Arr = (arr,o)=>arr.map(e=>o.map(k=>e[arr[0].indexOf(k)]))
    const ContRepete=arr=>arr.reduce((acc,e)=>{acc[e]=(acc[e] || 0) + 1 ; return acc},{}) // conta quantas vezes um nome se repete num Array
    const getClass=(e,Stg)=>[...e.classList].find(c=>c.includes(Stg)) || null
    const tr_ID=tr=>getClass(tr,'tr-').replace('tr-','').trim()
    const minuscule = str => str[0].toUpperCase() + str.slice(1).toLowerCase()
    const LocPcnt = (parte,total) => (parte / total)
    const RGBa=(e,op=0.2)=>{const [r,g,b]=getComputedStyle(e).backgroundColor.match(/\d+/g) ; e.style.backgroundColor = `rgba(${r},${g},${b},${op})`}
    const Grifar=(e,Rgx)=>e.replace(Rgx,match=>`<strong style="background:orange" name="">${match}</strong>`)
    const EscpRgx=Stg=>Stg.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')
    function isImageLoaded(img){return img.complete && img.naturalWidth !== 0}

    function VAL(td){ // e deve ser um 'td'
        const R = D_Rastr(td) // se e for td entra 'e' se não for, faz o closeset('td') aqui dentro mesmo
        const val = R[3]==='Edit' ? $('.P-P',td).textContent.trim()
                  : R[3]==='Fx'   ? $('.P-P',td).textContent.trim()
                  : R[3]==='Sugg' ? $('.P-P',td).textContent.trim()
                  : R[3]==='Auto' ? $('.P-P',td).textContent.trim()
                  : R[3]==='SVG'  ? $('.P-P',td).textContent.trim()
                  : R[3]==='Soma' ? $('.P-P',td).textContent.trim()
                  : R[3]==='Data' ? $('.P-P',td).textContent.trim()
                  : R[3]==='Bndj' ? $('.P-P',td).textContent.trim()
                  : R[3]==='Valr' ? Num2($('.P-P',td).textContent.trim())
                  : R[3]==='Slct' ? $('select',td).value
                  : R[3]==='Inpt' ? $('input' ,td).value
                  : R[3]==='Chek' ? $('input' ,td).checked
                  : is(td,'input')? td.value
                  : R[3]==='Lixo' ? '-'
                  : null
        return val
    }
</script>

<script> // Bibliotecas Longa
    //Evento de Click na Página inteira, com a intenção de Ocultar tudo que for Bandeijas
    function NoneBndj(){if(event.target.closest('.bndj')||event.target.classList.contains('NObj')){return}else{None($$('.bndj'))}}
    const Trc2=(e,add,rmv)=>{Add($(e),add);Rmv($(e),rmv)}
    const DarkLite2=(e,Check)=>{if(Check){Trc2(e,'Dark','Lite')}else{Trc2(e,'Lite','Dark')} ; console.log('Chamou DarkLite',e,Check)}
    const RandoCor=()=>'#'+Rndn(16777215).toString(16).padStart(6,'0')

    function ShowBndj(div){
        if(event.target.tagName=='IMG'){return}
        if(event.target.tagName== 'I' ){return}
        const e = $('.BNdj',div)
        if(e.contains(event.target)){return}else{ // esse IF ta dando erro se não existir eu acho (este if tem que seguir em frente caso seja o Svg da Seta)
            e.style.zIndex = $$('.BNdj:not(.none)').length + 500
            if(Tecla('ctrl')){Tog_N(e)}else{$$('.BNdj:not(.none)').forEach(E=>{if(E==e){return}else{Add_N(E)}});Tog_N(e)}}
        if(Tecla('ctrl')){return}
        else{ClickFora(div,()=>{Add_N(e)})}
    }
</script>

<div> <!--Todo Conteúdo Relacionado as Tabelas JS e CSS-->
    <style> /*Todo o CSS da Tabela*/
        .BNdj{transform:translate(-50%,0%); left:50%; z-index:500}
        .BNdj > a{position:absolute; bottom:100%; left:50%; transform:translate(-50%,0%) ; height:10px; z-index:1}

        .BndjSUG{padding:0px ; min-width: 200px}
        .BndjSUG > a{fill:#ff00c8}    
        .BndjSUG > i{background:#ff00c8; color:white; z-index:2 ; padding: 5px}

        .BndjTBL{padding:5px; background:#bb0092}
        .BndjTBL > a{fill:#bb0092}

        .ThFilt > i{position:absolute; cursor:pointer; font-size:9px; right:0px; top:50%; transform:translate(-0%,-50%)}
        .ThFilt > b.Atv{position:absolute; background:#0c8f00; border-radius:255px; width:15px; height:15px; text-align:center; top:-5px; right:29px}
        .ThFilt > b.Rtv{position:absolute; background:#ff0000; border-radius:255px; width:15px; height:15px; text-align:center; top:-5px; right:10px}
        .ThFilt > div > div > .conffffff {background: #ff00c8; color: white; height: 24px}
        .ThFilt > div > div > .conffffff img{height:18px ; width:18px}
        .ThFilt > div > div > .conffffff span.Atv{fill: #ffff00; background: #00df00;}
        
        .ShodShod{width: 250px}

        .THSugg{border-radius: 0 0 10px 10px !important}
            .THSugg div:hover{background:#df4ccb; color: white}
            .THSugg div:hover div{opacity: 1}
            .THSugg div div{font-size: 15px;background: #d822ab; color: white !important; width: 18px; height: 18px; text-align: center; margin-left:10px ; opacity: 0}
        
        .Sugg{top:100%;left:0;right:0;max-height: 250px;overflow-y:auto;z-index: 500 ; width: 100%}
                .Lite .Sugg{background: #ffffff;border: 3px #ff00c8 solid ; color:#000000}
                .Dark .Sugg{background: #585858;border: 1px #2e2e2e solid ; color:#ffffff}
                .Sugg a p {padding: 3px}
                .Sugg a p:first-child {font-size: 10px; opacity: 0.6}
                    .Lite .Sugg a:hover {background: #ffaced}
                    .Dark .Sugg a:hover {background: #757575}

        .RecolorSelects{background:#f357d1}                    
        .ThFilt_Atv{background: #059b00; color: white}
        .ThFilt_Rtv{background: #ff0000; color: white}
        .Sugg_Atv  {background: #d822ab; color: white}

        .filtTrue{background: green !important; color: white;}
        .filtFals{background: red   !important; color: white;}
    </style>

    <script>// Template String v7.3
        const D_Rastr2=R=>R.split('-')
        const Tm_Rastr=(e,x,typ,id)=>`Rastr-${typ}-${e=='Foot'?'Foot':e[Array.isArray(e)?0:id]}-${OjKy(typ)[x]}-${CRYPP[BSBS(typ,x,0)]}` //Argumento 'id', recebe string 'ID' se for Obj, e recebe '0' se for array
        const Tm_Config=typ=>`<input type="checkbox" onchange="TrcTog($('#H_${typ}'),'hMin','hMax');SaveConfig()"> <input type="checkbox" onchange="Tog($('#H_${typ}'),'w100');SaveConfig()">`
        const Tm_tdFoot=(arr,Typ)=>arr.map((e,x)=>`<td class="${Tm_Rastr('Foot',x,Typ,'')}"></td>`).join('')
        const Tm_SuggCLNT=()=>`<div class="DivSugg Rltv"> <input class="w100" oninput="Sugg($Vl(this),J['CLNT'],'Clnt',SibQSl(this,'span'),'ClickSugg2');Nm(this,'')" onblur="" onkeydown="KeyEntr(()=>TesteClnt(this,this))" placeholder="Cliente"><span class="Sugg Shdw rd Abslt Cl none"></span></div>`
        
        const Tm_Table=(typ,arry)=>{ const IN = performance.now()
            const Tm_Tm = {
                Fixo:(e,R)=>`<p class="P-P Ct" name="${e}">${e}</p>`, // o Fixo também tem Data por isso tinha informação de data aqui
                Auto:(e,R)=>`<p class="P-P Ct" name="${e}">${e}</p>`,
                Soma:(e,R)=>{const FiltID=id=>NovoJson.find(e=>e.Id==id)?.Serv??null ; const soma = SOMA_Obj(FiltID(R[2]),'Valr') ;todoTitle['Soma'].push(soma) ; return `<p class="P-P Ct" onclick="CtrlSoma(this)" name="${soma}">R$ ${Cm(soma)}</p>`},
                Edit:(e,R)=>`<p class="P-P Ct" ${Edi} name="${e}" onkeydown="EnterBlur(this)" onblur="Rmv(_td(this),'Foco');EditCell(this)" onfocus="Add(_td(this),'Foco')">${e}</p>`,
                Valr:(e,R)=>`<p class="P-P Ct" ${Edi} name="${e}" onkeydown="EnterBlur(this)" onblur="Rmv(_td(this),'Foco');EditCell(this)" onfocus="Add(_td(this),'Foco');CurAll(this)" oninput="MaskR$(this)">${RS(e)}</p>`,
                Slct:(e,R)=>`<select class="P-P w100" onchange="EditCell(this)">${R[3]==='Serv' ? Tm_OptsGraff(['Serviços',...AllProd],e) : Tm_Opts(O[R[3]],e)}</select>`,
                Chek:(e,R)=>`<input  class="P-P"      onchange="EditCell(this)" type="checkbox" ${e===true?'checked':''}>`,
                Data:(e,R)=>`<p class="P-P Ct" name="${YMD(e)}" onclick="TrcFih(this)">${BrevData(DMY(e))}</p><input type="date" class="none" value="${YMD(e)}" onchange="EditCell(this)" onblur="TrcFih(this)">`,
                Imgs:(e,R)=>`<img onclick="AbrirImg(this)" draggable="false" src="./Base/${R[3]}/${e}">`,
                Lixo:(e,R)=>`<a onclick="RmvROW('${R[1]}','${e['Id']}',this)">${SVG.Lixo}</a>`,
                Grds:(e,R)=>`${e}`,
                Sugg:(e,R)=>`<div class="Rltv"><p class="P-P">${e}</p><div class="BNdj BndjSUG Abslt Cl none"><a>${SVG.Ponta}</a><span class="Sugg Shdw rd Cl"></span><i class="ppt Shdw rd Ct Hov" onclick="Linkar(this)">Linkar</i></div></div>`,
                        // se o Sugg tiver vazio deixar pelomenos uma mensagem avisando
                        // descobrir quem é quem do Sug, pelo título da coluna
                        // no Linkar deixar 2Botões abaixo, para tipo de Sugg, ou de Troca, ou de Adição       
            }

            function Tm_Bndj(arr,Typ){
                return `<table class="Bdj_${Typ} TableMORE"><thead><tr>${arr[0].map(t=>`<th>${t}</th>`).join('')}</tr></thead>
                                            <tbody>${arr.slice(1).map(LL=>`<tr class="tr-${LL[0]}">${LL.map((v,x)=>Tm_Td(v,LL,x,Typ,'vemBndj')).join('')}</tr>`).join('')}</tbody>
                                    </table> ${Typ==='CLNT'?'':`<div class="Nuevoevo RD Hov" onclick="NovaLinhaBDj(this)">Nova Linha +</div>`}`
                                    // conferir se typ é CLNT é desnessesário pois, logo logo Clnt vai ser subistidio por 'LINK'
            }

            function _Tm_Bndj(arry,r){ // esse R é o D_Raster

                const MORE2 =(arr,Typ)=>`<table class="Bdj_${'Calc'} TableMORE"><thead><tr>${['Larg','Alt','Qnt','Valor'].map(t=>`<th>${t}</th>`).join('')}</tr></thead>
                                        <tbody>${
                                            arr.map(LL=>`<tr class="tr-Mdds">${
                                                LL.map((v,x)=>`<td class="">${Tm_Tm['Edit'](v)}</td>`).join('') // se for o ultimo é R$ no caso valr
                                            }</tr>`).join('')
                                        }</tbody>
                                    </table>`

                const R = D_Rastr2(r)
                const Typ   = R[3]
                const Find  = Typ==='Clnt' ? J[Typ.toUpperCase()].filter(E=>E.ID==arry) : Typ==='Calc' ? arry.map(e=>e.split('|')) : arry

                const F2    = [ObjKey(Find).map(e=>e),ObjVal(Find).map(e=>e)] // coisa penas do 'Calc'

                const Title =   Typ==='Pgmt' ? Find.map(e=>`${e['Valr']}${ e['Form']}`).join(' | ') :
                                Typ==='Serv' ? Find.map(e=>`${e['Serv']} ${e['Desc']}`).join(' | ') :
                                Typ==='Cust' ? Find.map(e=>`${e['Valr']}`).join('') :
                                Typ==='Finc' ? Find.map(e=>`${e['Lcro']}`).join('') :
                                Typ==='Calc' ? `${Find.Qnt||'_'} - ${Find.Lag||'_'}x${Find.Alt||'_'}${Find.Val==''?'':` R$ ${Cm(Find.Val||'0')}`}` :
                                            Find.map(e=>e[R[3]]).join(' | ').replace('_ - _x_ R$ 0,00','')

                
                if(Title!=''){
                        if(['Cust','Finc','Calc'].includes(Typ)){
                            todoTitle[Typ].push(Title)}
                }
                
                Typ=='Serv' ? Find.map(e=>`${todoTitle[Typ].push(e['Serv'])}`) : null
                
                
                const NewPg = Typ==='Pgmt' && Title==='' ? '-' : ''
                const Reordem =()=>{if(Typ=='Serv'||Typ=='Pgmt'){
                    return reorderArr_Arr(ArrObj_ArrArr(Find),ObjKey(BS[Typ.toUpperCase()]))
                    }else{return ArrObj_ArrArr(Find)}} 

                const Lista = Typ==='Calc' ?  MORE2(Find,'SERV') : Find.map((e,x)=>x===0 ? Tm_Bndj(Reordem(),Typ.toUpperCase()) : '').join('')
                const iconFone = Typ==='Clnt'? Find[0] ? Find[0].Cntt==='' ? '' : `<img class="icoFone HOV" onclick="console.log('FONE')" src="./SVG/Icon_Fone.svg">`:'' : ''
                const ConcatIMG = Typ==='Serv'? Find.map(e=> `<img onclick="AbrirImg(this)" src="./Base/Arte/${e['Arte']}">`).join('|') : ''

                return `<div class="Ct"><p class="P-P" ${Typ==='Pgmt'?`name="${SunPix(Title)}"`:`name="${Title}"`}>${Title}</p>${iconFone}${ConcatIMG}</div>
                            <div class="Rltv w100">
                                <div class="BndjTBL BNdj Abslt Shdw none rd Cl">
                                    <a>${SVG.Ponta}</a>
                                    ${NewPg==='-' || Title==='-'?'<a class="FikaFika"></a>':Lista}
                                </div>
                            </div>`

                // o Zindex é o segfuinte o ultimo selecionado fica na Frente! e isso fica interessante ser exibido na hora do ShowBndj() pq funcionará para Bandejas e Filters
            }

            function Tm_Td(v,e,x,Typ,dado){const R = Tm_Rastr(e,x,Typ,'Id') ; const dR = D_Rastr2(R)
                return dR[4]=='Bndj'? `<td class="${R}" onclick="ShowBndj(this)">${_Tm_Bndj(v,R)}</td>` :
                       dR[4]=='Sugg'? `<td class="${R}" onclick="ShowBndj(this);SuggLink(this,'${R}')"><div class="Ct">${Tm_Tm[dR[4]](v,dR)}</div></td>`
                                    : `<td class="${R}"><div class="Ct">${Tm_Tm[dR[4]](v,dR)}</div></td>`
            }

            const Retorno = arry.map(e=>`<tr class="tr-${e.Id}">${ObjOrdn(e,OjKy(typ)).map((v,x)=>Tm_Td(v,e,x,typ,'')).join('')}</tr>`).join('')

            console.log(`⏱️ Tm_Table(${typ}): ${(performance.now()-IN).toFixed(2)}ms`) // 179.10ms // 164.70ms
            return Retorno
            
            // Tipo de BndjTable = Array interno, ou Array de Fora
            
            // $$(Rx2(['GRAD','Grds'])).forEach(e=>Inn(e,Inn(e).split('|').map(E=>`<a>${E.trim()}</a>`).join('')))
            // $$(Rx2(['GRAD','Cont'])).forEach(e=>Inn(e,`<p>${$$(`${Col('GRAD','Nome')} a`,_tr(e)).length}</p>`)) // Independente do q foi passado Genérioco, este aqui reescreve por cima!
            // $$(Rx2(['SERV','Grad'])).forEach(e=>{$('p',e).innerHTML = J['GRAD'].filter(E=>E.ID==$('p',e).innerHTML).map(E=>`${E.Forn}-${$('p',e).innerHTML}`)})
        
            // Mudei de idéia sobre a bandeija de medidas (ela só vai existir quando o pedido for realmente muito variado) fora isso, cada linha representará um unico serv, igual ta na pag orçamento
            // Transitar com as Setinhas na tabela do APP igual na Planilha
        }

        function Format_Bndj_Clnt(){ // inputs quando tiver Vazio, e alterar Cliente
            $$(`.FikaFika`).forEach(e=>{
                const R = D_Rastr(_td(e))
                if(R[2]==='Pgmt'){e.innerHTML = `<div class="LugyLygy"><input placeholder="0Av | 0Pix" onblur="EditCellFake2(this)" onkeydown="KeyEntr(()=>{None(Bzv(this))})"></div>`} // no caso o Lance de quando estiver vazio, (provavelmente se tiver vazio nem roda a Bandeja, pula direto pra isso!)
                if(R[2]==='Clnt'){e.innerHTML = `<div class="LugyLygy">${Tm_SuggCLNT()}</div><a class="sppns none" onclick="EditCellFake(this)"></a>`} // aqui a mesma coisa do de cima
            })
            $$(`#H_PDDS ${Rx2(['CLNT','ID'])}`).forEach(e=>{ // é melhor mudar isso pra um botão abaixo, com nome de trocar cliente, e ai carrega a Lista pra eu escolher (Lista com tudo, nome contato e tudo mais)
                Inn(e,`<p class="Ct" onclick="None($$('.LugyLygy'));Show(SibNxt(this))">${$('p',e).innerHTML}</p>
                            <div class="LugyLygy Abslt none">${Tm_SuggCLNT()}</div>
                            <a class="sppns none" onclick="EditCellFake(this)"></a>`)})                    
        }

    </script>

    <script> // Manipulações Simples
        function CtrlSoma(Eu){Tog(Eu,'SelectSoma');Inn('#Sommma',`Soma: ${RS(SOMA($$('.SelectSoma').map(e=>Nm(e))))}`)}

        document.addEventListener('DOMContentLoaded', function(){
            document.addEventListener('keydown',function(event){
                if(event.key==='Escape'){
                    if(EShow($('#FModal'))){return}
                    else{$$(`${Atual.Pag} .BNdj`).forEach(e=>Add_N(e))}
                }
                // LimparFiltro(Atual.Pag) // se for outro botão
        })})

        function Pesquisa(Val,Typ){
            const Aa=$('.Pesq-Aa')?'':'i' ; const A_=$('.Pesq-A_')?'\\b':''
            const regex = new RegExp(`${A_}${EscpRgx(Val)}${A_}`,Aa)
            $$(`#H_${Typ} > tbody > tr`).forEach(tr=>{
                const Cnct = $$(':scope > td',tr).map(td=>VAL(td)).join('#')
                $$(":scope > td > .P-P",tr).forEach(Rx=>{Rx.innerHTML = Grifar(Rx.textContent,regex)}) // Grifar
                if(regex.test(Cnct)){Rmv_N(tr)}else{Add_N(tr)}                                         // Ocultar
            })
            Rfresh_Foot() // RealTime()
            // if(se for com conteudo da bandeja){faz o devido concat}
            // fazer ela funcionar rpa todas as tabelas, e pra Produtos também
            // as funcionalidades de 'Aa' e de 'A_' também podem existir dentro dos FIltros Th então transofrma o match em uma função global
        }
    </script>

    <script> /* FILTROS*/ console.log('xupa lil')
        //Conteudo Possível pra Bibliotecas
            function checkThFilt(){$$('.ThFilt').forEach(th=>{$$('a p',th).forEach(e=>e.style.display = th.offsetWidth < 300 ?'none':'block')})}
            window.addEventListener('load', checkThFilt)
            window.addEventListener('resize', checkThFilt)
        // se a bandeijinha quebrar Linha então aumenta ela se não fica tamanho da Div
        // Exibir a quantidade de clientes Visiveis
        // remover Abreviação dos Thead se precisar
        // Maior < Menor > f

        const Tm_thSort=arr=>arr.map((e,x)=>`<th class="ThFilt Rltv noslt" onclick="ShowBndj(this);OpcyFilt(_table(this).id)">
                                                    <p class="ppt">${e}</p>
                                                    <i onclick="OrdenarRows(this,'${x}','p')">▼</i>
                                                    <b class="Ct none Atv">0</b>
                                                    <b class="Ct none Rtv">0</b>

                                                    <div class="Rltv w100">
                                                        <div class="ShodShod BNdj Abslt Shdw none">
                                                            <div class="conffffff Ev"></div>
                                                            <span class="THSugg Sugg Shdw Cl">${e}</span>
                                                        </div>
                                                    </div>
                                            </th>`).join('') // P=Texto, i=▼, b=Notfi, a=Config, span=Sugg
        
        function PlvrLimp(arry,tipo){ // essa função é igual ao Trato()
            Valls =   tipo==='Valr' ? arry.map(e=>e.replace('R$','').trim())
                    : tipo==='Pgmt' ? arry.flatMap(e=>e.replace(/\d*/g,'').split(' | '))
                    : arry
            return Valls
        }

        function Palavras(Qry,tipo,modelo,typ){
            const IN = performance.now()                                
                const Clientes = ["ID","Clnt","Cmpt","Cntt","Lcal","Loja","CtLj","Cat","Stts","Lin","Link"]
                const Servicos = ['Id','Desc','Data','Valr','DataEntg','Grad','OS','Uber','Coment']
                const Pagament = ['Id','Desc','Data','Link','Mpag','Valr']
                const Pedidoss = ['Id','Lin','Data']
                const Mercapag = ['Id','Data','Valr','Hora','Mpag','Link']

                const Trato=(val,tipo)=>{ // essa função é igual a PlvrLimp()
                    return  tipo=='Data' ? BrevData(DMY(val)) : // só esse q demora um pouquinho, se pá posso não abreviar
                            tipo=='Valr' ? Cm(val) :
                            val
                }
                const Valls =   tipo==='OK'        && typ=="H_SERV" ? ['True','False'] :
                                tipo==='Entregue'  && typ=="H_SERV" ? ['True','False'] : 
                                typ=="H_CLNT" && Clientes.includes(tipo) ? Uniq(J.CLNT.map(E=>E[tipo])) :
                                typ=="H_MPAG" && Mercapag.includes(tipo) ? Uniq(J.MPAG.map(E=>E[tipo])) :
                                typ=="H_SERV" && Servicos.includes(tipo) ? Uniq(NovoJson.flatMap(e=>e['Serv'].map(E=>Trato(e[tipo],tipo)))) :
                                typ=="H_PGMT" && Pagament.includes(tipo) ? Uniq(NovoJson.flatMap(e=>e['Pgmt'].map(E=>Trato(e[tipo],tipo)))) :
                                typ=="H_PDDS" && Pedidoss.includes(tipo) ? Uniq(NovoJson.map(e=>Trato(e[tipo],tipo))) :
                                tipo=='Clnt' ? AllClnt :
                                ['Cust','Finc','Calc'].includes(tipo) ? Uniq(todoTitle[tipo]) :
                                tipo==='Valr' && typ=="H_PDDS" ? Uniq(todoTitle['Soma'].map(e=>Cm(e))) :
                                tipo==="Serv" ? Uniq(todoTitle[tipo]) :
                                AllList.includes(tipo) && modelo==='Limpar' ? Uniq($$(Qry).map(e=>e.innerText)) : // PEZADO
                                AllList.includes(tipo) ? O[tipo] :
                                ['Nada']

                const Perform = (performance.now()-IN).toFixed(2)
                Perform < 0.5 ? null : console.log(`⏱️ Palavras(${typ},${tipo}): ${Perform}ms`)
                return Valls
        }

        function Tm_Filt(){ const IN = performance.now() // Função q depende q a Tabela Carregue primeiro pra depois ser Chamada
            $$('#PAGES > div > table > thead > tr > th .THSugg').forEach(th=>{
                const tipo = Inn(th)
                const qry   = `#${_table(th).id} > tbody > tr > td:nth-child(${IdxDe(_th(th))+1}) > div > .P-P`
                const Qry_N = qry.replace('tr','tr:not(.none)')

                $('.conffffff',_th(th)).innerHTML = `
                                        <span class="HOV ppt Ct" onclick="FiltrarFiltro(this,'Todos')"                             ><img src="./SVG/Icon_Todos.svg">     <p class="none">Todos     </p> </span>
                                        <span class="HOV ppt Ct" onclick="FiltrarFiltro(this,'${Qry_N}','${IdxDe(_th(th))+1}')"    ><img src="./SVG/Icon_Filtados.svg">  <p class="none">Filtados  </p> </span>
                                        <span class="HOV ppt Ct" onclick=""                                                        ><img src="./SVG/Icon_Lin.svg">                                      </span> 
                                        <span class="HOV ppt Ct" onclick="FiltRandon(this,'${Qry_N}')"                             ><img src="./SVG/Icon_Randomizar.svg"><p class="none">Randomizar</p> </span>
                                        <span id="icnFilt_${tipo}" class="HOV ppt Ct" onclick="Tog(this,'Atv')"                    ><img src="./SVG/Icon_Destacar.svg">  <p class="none">Destacar  </p> </span>
                                        `

                th.innerHTML =          `<div class="Ct w100">
                                            <div class="ppt RD HOV" onclick="FILT_Clik(this,'${qry}','-')">-</div>
                                            <p>'Vazio'</p>
                                            <div class="ppt RD HOV" onclick="FILT_Clik(this,'${qry}','+')">+</div>
                                        </div>`
                                        
                th.innerHTML += Palavras(qry,tipo,'',_table(th).id).filter(Boolean).map(e=>`
                                        <div class="Ct w100">
                                            <div class="ppt RD HOV" onclick="FILT_Clik(this,'${qry}','-')">-</div>
                                            <p>${e}</p>
                                            <div class="ppt RD HOV" onclick="FILT_Clik(this,'${qry}','+')">+</div>
                                        </div>`).join('')
            })
            // se existir Vazio exibe no Filt se n existir não mostra nada, mostra só a Lista normal
            console.log(`⏱️ Tm_Filt(): ${(performance.now()-IN).toFixed(2)}ms`)
        }

        function AtivFiltroGeral(Typ){ // Conciderar os 2 Clitérios Livres, ou Aninhados
            $$('.ThFilt_Atv').forEach(e=>DispClick($('div',Pai(e))))
        }// Rascunho

        function FiltrarFiltro(btn,Qry,Col){
            const ThSug = $('.THSugg',_th(btn))
            const FotBndj = Col ? $(`:scope > tfoot > tr > td:nth-child(${Col}) .footbndjj`,_table(btn)) : null
            const arry    = FotBndj ? $$('span',FotBndj).map(s=>s.innerText.split(':')[0]) : null
            const tipo = $('p',_th(btn)).innerText
            const Plvrs   = !arry && PlvrLimp(Palavras(Qry,tipo,'Limpar'),tipo)
            console.log('tem? ',Plvrs)
                $$('p',ThSug).forEach(E=>{
                    if(Qry==='Todos'){Rmv_N(Pai(E))
                    }else if(arry){
                        if(arry.includes(E.innerText)){Rmv_N(Pai(E))
                        }else{Add_N(Pai(E))}               // da pra remover isso
                    }else if(Plvrs.includes(E.innerText)){Rmv_N(Pai(E))
                    }else{Add_N(Pai(E))}                   // da pra remover isso
                })
        }

        function OpcyFilt(Typ){
            const Valid = $$(`#${Typ} .ThFilt b`).some(e=>e.innerText!=0)
            const Icon1 = $$(`#${Typ} .ThFilt .BNdj > div span:nth-child(1)`)
            const Icon2 = $$(`#${Typ} .ThFilt .BNdj > div span:nth-child(2)`)
            const Icon3 = $$(`#${Typ} .ThFilt .BNdj > div span:nth-child(4)`)
            const Icon4 = $$(`#${Typ} .ThFilt .BNdj > div span:nth-child(5)`)
            if(Valid){
                  Icon2.forEach(e=>e.style.opacity = 1)
            }else{Icon2.forEach(e=>e.style.opacity = 0.4)}
        }

        function FILT_Clik(Eu,Qry,Clik){event.preventDefault() // Função PEZADA
            
            const PP = $('p',Pai(Eu)) // Valor Clicado
            if(Clik=='+'){if(PP.classList.contains('ThFilt_Rtv')){Rmv(PP,'ThFilt_Rtv')}else{Tog(PP,'ThFilt_Atv')}} // Decide se é +
            if(Clik=='-'){if(PP.classList.contains('ThFilt_Atv')){Rmv(PP,'ThFilt_Atv')}else{Tog(PP,'ThFilt_Rtv')}} // Decide se é -

            const Notifi=e=>{const l = $$(`.ThFilt_${e}`,_th(Eu)).length ; const n = $(`b.${e}`,_th(Eu)) ; if(l==0){None(n)}else{Show(n)} ; Inn(n,l) } // Atualiza Notificações + ou -
            Notifi('Atv') ; Notifi('Rtv')

            const thcomfilt = $$('.ThFilt',_table(Eu)).filter(th=>$$('b',th).some(b=>Inn(b)!=='0')).map(e=>_th(e)) // todos os th q estão com algum filro ativo
            const Maisde1 = thcomfilt.length > 1 // Conferir se só tem apenas 1 Filtro Ligado

            const Ativos = $$('.ThFilt_Atv',_th(Eu)).map(e=>Inn(e)).join('|') ; const RxAtv = new RegExp(Ativos,'i')
            const Rtivos = $$('.ThFilt_Rtv',_th(Eu)).map(e=>Inn(e)).join('|') ; const RxRtv = new RegExp(Rtivos,'i')

            const Corlor = $(`#icnFilt_${Inn($('p',_th(Eu)))}.Atv`)
            const nenhuma = ['ThFilt_Atv','ThFilt_Rtv'].every(c=>!PP.classList.contains(c))

            const Qry_N = Qry.replace('tr','tr:not(.none)') // Aplicar apenas para Linhas Visiveis

            console.log('Atv:',Ativos,' - Rtv:',Rtivos)

            const Add_C=e=>{Add(e,'filtTrue');Rmv(e,'filtFals')}
            const Rmv_C=e=>{Rmv(e,'filtTrue');Add(e,'filtFals')}

            if(Maisde1){ // usa - Qry_N // Roda apenas nas Visiveis (quando tem mais de 1) (ou Opicional)
                $$(Qry).forEach(e=>{ 
                    const VaL = VAL(_td(e))
                    
                    if(Inn(PP)=="'Vazio'" && VaL==''){ Corlor ? Add_C(_tr(e)) : Add(_tr(e),'filtTrue') }
                    if(Inn(PP)==VaL && nenhuma){Rmv(_tr(e),'filtFals') ; return}
                    if(Ativos=='' && Rtivos==''){
                        Add(_tr(e),'filtTrue') ; Rmv(_tr(e),'filtFals')
                    }else{
                        if(_tr(e).classList.contains('filtFals')){return}

                        if(Ativos!=='' && RxAtv.test(VaL)){if(Corlor){Add_C(_tr(e))}else{
                            Add(_tr(e),'filtTrue');Rmv(_tr(e),'filtFals')}
                        }
                        else if(Rtivos!=='' && RxRtv.test(VaL)){if(Corlor){Add_C(_tr(e))}else{
                            Add(_tr(e),'filtFals');Rmv(_tr(e),'filtTrue')}
                        }
                        else{
                            if(Ativos!==''){Add(_tr(e),'filtFals')}
                            if(Rtivos!==''){Add(_tr(e),'filtTrue')}

                            }
                    }
                })

            }else{  // usa - Qry  // Roda em Todos (geralmente quando tem apenas 1 ou Zero) (ou Opicional)
                $$(Qry).forEach(e=>{ 
                    const VaL = VAL(_td(e)) || "'Vazio'"
                    const tr = _tr(e)
                    if(Ativos=='' && Rtivos==''){Rmv_N(tr)
                    }else{
                        if(Ativos!=='' && RxAtv.test(VaL)){
                            if(Corlor){Add_C(tr)}else{Rmv_N(tr)}
                        }
                        else if(Rtivos!=='' && RxRtv.test(VaL)){
                            if(Corlor){Add_C(tr)}else{Add_N(tr)}
                        }
                        else{
                            if(Corlor){Rmv_C(tr)}else{
                                if(Ativos!==''){Add_N(tr)} ; if(Rtivos!==''){Rmv_N(tr)}
                            }
                            
                        }
                    }
                })
            }


        //    Rfresh_Foot() // RealTime()
        }

        function FiltRandon(Eu,Qry,Clik){ // Funcionando Muito bem, depois EVOLUIR...
            const objClnt=()=>$$(Qry).map(e=>Inn(e))
            let NewObj = {}
            const QntCores = Uniq(objClnt()).length
            const CoresEtr = ObjEtr(ContRepete(objClnt())).sort((a,b)=>b[1]-a[1]).forEach(([k,v])=>{
                if(true){NewObj[k]=RandoCor()}  // cor Randon
                else{NewObj[k]=v}               // do maior pra o menor
                                                // corsin Cor Não
            })
            $$(Qry).forEach(e=>{_tr(e).style.background = NewObj[Inn(e)]})
        }

        function LimpaThAtv(){$$('.ThFilt_Atv').forEach(e=>Rmv(e,'ThFilt_Atv')) ; $$('.thNotif').forEach(e=>Add_N(e))}
        function LimparFiltro(Typ){
            Rmv_N($$(`#H_${Typ} tr`))
            $$('.ThFilt b').forEach(e=>None(e))
            $$('.SelectSoma').forEach(e=>Rmv(e,'SelectSoma')) // também remover aquele vermelho da Soma
            LimpaThAtv()
        //    Rfresh_Foot() // RealTime()
        }
    </script>

    <script> // SUGGLINK
        function SuggLink(Eu,R){ // será Exibido no Span todas as Linhas de uma determinada tabela
            const [aa,Tbl,cc,Typ,dd]=D_Rastr2(R)

            const Fillt=e=>{
                return  Typ=='Serv' ? e.Grad=='' && !['Stock','Arte','-'].includes(e.Forn) :
                        Typ=='Pgmt' ? e.Mpag=='' && e.Form!='Av' :
                        Typ=='Grad' ? Dat(e.Data) <= Dat(VAL($(`${Col('UBER','Data')}`,_tr(Eu)))) && VAL($(`${Col('UBER','Prds')}`,_tr(Eu))).split(',').includes(e.Forn) :
                        true
            }

            if(Typ=='Mpag'){
                console.log(Eu,Typ)
                console.log(J[Typ.toUpperCase()].filter(e=>Fillt(e)))
                $('span',Pai(Eu)).innerHTML = J[Typ.toUpperCase()].filter(e=>Fillt(e)).map(e=>`<div><a onclick="Tog(this,'Sugg_Atv')">${
                    Typ=='Mpag' ? `${e.Id} - ${e.Clnt}, ${e.Valr} ${e.Form}`:``
                }</a></div>`).join('')

                // deixar disponivel os que eu permito selecionar mais de 1

            }/*else if(Typ=='Grad'){
                SibQSl(Eu,'span').innerHTML = `<table class="w100">${J[Typ].filter(e=>Fillt(e)).map(e=>{
                    return e.Nome.split('|').map(s=>`<tr onclick="Tog(this,'Sugg_Atv')"><td>${e.ID}</td><td>${DMY(e.Data)}</td><td>${s}</td></tr>`).join('')
                }).join('')
                }</table>`
            }else{
                console.log(J[Typ].filter(e=>Fillt(e)))
                SibQSl(Eu,'span').innerHTML = J[Typ].filter(e=>Fillt(e)).map(e=>`<div><a onclick="Tog(this,'Sugg_Atv')">${
                Typ=='SERV' ? `${e.ID} - ${SERV_Find_CLNT(e)} ${e.Serv} ${e.Desc}` :
                Typ=='PGMT' ? `${e.ID} - ${FindClnt(e)} - R$ ${e.Valr} (${e.Form}) ${e.Data}` :
                ``
                }</a></div>`).join('')
            }
                */
        }

        function Linkar(Eu){
            if(_table(Eu).id == 'H_MPAG'){
                EditCell(Eu,$$('.Sugg_Atv',Pai(Eu)).map(e=>Inn(e).split('-')[0].trim()))
            }
            if(_table(Eu).id == 'H_GRAD'){
                const ArryAntg = Inn($('p',Eu.closest('td'))).split(',')
                const NovoArry = $$('.Sugg_Atv',Pai(Eu)).map(e=>Inn(e).split('-')[0].trim())
                if(Inn($('p',Eu.closest('td')))=='-'){
                    EditCell(Eu,NovoArry)
                }else{
                    EditCell(Eu,[...ArryAntg,...NovoArry])
                }
                
            }
            else{
                console.log($('span',Pai(Eu)))}
        }
    </script>

    <script> // RECOLOR
        function Rfresh_Color(){ // também tem de   [separar Tipos, Agrupar, Ordenar,status conclusão]
            const IN = performance.now()
            const Typ  = 'PDDS'
            const CC = {
                SERV:[
                    {Forn:["['Stock','Arte'].includes()",                            'Stok','Formt_Azul'],OK:['==true'],Entregue:['==true'],DataEntg:[`!==""`],Grad:[` ==""`]}, // O Primeiro Define a cor, o Resto Define a Intencidade  
                    {Forn:["['Grafit','BPrint','Inová','Bureal','JLTal'].includes()",'Grad','Formt_Verd'],OK:['==true'],Entregue:['==true'],DataEntg:[`!==""`],Grad:[`!==""`]}, // O Primeiro Define a cor, o Resto Define a Intencidade  
                    {Forn:["['Varyus'].includes()"                                 ,'Varys','Formt_Verd'],OK:['==true'],Entregue:['==true'],DataEntg:[`!==""`],Grad:[`!==""`]}, // O Primeiro Define a cor, o Resto Define a Intencidade  
                ],
            }
            $$(`#H_PDDS > tbody > tr`).forEach(tr=>Nm(tr,'')) // Limpar o Name de todas Linhas da Tabela
            $$(`#H_PDDS > tbody > tr`).forEach(tr=>{          // Percorrer Cada Linha
                const TD     =(stg)=>   $(`:scope > ${Col('PDDS',stg)}`     ,tr)
                const Td_Val =(stg)=>Nm($(`:scope > ${Col('PDDS',stg)} .P-P`,tr))

                function Validar(K,tyyp,trbdj){ // Validar pra saber se Corresponde ao Critério lá da base de dados
                    const td = $(`:scope > ${Col(tyyp,K[0])}`,trbdj)
                    const valor = VAL(td)
                    const Stg = K[1][0].replace('()',`('${valor}')`)
                    const Result = eval(`${K[1][0].includes('includes') ?'':'valor'} ${Stg}`)
                    return Result
                }

                $$(`:scope .Bdj_SERV > tbody > tr`,TD('Serv')).forEach((trbdj,x)=>{ // oq fazer dentro da bandeja Serv
                    let Acc = [] ; let Grup = []

                    CC['SERV'].forEach((e,x)=>{const K = ObjEtr(e)[0] ; if(Validar(K,'SERV',trbdj)){Grup = [K[0],K[1][1],K[1][2],x]} }) // Conferir de qual Grupo ele Pertence
                    if(Grup.length == 0){Grup = ['','','',0] ; return} // Dar String vazia caso não Pertença a nenhum Grupo
                    ObjEtr(CC['SERV'][Grup[3]]).forEach(K=>{Acc.push(Validar(K,'SERV',trbdj) ? [K[0],true]: [K[0],false])}) // Conferir Intensidade
                    const Concat = Acc.map(e=>{return e[1]==true ? e[0] : ''}).join('-') // Fazer o Concar pra Botar no SetAtributes (Concat Por Extenso)
                    const Length = Concat.split('-').filter(v=>v).length
                    const Pcnt = Length / Concat.split('-').length
                    const JaFeito   = Concat.split('-')[1]==='OK'
                    const Entregue = Concat.split('-')[2]==='Entregue'
                    const Devendo = Td_Val('Valr')>Td_Val('Pgmt')
                    const LucroOK = Td_Val('Cust')!=='' && Td_Val('Finc')!==''
                    const TDStts = $(Rx2(['Stts','Slct'])+' select',tr)

                    const CorTd   = LucroOK ? 'Formt_Azul' : Devendo&&Entregue ? 'Formt_Redd' : Devendo&&JaFeito ? 'Formt_Orag' : Pcnt === 1 ? 'Formt_VerdOK' : 'Formt_Verd'
                    const CorTr   = LucroOK ? 'Formt_Azul' : Devendo           ? 'Formt_Redd' : 'Formt_Verd'

                    // será q ta pintando um moi de VEZ?
                    Add(trbdj,Grup[2])      ; RGBa(trbdj     ,Pcnt) // Grup[2] é 'Formt_Verd' ou os outros
                    Add(TD('Serv'),CorTd)   ; RGBa(TD('Serv'),Pcnt)
                    Add(tr,CorTr)           ; RGBa(tr        ,Pcnt)
                    Add(TDStts,CorTd)       ; RGBa(TDStts    ,Pcnt)
                    Add($(`#H_SERV .${Array.from(trbdj.classList)[0]}`),Grup[2]) // Pintar a Tabela de Fora!

                    TDStts.value = Devendo ? 'Devendo' : Entregue ? 'Entregue' : JaFeito ? 'JaFeito' : 'Produção'
                    
                })

                if(Td_Val('Cust')!=='' && Td_Val('Finc')!==''){
                    Add(TD('Cust'),'Formt_Azul')
                    Add(TD('Finc'),'Formt_Azul')
                }else if(Td_Val('Pgmt')==0){
                    Add(TD('Valr'),'Formt_Redd')
                    Add(TD('Pgmt'),'Formt_Redd')
                }else if(Td_Val('Valr')>Td_Val('Pgmt')){
                    Add(TD('Valr'),'Formt_Orag')
                    Add(TD('Pgmt'),'Formt_Orag')
                }
                else if(Td_Val('Valr')==Td_Val('Pgmt')){
                    Add(TD('Valr'),'Formt_VerdOK')
                    Add(TD('Pgmt'),'Formt_VerdOK')
                }
            })

            console.log(`⏱️ Rfresh_Color(): ${(performance.now()-IN).toFixed(2)}ms`)
        }
        // Quero fazer tudo no Rodapé e manter alterações Fixas

        function RandonColorFilt(){
            // pegar todos os FIltros e Pintar Filtro com Pintura, apenas Filtro, apenas Pintura
            // Rando PIntura geral uma cor pra cada!
        }

        // ao Editar muda a cor apenas da própria Linha
    </script>
    
    <script> // AUTO COMPLETE

        function Complete_Forn(){ // depois fazer pegar nas 2 Tabelas
                    const IN = performance.now()
                    $$(Rx(['SERV','Serv','Slct']),$('#H_PDDS')).forEach(e=>{
                            if(VAL(e)==''){return}
                            const Forn = $(Rx(['Forn','Slct']),_tr(e))
                            // console.log(VAL(e),'Deveria ter',AllForn[VAL(e)])
                            if(AllForn[VAL(e)].length==1){
                                
                                $('select',Forn).value = AllForn[VAL(e)][0]
                            }
                            $$('option',Forn).forEach(o=>{
                                    Add_N(o)
                                if(AllForn[VAL(e)].includes(o.value)){
                                    Rmv_N(o)
                                }
                            })
                        
                        // Depois q terminar fazer isso atualizar a Const
                    })
                    const FIM = performance.now() ; console.log(`⏱️ Complete_Forn(): ${(FIM-IN).toFixed(2)}ms`)
        }

        // pra cada td deixar escrito em data-set=""  o numero da Coluna, e o nome do thead da coluna (serv, pgmt, coment...) isso vai facilitar muito


        // Teria um Botão pra Refaturar (ou seja ele n precisa ficar rodando a todo tempo, desde que as coisas não mudem) (roda quando eu apertar e mostrará mudanças caso exista pra eu poder escolher)

        // Nome, muda em PDDS - Completa em 'Serv' e 'Pgmt'
        // em Serv Muda os Options de Forn
        // ao Clicar em Entregue Preenche OK automatico
        // Fazer o Calculo automático

    </script>

    <script> // Previews

        function IMGENS(){ // função q filtra linhas se existir imagem
            $$(`#H_PDDS > tbody > tr`).forEach(tr=>{
                const TD=(stg)=>$(`:scope > ${Col('PDDS',stg)}`,tr)
                const ArryImg = $$(':scope > div > img',TD('Serv'))
                const tem1 = ArryImg.some(e=>isImageLoaded(e))
                if(tem1){Rmv_N(tr)}else{Add_N(tr)}
            })
        }

        function AbrirImg(img){MdalShow('#FormIMG')
            Inn($('#FormIMG'),`<div class="Ubuiaxik Ct"><img class="h100" src="${img.src}"><span>aquificara fica Os<span><div>`)
        }

        function AbrirSVG(img,Nome){MdalShow('#FormIMG')
            $('#FormIMG').innerHTML = `<div class="Ubuiaxik Ct"><img class="h100" src="${img.src}">
                <span>Nome: ${Nome}<span>
                <button onclick="LimparNomeSVG('${_td(img).className.trim()}')">Limpar</button>
            <div>`
        }

        function LimparNomeSVG(Clss){
            const Edit=e=>`<p class="Ct" ${Edi} onfocus="Add(Pai(this),'Foco')" name="${Inn(e)}" onkeydown="EnterBlur(this)" onblur="Rmv(Pai(this),'Foco');EditCell(this)">${Inn(e)}</p>`
            const td = $(`td[class="${Clss}"]`)
            EditCell(td,'')
        }

    </script>

    <script> // REALTIME
        function Rfresh_Foot(){ // jogar essas 3 primeiras const pra fora pra ser usada também no Filtro
            const IN = performance.now()
            const getAllCol=(Typ,col)=>$$(`#H_${Typ} > tbody > tr:not(.none) > ${Col(Typ,col)} > div > .P-P`)
            const objClnt=()=>getAllCol('PDDS','Clnt').map(e=>Inn(e))
            const objServ=()=>getAllCol('PDDS','Serv').map(e=>Pai(e)).flatMap(f=>$$(Rx2(['Serv','Slct']),f).map(t=>$('select',t).value))

            function SOMAPgmt(Arr){
                const Tm_PixAv=(Pix,Av)=>`<div class="Ct Ev"><div class="Ct">${Tm_RS(SOMA(Pix))}Pix</div> <div class="Ct">${Tm_RS(SOMA(Av))}Av</div></div>`
                let ArrPix = [] ; let ArrAv = []
                Arr.forEach(e=>{Inn(e).split('|').forEach(I=>{if(I===''){return}
                        if      (RgxPixAV(I)[2]==='Pix'){ArrPix.push(Num(RgxPixAV(I)[1]))}
                        else if (RgxPixAV(I)[2]==='Av' ){ ArrAv.push(Num(RgxPixAV(I)[1]))} }) })
                return Tm_PixAv(ArrPix,ArrAv)}

            $$(Rx2(['PDDS','Foot','Clnt'])).forEach(e=>{const[Typ,x,Col,Cry]=D_Rastr(e) ; e.innerHTML = `<div onclick="Tog_N($('.footbndjj',Pai(this)))">${Uniq(objClnt()).length} Clientes</div> <div class="Abslt none Cl footbndjj">${ObjEtr(ContRepete(objClnt())).sort((a,b)=>b[1]-a[1]).map(([k,v])=>`<span>${k}: ${v}</span>`).join('')}</div>`}) // o Sort é só pra reordenar
            $$(Rx2(['PDDS','Foot','Serv'])).forEach(e=>{const[Typ,x,Col,Cry]=D_Rastr(e) ; e.innerHTML = `<div onclick="Tog_N($('.footbndjj',Pai(this)))">${objServ().length} Serviços        </div> <div class="Abslt none Cl footbndjj">${ObjEtr(ContRepete(objServ())).sort((a,b)=>b[1]-a[1]).map(([k,v])=>`<span>${k}: ${v}</span>`).join('')}</div>`}) // o Sort é só pra reordenar
            $$(Rx2(['PDDS','Foot','Valr'])).forEach(e=>{const[Typ,x,Col,Cry]=D_Rastr(e) ; e.innerHTML = `<div>Total: R$ ${Cm(SOMA(getAllCol(Typ,Col),e=>Num(Inn(e))))}</div><div id="Sommma">Soma: 00,00</div>`})
            $$(Rx2(['PDDS','Foot','Pgmt'])).forEach(e=>{const[Typ,x,Col,Cry]=D_Rastr(e) ; e.innerHTML = `${SOMAPgmt(getAllCol(Typ,Col))}`})
            $$(Rx2(['PDDS','Foot','Cust'])).forEach(e=>{const[Typ,x,Col,Cry]=D_Rastr(e) ; e.innerHTML = `Custo: R$ ${Cm(SOMA(getAllCol(Typ,Col),e=>Num(Inn(e))))}`})
            $$(Rx2(['PDDS','Foot','Finc'])).forEach(e=>{const[Typ,x,Col,Cry]=D_Rastr(e) ; e.innerHTML = `Lucro: R$ ${Cm(SOMA(getAllCol(Typ,Col),e=>Num(Inn(e))))}`})
            
            const FIM = performance.now() ; console.log(`⏱️ Rfresh_Foot(): ${(FIM-IN).toFixed(2)}ms`)
        
            // no ID contar a quantidade de Linhas q tem visiveis
        }

        function RealTime(){
        //    Rfresh_Foot()
        //    Rfresh_Color()
        } // aqui fica todos os refresh q não afetam a tabela, são só coisas visuais // tentar tornar esse realtime mais rapido
    </script>
</div>

<body class="Dark" onclick="NoneBndj()">

    <header class="Bt Fx"> <!--HEADER-->
        <style> /*CSS do Header*/
            body > header{background:url(./SVG/Fundo.png);background-size: cover;height:60px;padding:0px; z-index: 999;} /*linear-gradient(to left,#530048,#83007b)*/
            #ALERT{right:0px;top:0px;margin:10px;padding:10px;background:#696969}
        </style>
        <script> // Funções do Header
            const OFF =()=> 'OFF'
            const ArryMais=()=> OFF() ? ['Cnfg','Help','LOff','Term'] : ['Troc','Edit','Cnfg','Help','LOff','Term'] // fazer isso simplesmente só ocultar e mostrar oq tem abaixo do mais
            function ExieMais2(E,Off){ event.preventDefault() ;if(false/*Off*/){MdalShow('#ModalLogin')}else{TogShow('#H_Mais')}}
            function AbreLogin(){MdalShow('#ModalLogin');Inn('#Span-Login','');Foco('#Inpt-Senha')}
        </script>

        <div id="Div-Titulo"> <!--Titulo-->
            <style> /*Titulo PC e Cell*/
                #Div-Titulo div{margin-left:15px}
                #Div-Titulo img{margin:5px; height:30px}
                #Div-Titulo h1{color: white !important}
                #Title1 h1{font-size:12px}
                #Title2 h1{font-size:40px}
                @media (max-width:1250px){#Title2 h1{font-size:29px}}
                @media (max-width:1100px){#Title2 h1{font-size:25px}}
            </style>

            <div id="Title1" class="Cl" onclick="NavPag('#Pag_ORC',this)"> <!--Titulo Mobile     onclick="Tog($('#BarraLateral'),'none')"-->
                <img draggable="false" src="./Img/Logo.png"><h1 class="noslt">InfinityAPP 7.4</h1>
            </div>
            <div id="Title2" class="Ct"> <!--Titulo PC-->
                <img draggable="false" onclick="Tog($('#BarraLateral'),'none')" src="./Img/Logo.png"><h1 class="noslt" onclick="NavPag('#Pag_ORC',this)">InfinityAPP 7.4</h1>
            </div>
        </div>
        
        <div id="Div-Pesq" class="Rltv hov"> <!--Pesquisa-->
            <style> /*Input de Pesquisa*/
                #Div-Pesq{width: 30%}
                #H_Pesq{background:#00000018; color:#ffffff;border: 1px solid #ef3aff}
                #H_Pesq::placeholder{color: #ffffff;opacity: 0.5}
                #Lupa{top: 8px; right: 6px; width: 17px; opacity: 0.5;}
                #Lupa:hover{opacity: 1;}
                #Pesq-Aa{top: 8px; right: 50px ; color: white;}
                #Pesq-A_{top: 8px; right: 30px ; color: white;}
                .Pesq-Aa{color: #00ff0d !important;}
                .Pesq-A_{color: #00ff0d !important;}
                @media (max-width:500px){ #Div-Pesq{width: 50%} }
            </style>
            <input id="H_Pesq" class="w100" placeholder="Pesquisar..." oninput="Pesquisa(this.value,'PDDS')">
            <a id="Pesq-Aa" class="Abslt HOV" onclick="Tog(this,'Pesq-Aa');Pesquisa($('#H_Pesq').value,'PDDS')">Aa</a>
            <a id="Pesq-A_" class="Abslt HOV" onclick="Tog(this,'Pesq-A_');Pesquisa($('#H_Pesq').value,'PDDS')">A]</a>
            <img id="Lupa" class="Abslt HOV" src="./SVG/Icon_Lupa.svg">
        </div>

        <div class="Ct"> <!--Nav e Perfil-->
            <style>
                #Img-Perfil{width:45px;height:45px;margin:5px 5px;top: 2px}
                #IMG-PerfiL{width:45px;height:45px;margin:5px 5px;top: 2px}
                #H_Nav{margin-right:15px}
                #H_Nav, #H_Nav img{height:45px}
                #H_Nav img,  h1 {filter: drop-shadow(0px 0px 8px #3a002b)}
                #H_Nav img:hover{filter: drop-shadow(0px 0px 5px #f030c0)}
            </style>
            <nav id="H_Nav" class="Ct"></nav>
            <script>Inn('#H_Nav',NavImg.map(e=>`<img class="ppt HOV" src="./SVG/${e}.svg" onclick="NavPag('#Pag_${e}',this);Atual['Pag']='#Pag_${e}'">`).join(''))</script>
            
            <div id="BdjLogin" class="Cl">
                <img id="LoginVazio" draggable="false" src="./Img/FundoLogo.png" class="ppt NObj" height="60px" onclick="AbreLogin()">
                <img id="IMG-PerfiL" draggable="false" src="./Img/LogOff.png" class="          Abslt NObj"      onclick="AbreLogin()" oncontextmenu="ExieMais2($('#MAIS'),true)">
                <img id="Img-Perfil" draggable="false"                        class="ImgPerfil Abslt NObj none" onclick="ExieMais2($('#MAIS'),true)">
                <div id="Login-Top"  class="Ct LgTp2 none"  onclick="AbreLogin()"> Login </div>
            </div>

            <style>
                #MAIS{background:#4e4e4e; width: 250px;}
                #MAIS div{padding:10px;cursor:pointer;font-size:15px;width: 100%;}
                #MAIS div:not(:last-child):hover{background:gray;color:var(--Txt-Wit-Hover)}
                #MAIS div:last-child{padding: 10px}
                #MAIS img{height:25px;margin-right:10px}
                #MAIS p,#MAIS p a{font-size: 10px}
                #H_Mais{top: 60px;right: 0px;}
            </style>

            <div id="H_Mais" class="Abslt none bndj">
                <div id="MAIS" class="Ct Pose">
                    <div class="Start" onclick="AbreLogin()">               <img draggable="false" src="./SVG/Mais_Troc.svg"><a> Trocar de Conta  </a></div>
                    <div class="Start" onclick="MdalShow('#EditarPerfil')"> <img draggable="false" src="./SVG/Mais_Edit.svg"><a> Editar Perfil    </a></div>
                    <div class="Start" onclick="MdalShow('#ConfigPag')">    <img draggable="false" src="./SVG/Mais_Cnfg.svg"><a> Configurações    </a></div>
                    <div class="Start" onclick="MdalShow('#PagSUPORTE')">   <img draggable="false" src="./SVG/Mais_Help.svg"><a> Central de Ajuda </a></div>
                    <div class="Start" onclick="LogOff()">                  <img draggable="false" src="./SVG/Mais_LOff.svg"><a> Sair             </a></div>
                    <div><p>Confira os <a class="Link">Termos de Serviço</a> e as <a class="Link">Política de Privacidade</a></p></div>
                </div>
            </div>
        </div>
        
        <div id="ALERT" class="Abslt rd none">
            <div class="Ct"><img draggable="false" src="./SVG/Plan.png" height="30px"><p style="margin-left: 5px;">Salvo com Sucesso</p></div>
            <span class="w100 Ct" style="height: 30px"></span>
        </div>

        <div id="BarraLateral" class="Abslt none">
            <style>
                #BarraLateral{
                    background: #ff4160;
                    height: 100vh;
                    top: 60px;
                    width: 250px;
                    z-index: 5;
                }

            </style>
            marionete
        </div>

        <script> // Titulo CSS
            function TrocarTitle(){if(window.innerWidth<=500){
                        Show($('#Title1'),$('#Title2'))
                        None($('#H_Nav')) }
                else {  Show($('#Title2'),$('#Title1'))
                        Show($('#H_Nav'))
                }
            }
            window.addEventListener('resize',()=>TrocarTitle())
            TrocarTitle()
        </script>
    </header>

    <div id="PAGES" style="margin-top: 60px">
        <style> /*Styles das Tabelas Principais*/
            table{text-align:center;border-collapse:collapse}
                .Dark .TBLAA table{background: #222222}
                .Lite .TBLAA table{background: white}
            .TBLAA th{padding:4px 6px}
                .Dark .TBLAA th,.Dark .TBLAA td{border:1px solid #cccccc27}
                .Lite .TBLAA th,.Lite .TBLAA td{border:1px solid #00000041}
                .Dark .TBLAA th{background: #161616;color:white}
                .Lite .TBLAA th{background: #8b0085;color:white}
                    .Lite .TBLAA td.Foco{background:#c300ff2a}
                    .Dark .TBLAA td.Foco{background:#ffffff18}
                .Dark .TBLAA tfoot{background:#111111;color:white}
                .Lite .TBLAA tfoot{background:#8b0085;color:white}

            .Dark .TBLAA tbody tr td:nth-child(1){color: #ffffff3b;background: #00000034}
            .Lite .TBLAA tbody tr td:nth-child(1){color: #0000008c}
            
            .TBLAA td p{height:100%; padding:2px 6px; text-align:center}

            .TBLAA .hMin td{height:10px}
            .TBLAA .hMin td select,.hMin td input{height: 17px !important}
                .TBLAA .hMin td .svg-Lixo{height:17px}
                .TBLAA .hMin td img{height:17px; width: auto;}
            .TBLAA .hMin tfoot td{padding:8px 6px}
            
            .TableMORE thead{background:#0000007c}
            .More{margin:5px; padding:5px 10px; height:20px}

            .TBLAA tfoot a{color: #00df00;}
            .TBLAA tfoot .RS{color: #00df00; font-size: 7px;}

            .teste{color: #79ff79;}

            #Rodape{height: 200px;}

            .icoFone{height: 12px !important ; width: 12px !important ; top: -16px; right: -87px;}

            /*Talvez toda essa trolha de pra simplificar, pois isso é só pra fazer as Linhas*/
            .Bdj_SERV > tbody > tr > td:nth-child(3) ,.Bdj_SERV > thead > tr > th:nth-child(3) {border-right: 4px solid #bb0092}
            .Bdj_SERV > tbody > tr > td:nth-child(9) ,.Bdj_SERV > thead > tr > th:nth-child(9) {border-right: 4px solid #bb0092}
            .Bdj_SERV > tbody > tr > td:nth-child(13),.Bdj_SERV > thead > tr > th:nth-child(13){border-right: 4px solid #bb0092}
            .Bdj_SERV > tbody > tr > td:nth-child(16),.Bdj_SERV > thead > tr > th:nth-child(16){border-right: 4px solid #bb0092}

            #H_SERV > tbody > tr > td:nth-child(3) ,#H_SERV > thead > tr > th:nth-child(3) {border-right: 4px solid #bb0092}
            #H_SERV > tbody > tr > td:nth-child(9) ,#H_SERV > thead > tr > th:nth-child(9) {border-right: 4px solid #bb0092}
            #H_SERV > tbody > tr > td:nth-child(13),#H_SERV > thead > tr > th:nth-child(13){border-right: 4px solid #bb0092}
            #H_SERV > tbody > tr > td:nth-child(16),#H_SERV > thead > tr > th:nth-child(16){border-right: 4px solid #bb0092}

            .TBLAA > table > tbody > tr > td:nth-child(1){background: #a7a7a78e !important}
            
        </style>

        <div id="Pag_PDDS" class="TBLAA none Cl">
            <div class="Ct Bt">
                <button onclick="NovoPedido()">Novo Pedido +</button>
                <h1 style="filter:none">Tabela de Pedidos</h1>
                <button onclick="Complete_Forn()">Complet Forn</button>
                <button onclick="IMGENS()">Filtrarapeansimg</button>
                <textarea style="background-color: gray;" class="ppt"  onclick="Copy(this,JSON.stringify(NovoJson,null,2))" readonly></textarea>
                <script>
                    const LrOrden=Typ=>Math.floor(MaxNum($$(H_Col_p(Typ,'Stts')).map(e=>Inn(e)))+1)
                    function NovoPedido(){AddROW('PDDS',{RG:AGORA(),OFF:1,Clnt:0,Data:'-',Stts:`${LrOrden('PDDS')}`}) /* AddROW('SERV',{ID:`${D.PDDS}|1`}) */ }
                </script>
                <button onclick="LimparFiltro('PDDS')">Limpar Filtro</button>
            </div>
            <style>#H_PDDS > tbody > tr > td:nth-child(1){width: 0%; color: #4b4b4b;}</style>
            <table id="H_PDDS" class="hMin">
                <thead class="Stky" style="top: 60px;z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.PDDS)))"></tr></thead>
                <tbody onload="Inn(this,Tm_Table('PDDS',NovoJson.filter(e=>e.OFF=='1')))"></tbody> <!--J.PDDS.filter(e=>e.OFF===1)-->
                <tfoot class="Stky2"><tr onload="Inn(this,Tm_tdFoot(ExtObj(BS.PDDS)[2],'PDDS'))"></tr></tfoot>
            </table>
        </div>

        <div id="Pag_SERV" class="TBLAA none Cl">
            <div class="Ct Bt">
                <input id="SERV_TrocaCor" type="checkbox" onchange="Condicional()">
                <div id="COnf_SERV" class="Configs Ct"></div><script>Inn($('#COnf_SERV'),Tm_Config('SERV'))</script>
                <button onclick="LimparFiltro('SERV')">Limpar Filtro</button>
            </div>
            <table id="H_SERV" class="hMin">
                <thead class="Stky" style="top: 60px;z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.SERV)))"></tr></thead>
                <tbody onload="Inn(this,Tm_Table('SERV',JServ))"></tbody>
                <tfoot class="Stky2"><tr onload="Inn(this,Tm_tdFoot(ExtObj(BS.SERV)[2],'SERV'))"></tr></tfoot>
            </table>
        </div>

        <div id="Pag_PGMT" class="TBLAA none Cl">
            <div class="Ct Bt">
                <button onclick="AddROW('PGMT')">Nova Linha +</button>
                <input id="PGMT_TrocaCor" type="checkbox" onchange="Condicional()">
                <div id="COnf_PGMT" class="Configs Ct"></div><script>Inn($('#COnf_PGMT'),Tm_Config('PGMT'))</script>
                <button onclick="LimparFiltro('PGMT')">Limpar Filtro</button>
            </div>
            <table id="H_PGMT" class="hMin">
                <thead class="Stky" style="top: 60px;z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.PGMT)))"></tr></thead>
                <tbody onload="Inn(this,Tm_Table('PGMT',JPgmt))"></tbody>
                <tfoot class="Stky2"><tr onload="Inn(this,Tm_tdFoot(ExtObj(BS.PGMT)[2],'PGMT'))"></tr></tfoot>
            </table>
        </div>

        <div id="Pag_GRAD" class="TBLAA none Cl">

            <div class="Ct Bt">
                <input id="MPAG_TrocaCor" type="checkbox" onchange="Condicional()">
                <div id="COnf_MPAG" class="Configs Ct"></div><script>Inn($('#COnf_MPAG'),Tm_Config('MPAG'))</script>
                <button onclick="LimparFiltro('MPAG')">Limpar Filtro</button>
            </div>
            <table id="H_MPAG" class="w100 hMax">
                <thead class="Stky" style="top: 60px;z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.MPAG)))"></tr></thead>
                <tbody onload="Inn(this,Tm_Table('MPAG',J['MPAG']))"></tbody>
            </table>

            <!--
                <div class="Ct Bt">
                    <button onclick="AddROW('GRAD')">Grad +</button>
                    <button onclick="AddROW('OOSS')">OS +</button>
                    <button onclick="AddROW('UBER')">Uber +</button>
                    <div id="COnf_GRAD" class="Configs Ct"></div><script>Inn($('#COnf_GRAD'),Tm_Config('GRAD'))</script>
                    <div id="COnf_OOSS" class="Configs Ct"></div><script>Inn($('#COnf_OOSS'),Tm_Config('OOSS'))</script>
                    <div id="COnf_UBER" class="Configs Ct"></div><script>Inn($('#COnf_UBER'),Tm_Config('UBER'))</script>
                    <input id="UBER_TrocaCor" type="checkbox" onchange="Condicional()">
                </div>
                <table id="H_GRAD" class="w100 hMax">
                    <thead class="Stky" style="top: 60px;z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.GRAD)))"></tr></thead>
                    <tbody onload="Inn(this,Tm_Table('GRAD',J['GRAD']))"></tbody>
                    <tfoot class="Stky2"><tr onload="Inn(this,Tm_tdFoot(ExtObj(BS.GRAD)[2],'GRAD'))"></tr></tfoot>
                </table>
                <table id="H_OOSS" class="w100 hMax">
                    <thead class="Stky" style="top: 60px;z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.OOSS)))"></tr></thead>
                    <tbody onload="Inn(this,Tm_Table('OOSS',J['OOSS']))"></tbody>
                    <tfoot class="Stky2"><tr onload="Inn(this,Tm_tdFoot(ExtObj(BS.OOSS)[2],'OOSS'))"></tr></tfoot>
                </table>
                <table id="H_UBER" class="w100 hMax">
                    <thead class="Stky" style="top: 60px;z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.UBER)))"></tr></thead>
                    <tbody onload="Inn(this,Tm_Table('UBER',J['UBER']))"></tbody>
                    <tfoot class="Stky2"><tr onload="Inn(this,Tm_tdFoot(ExtObj(BS.UBER)[2],'UBER'))"></tr></tfoot>
                </table>
            -->
        </div>

        <div id="Pag_CLNT" class="TBLAA none Cl">
            <div class="Ct Bt">
                <button onclick="AddROW('CLNT')">Nova Linha +</button>
                <button onclick="LimparFiltro('CLNT')">Limpar Filtro</button>
            </div>
            <table id="H_CLNT" class="hMin">
                <thead class="Stky" style="top: 60px;z-index: 510"><tr onload="Inn(this,Tm_thSort(ObjKey(BS.CLNT)))"></tr></thead>
                <tbody onload="Inn(this,Tm_Table('CLNT',J['CLNT']))"></tbody>
            </table>
        </div>

        <div id="Pag_LOJA" class=" none Cl">
            <style>
                #Pag_LOJA img {width: 50%;margin: 15px}
            </style>
            <!--
            <img src="./Fotos/001_Camisa.webp">
            <img src="./Fotos/002_Calão.webp">
            <img src="./Fotos/003_WindFlag.webp">
            <img src="./Fotos/004_Cartão.webp">
            <img src="./Fotos/005_Panfleto.webp">
            <img src="./Fotos/005_Panfleto.webp">
            <img src="./Fotos/006_Talão 2.webp"> -->

            <div id="DivListaKits"></div>
            <script>
                $('#DivListaKits')
            </script>
        </div>

        <script>
            const INgeral = performance.now()
        </script>

        <div id="Pag_ORC" class="none Cl" style="margin-top:60px;padding-top:20px">

            <div class="Ct w90"> <!--IMAGENS dos PRODUTOS-->
                <style>
                    #Div-Prod          {margin-bottom:30px; overflow-x:scroll; flex-wrap:nowrap;height: 360px; width: 100%;}
                    #Div-Prod > div    {margin:9px 4px; display:flex; flex-direction:column}
                    #Div-Prod span     {margin-left:10px; margin-bottom:10px}
                    #Div-Prod span p   {margin:0px; font-size:9px}
                    #Div-Prod span p strong  {font-size:9px}
                    #Div-Prod span img {margin:5px; height:30px; width:30px}
                    #Div-Prod span h3, #Div-Prod span h3 strong  {font-size:19px}
                    #Div-Prod .DivVrnts{margin-top:20px}

                    #Div-Prod .Opts               {top:45px; width:100%; height:30px; left:4px}
                    #Div-Prod .Opts img           {height:23px; width:23px; margin:3px 7px}
                    #Div-Prod .Opts div           {bottom:0; height:30px; width:50%; transition:all 0.1s ease-in-out; color: #000000;}
                        #Div-Prod .Opts div.Pre   {border-radius: 20px 0px 0 0 !important ; background:linear-gradient(to left,#bdb5be,#ffffff)}
                        #Div-Prod .Opts div.Pos   {border-radius: 0px 20px 0 0 !important ; background:linear-gradient(to right, #bdb5be,#ffffff)}
                        #Div-Prod .Opts div:hover {height: 35px ; border-radius: 20px 20px 0 0 !important}
                        #Div-Prod .Opts div.Atv   {z-index: 99 !important; border-radius: 20px 20px 0 0 !important ; box-shadow: -5px 0 10px #3c363f59, 5px 0 10px #3c363f59 ;  background:linear-gradient(to right,#ffffff,#ffffff)} /*background:white;  era pra ter background mas ele ta fazendo Piscar, ai tirei*/ 

                    #Div-Prod .Conteudo{padding-top:10px; z-index:999}
                    #Div-Prod .Conteudo,.offf{height:240px ; width:200px; margin:4px ; padding-bottom:15px; border-radius: 0px 0px 20px 20px ;background:linear-gradient(to top,#b3b3b3,#ffffff); color:#575757;}
                    .offf{ top: 40px; background: #808080d7; color: #ffffff;font-size: 20px;}
                    #Div-Prod .Conteudo .fotO{height:160px; width:150px}
                    .tec2 { z-index: 999; top: 310px; left: 20%; width: 60%; }
                </style>
                <div id="Div-Prod" class="Start"></div>
                <script>
                    function ShowVrnts(e){$$('.DivVrnts > div',Avo(e)).forEach((E,x)=>{
                        $$('div',Pai(e)).forEach((B,x,l)=>{
                            Rmv(B,'Atv')

                            if(x < IdxDe(e)){
                                Add(B,'Pre');Rmv(B,'Pos')
                                B.style.zIndex = (l.length+x) - IdxDe(e)+10
                            }else{
                                Add(B,'Pos');Rmv(B,'Pre')
                                B.style.zIndex = (l.length-x) + IdxDe(e)+10
                            }
                        })
                        Add(e,'Atv')
                        if(x===IdxDe(e)){Show(E)}else{None(E)}
                    })}

                    function tmplt_Prod(e){ //GRANDE
                        const Fora = ListaFora.includes(e)
                        return `<div class="Rltv Start2">
                            <span class="Start"><img src="${Fora?'./placeholder.svg':`./Prod/IconProd/${e}.svg`}"><div class="Start2"><h3 class="rgx">${e}</h3><p class="rgx">${Prod[e].Desc}</p></div></span>
                            <div class="KeyInn none">...</div>

                                <div class="Ct w100 Opts Abslt">${
                                    Vari(e).map((vv,x,l)=>{
                                        const pose = `left:${(x*(200/l.length))-(x===0?0:15)}px;`
                                        const Larg = `width:${(200/l.length)+15}px;`
                                        const Zidx = `z-index:${(l.length-x)+10};`
                                        return `<div style="${pose+Larg+Zidx}" onclick="ShowVrnts(this)" class="Ct Abslt ppt Pos ${x===0?'Atv':''}"><a class="none rgx">${vv}</a> <img name="${vv}" src="${Fora?'./placeholder.svg':`./Prod/IconProd/${e}_${vv}.svg`}"></div>`
                                }).join('')}</div>

                            <div class="Ct DivVrnts">
                            ${Vari(e).map((V,x)=>{ const OBJ = Prod[e].Variantes[V]
                                return `<div class="Conteudo Cl ${x===0?'':'none'}">
                                            ${Prod[e].Stts==="Offff"?`<div class="Ct Abslt offf">Indisponível no momento...</div>`:''}
                                            <div class="KeyVariants rgx">${V}</div>
                                            <img class="fotO" src="${Fora?'./placeholder.svg':`./Prod/${e}_${V}.webp`}" onclick="MdalShow('#Mdal-Prod')">
                                            <div class="Ct w100 ${OBJ.Calc==="QNT" || OBJ.Calc==="OFS"?'none':''}">${''}</div>
                                            <div class="Ct">${RS_HTML(OBJ.Valr)}</div>
                                            <div class="rgx none">${(HotKy[e] || []).map(e => e).join(',')}</div>
                                            <div class="RsutProduto w100 Ev">${/*OBJ.Valr.map((e,idx)=>{return tmplt_VlrTtl(OBJ.Valor[idx],e)}).join('')*/''}</div>
                                            <img class="Abslt tec2 HOV" onclick="Carrinho('${e}','${V}')" src="./SVG/Adicionar.svg">
                                </div>`
                            }).join('')}
                            </div>
                        </div>`
                    }   

                    function ReOrdenar(){ //  GRANDE
                        $('#Div-Prod').innerHTML = ''
                        AllProd.forEach(e=>{$('#Div-Prod').innerHTML+=tmplt_Prod(e)})
                    }ReOrdenar()

                    function Carrinho(serv,tipo){
                        const ult = $$('#ORC .OrcAdd').slice(-1)[0]
                        DispClick(ult)
                        SERV = $$('#ORC .OrcServ').slice(-1)[0]
                        SERV.value = serv
                        SERVChang(SERV)
                        // Delay(0.2)
                        TIPO = $$('#ORC .OrcTipo').slice(-1)[0]
                        TIPO.value = tipo
                        TIPOChang(TIPO)
                    }
                                    
                </script>
            </div>
            
            <div> <!--Pesquisa PROD-->
                <input id="PesqPROD" type="text" oninput="pesquisaProd(this)" placeholder="Pesquisar Produto...">
                <script>
                    function pesquisaProd(ipt){
                        const r = new RegExp(RxClear(ipt.value),'i')
                        $$('#Div-Prod > div').forEach(e=>{
                            $$(".rgx",e).forEach(Rx=>{Rx.innerHTML = Grifar(Rx.textContent,r)}) // Grifar
                            e.style.display = r.test(RxClear(e.textContent)) ? '' : 'none'      // Ocultar
                        })
                    }
                </script>
            </div>

            <div id="NovoForm" class="Cl w90 Rltv Rd" style="background:#ffffff0a;padding:10px">

                <div id="CONFIG" class="Abslt" style="right:10px;top:10px"> <!--CONFIGURAÇÕES-->
                    <img draggable="false" src="./SVG/CONFIG.svg" class="NObj" style="width:20px;opacity:0.2" onclick="TogShow($('#CONFIG_Bdj'))">
                    <script>
                        function Hdd_Cblh(Valid){if(Valid){Add($$(`#ORC thead`),'none')}else{Rmv($$(`#ORC thead`),'none')}}
                        function Hdd_Cust(){Tog($$(`[class^="ORC_CUST_"]`),'none')}
                        function Hdd_Crct(){Tog($$(`[class^="ORC_CRCT_"]`),'none')}
                        document.addEventListener("keydown",function(e){if(e.key==="'"){e.preventDefault();Hdd_Cust()}})
                    </script>
                    <style>#CONFIG_Bdj{width: 150px; right: 0px; background: #363636; padding: 10px}</style>
                    <div id="CONFIG_Bdj" class="Abslt none Start2 bndj">
                        <div class="Ct"><input id="Hdd-Cbclh" class="GETConfig" type="checkbox" onchange="Hdd_Cblh(this.checked)" onclick="SaveConfig(this)"><label>Exibir Cabeçalho</label></div>
                        <div class="Ct"><input type="checkbox" onchange="Hdd_Cust()"><label>Exibir Custo</label></div>
                        <div class="Ct"><input type="checkbox" onchange="Hdd_Crct()"><label>Exibir Crescente</label></div>
                    </div>
                </div>

                <script> // Templates e Ações para Tabela de Orçamento
                    // Biblioteca
                        const cla = `[class^="ORC_CUST_"],[class^="ORC_CRCT_"],[class^="ORC_RSUT_"]`
                        const AddTrue=(e,Clss,True)=>$$(cla).forEach(e=>{if(True(e)){Add(e,Clss)}else{Rmv(e,Clss)}})
                        const InNa_RS=(e,val)=>{Inn(e,Tm_RS(val)) ; Nm(e,val)}
                        const ClrSlct=(arry)=>arry.forEach(e=>e.selectedIndex=0) // Deixar Junto com o Clear e Levar pra Biblioteca const Clear = e=>[e].flat().forEach(el=>$(el).value='')
                        
                    // Templates
                        const Tm_ORC_Th=ary=>ary.map(e=>`<th class="${e==''?'':'O_Tx'}">${e==''?'':`<a>${e}</a><p>${D_brev[e]}</p>`}</th>`).join('')
                        const Tm_RmvAll=()=>Inn($('#ORC thead th:nth-child(1 )'),`<div class="ppt HOV O_All" onclick="RmvAll()">❌</div>`)
                        const Tm_ClrAll=()=>Inn($('#ORC thead th:nth-child(10)'),`<div class="ppt HOV O_All" onclick="ClrAll()">🧹</div>`)
                        const Tm_Total=E=>[`CUST_${E} none`,`CRCT_${E} none`,`RSUT_${E}`].map(e=>`<div class="ORC_${e}" name="0">${Tm_RS(0)}</div>`).join('')
                    // Ações
                        function Check_W_Pag(){
                            if(window.innerWidth<=650){$$('#ORC .O_Tx').forEach(th=>Show($('a',th),$('p',th)))}
                            if(window.innerWidth> 650){$$('#ORC .O_Tx').forEach(th=>Show($('p',th),$('a',th)))}
                        }
                        const RecolorVlr=()=>AddTrue($$(cla),'Branc',(e)=>Nm(e)==0)
                        const Zerar=tr=>$$(cla,tr).forEach(e=>InNa_RS(e,0))
                        const AddRow=tr=>{const a = tr.cloneNode(true) ; $$('input',a).forEach(e=>e.value='') ; Zerar(a) ; Insert(Pai(tr)).After(a,tr)}
                    // Clean e Remove
                        const RmvAll=()=>{$$(`#ORC tbody td:nth-child(1 ) > div`).forEach((E,X)=>{if(X==0){return}else{DispClick(E)}}) ; ReloadTotal()}
                        const ClrAll=()=>{$$(`#ORC tbody td:nth-child(10) > div`).forEach(E=>DispClick(E)) ; ReloadTotal()}
                        const ClrRow=tr=>{Clear($$('input',tr)) ; ClrSlct($$('select',tr)) ; Zerar(tr)}
                        const RmvRow=tr=>tr.remove()
                    
                    // Objetivo aqui é remover o Tamanho dessas Strings (Principalmente os Querys)
                </script>
                <style>  /*CSS da Tabela de Orçamento*/
                    #ORC input,#ORC select{width:100% !important ; margin:0}
                    #ORC .RS{font-size:7px}
                    #ORC td{padding: 1px}
                    #ORC th a,#ORC th p{display: flex;align-items: center;justify-content: center;}
                    .Branc{color: #ffffff5d !important}
                    .imita{height: 30px !important; background: #ffffff11}
                    .Final a{font-size:20px ; font-family:var(--Medi)}
                    .Final .RS{margin-right:3px}
                    .sOFF{opacity:0.3}
                    [class^="ORC_CUST_"]{color:#ff6565}
                    [class^="ORC_CRCT_"]{color:#65b5ff}
                    [class^="ORC_RSUT_"]{color:#48ff00}
                </style>



                <table id="ORC" class="w90" onkeydown="HandArrow(this,event)">
                    <thead class="none"><tr onload="Inn(this,Tm_ORC_Th(['','','Serv','Tipo','Lrg','Alt','Qnt','Und','SbTt','']));Tm_RmvAll();Tm_ClrAll()"></tr></thead>
                    <tbody>
                        <tr class="TrRow" oninput="ORC_Calc(this);RecolorVlr()" onchange="ValidOpts()">
                            <td width="15px" style="fill:#ff0000"><div class="ppt OrcRmv" onclick="RmvRow(_tr(this));Rload_Tbl('#ORC');ReloadTotal()" onload="Inn(this,SVG.Fexa)"></div></td><!--❌-->
                            <td width="15px" style="fill:#ffa500"><div class="ppt OrcAdd" onclick="AddRow(_tr(this));Rload_Tbl('#ORC');ReloadTotal()" onload="Inn(this,SVG.Mais)"></div></td><!--➕-->
                            <td><select class="OrcServ" onchange="SERVChang(this)" onload="Inn(this,Tm_OptsGraff(['Serviços',...AllProd]))"></select></td>
                            <td><select class="OrcTipo" onchange="TIPOChang(this)" onload="Inn(this,Tm_Opts(['Tipo']))"></select></td>
                            <td width="10%">
                                <select class="OrcCbmt none" onchange="CBMTChang(this)" onload="Inn(this,Tm_Opts(['Acabamento']))"></select>
                                <input class="ORC_INPT_Lrg" placeholder="Largura" oninput="MaskNum(this)">
                            </td>
                            <td width="10%">
                                <select class="OrcGram none" onchange="GRAMChang(this)" onload="Inn(this,Tm_Opts(['Gramatura']))"></select>
                                <input class="ORC_INPT_Alt" placeholder="Altura" oninput="MaskNum(this)">
                            </td>
                            <td width="10%">
                                <select class="OrcQntt none" onchange="QNTTChang(this)" onload="Inn(this,Tm_Opts(['Qnt']))"></select>
                                <input class="ORC_INPT_Qnt" placeholder="Quantidade">
                            </td>
                            <td width="10%"  onload="Inn(this,Tm_Total('Vund' ))" class="imita RD"></td>
                            <td width="10%"  onload="Inn(this,Tm_Total('SbTt' ))" class="imita RD"></td>
                            <td width="15px" style="fill:#ffa500"><div class="ppt OrcClr" onclick="ClrRow(_tr(this));Rload_Tbl('#ORC');ReloadTotal()" onload="Inn(this,SVG.Cler)"></div></td><!--🧹-->
                        </tr>
                    </tbody>
                </table>

                <script> // Funções do Tbody
                    function SERVChang(e){const Lista = ObjKey(Prod[e.value].Variantes);Inn($('.OrcTipo',_tr(e)),Tm_Opts(['Tipo',...Lista])) ; Tog_M2_OFS_UND(e)}
                    function TIPOChang(e){const Lista = Prod[$('.OrcServ',_tr(e)).value].Variantes[$('.OrcTipo',_tr(e)).value].Table;Inn($('.OrcCbmt',_tr(e)),Tm_Opts(['Acabamento',...Uniq(Lista.map(e=>e[0]))]))}
                    function CBMTChang(e){const Lista = Prod[$('.OrcServ',_tr(e)).value].Variantes[$('.OrcTipo',_tr(e)).value].Table;Inn($('.OrcGram',_tr(e)),Tm_Opts(['Acabamento',...Uniq(Lista.map(e=>e[1]))]))}
                    function GRAMChang(e){const Lista = Prod[$('.OrcServ',_tr(e)).value].Variantes[$('.OrcTipo',_tr(e)).value].Table;Inn($('.OrcQntt',_tr(e)),Tm_Opts(['Acabamento',...Uniq(Lista.map(e=>e[2])[0].map(e=>e[0]))]))}
                    function QNTTChang(e){const Lista = Prod[$('.OrcServ',_tr(e)).value].Variantes[$('.OrcTipo',_tr(e)).value].Table;ORC_Calc(_tr(e),Lista)}

                    function ORC_Calc(tr,Lista=null){
                        const TotalCress=(Valr,e)=>Math.round(e*(Valr+Valr*Crecent(e)))

                        const Serv = $('.OrcServ',tr).value
                        const Tipo = $('.OrcTipo',tr).value
                        const Cbmt = $('.OrcCbmt',tr).value
                        const Gram = $('.OrcGram',tr).value
                        const Qntt = $('.OrcQntt',tr).value
                        const Lrg = Num($('.ORC_INPT_Lrg',tr).value)
                        const Alt = Num($('.ORC_INPT_Alt',tr).value)
                        const Qnt = Num($('.ORC_INPT_Qnt',tr).value)

                        const Calc = Prod[Serv].Calc
                        const M2 = Prod[Serv]['Variantes'][Tipo]
                        const QNT = Num(Qntt.replace('.',''))

                        let F_Cust = 0
                        let F_Valr = 0
                        // Só pra OFS
                        if(Calc=='OFS'){
                            const filt   = Lista.filter(e=>e[0]===Cbmt && e[1]===Gram)
                            const filt2  = filt [0][2].filter(e=>e[0]===Qntt)
                            F_Cust = filt2[0][2]
                            F_Valr = filt2[0][1]
                        }

                        const Cust = M2?.Cust ?? 0
                        const Valr = M2?.Valr ?? 0
                        const CUSTO = Calc=='M2' ? Cust*Lrg*Alt*Qnt : F_Cust
                        const CRCT  = Calc=='M2' ? Valr*Lrg*Alt*Qnt : F_Cust
                        const VALOR = Calc=='M2' ? TotalCress(Valr,Lrg*Alt*Qnt) : F_Valr

                        InNa_RS($('.ORC_CUST_Vund',tr),CUSTO/Qnt)
                        InNa_RS($('.ORC_CUST_SbTt',tr),CUSTO)
                        InNa_RS($('.ORC_CRCT_Vund',tr),CRCT/Qnt)
                        InNa_RS($('.ORC_CRCT_SbTt',tr),CRCT)
                        InNa_RS($('.ORC_RSUT_Vund',tr),VALOR/Qnt)
                        InNa_RS($('.ORC_RSUT_SbTt',tr),VALOR)

                        ReloadTotal()
                    }
                    
                    function Tog_M2_OFS_UND(e){
                        if(Prod[e.value].Calc === 'M2'){console.log('M2')
                            None($$('.OrcCbmt,.OrcGram,.OrcQntt',_tr(e)))
                            Show($$('.ORC_INPT_Lrg,.ORC_INPT_Alt,.ORC_INPT_Qnt',_tr(e)))
                        }
                        if(Prod[e.value].Calc === 'OFS'){console.log('OFS')
                            Show($$('.OrcCbmt,.OrcGram,.OrcQntt',_tr(e)))
                            None($$('.ORC_INPT_Lrg,.ORC_INPT_Alt,.ORC_INPT_Qnt',_tr(e)))
                        }
                        if(Prod[e.value].Calc === 'UND'){console.log('UND')
                            None($$('.OrcCbmt,.OrcGram',_tr(e)))
                            Show($$('.ORC_INPT_Qnt',_tr(e)))
                        }
                    }

                    function ValidOpts(){$$('#ORC select').forEach(e=>$$('option',e).length==1 ? Add(e,'sOFF') : Rmv(e,'sOFF'))}

                    function Tm_OptsGraff(Ary,Stg=null){ //  Função que Carrega os Serviços dentro dos Grupos
                        const GpIt={}, GpOF={}
                        ObjEtr(Prod).forEach(([k,v])=>{GpIt[k] = v.Calc ; GpOF[k] = v.Stts})

                        return `<option value="" disabled selected>${Ary[0]}</option>
                            ${Object.entries(Ary.slice(1).reduce((a,e)=>{
                                (a[GpIt[e]]||=[]).push(`<option value=\"${e}\" ${Stg === e ? 'selected' : ''} ${GpOF[e] === 'Offf' ? 'style=\"color:red;\"' : ''}>${e}</option>`);return a
                            },{})).map(([g,o]) => `<optgroup label=\"${g}\">${o.join('')}</optgroup>`).join('')}
                        `}
                </script>

                <div> <!--Valores TOTAL-->
                    <p>Total</p>
                    <div class="ORC_CUST_FINAL Final none"></div>
                    <div class="ORC_CRCT_FINAL Final none"></div>
                    <div class="ORC_RSUT_FINAL Final"     ></div>
                    <script>
                        function ReloadTotal(){
                            Inn($('.ORC_CUST_FINAL'),Tm_RS(SOMA($$('.ORC_CUST_SbTt').map(e=>Nm(e)))))
                            Inn($('.ORC_CRCT_FINAL'),Tm_RS(SOMA($$('.ORC_CRCT_SbTt').map(e=>Nm(e)))))
                            Inn($('.ORC_RSUT_FINAL'),Tm_RS(SOMA($$('.ORC_RSUT_SbTt').map(e=>Nm(e)))))}
                    </script>
                </div>

                <script> // Funções Dedicadas a Tabelas de ORÇAMENTO
                    function Rload_Tbl(Tbl){Upp_Tabela(Tbl) ; Upp_RowCol(Tbl) ; RecolorVlr(Tbl) ; RecolorVlr()} ; Rload_Tbl('#ORC')
                    function Upp_Tabela(Tbl){
                        $$(`${Tbl} tbody tr`).length == 1 ? None($$('.OrcRmv',$(Tbl))) : Show($$('.OrcRmv',$(Tbl))) // Remover o X
                        $$(`${Tbl} tbody tr`).length == 1 ? None($$('.O_All')) : Show($$('.O_All'))
                        // aqui pode ter mais coisas pra Atualizar a Tabela
                    }
                    function Upp_RowCol(Tbl){
                        const Lmt = $$(`${Tbl} tr:nth-child(1) input`).length
                        $$(`${Tbl} input`).forEach((I,x)=>{
                            I.dataset.row = Math.floor(x/Lmt)
                            I.dataset.col = x % Lmt})
                    }
                    function HandArrow(Tbl,e){
                        if (e.key === "Enter"){
                            const Inpts = $$(`input`,Tbl)
                            const Elemt = $(':focus')
                            const Next = Inpts[Array.from(Inpts).indexOf(Elemt)+1]
                            if(Next){Next.focus() ; Next.select() }}
                        let act = document.activeElement
                        if (act.tagName !== "INPUT") return
                        let r = +act.dataset.row, c = +act.dataset.col, nxt
                        if (e.key === "ArrowRight") nxt = `[data-row='${ r }'][data-col='${c+1}']`
                        if (e.key === "ArrowLeft")  nxt = `[data-row='${ r }'][data-col='${c-1}']`
                        if (e.key === "ArrowDown")  nxt = `[data-row='${r+1}'][data-col='${ c }']`
                        if (e.key === "ArrowUp")    nxt = `[data-row='${r-1}'][data-col='${ c }']`
                        if (nxt){$(nxt)?.focus() ; setTimeout(()=>$(nxt)?.select(),0)}
                    }

                    window.addEventListener("resize",Check_W_Pag)
                    Check_W_Pag()
                    ValidOpts()
                </script>

                <div class="w100 Ct" style="margin-top: 80px"> <!--Informações Extras-->
                    <div class="Cl"><label>Nome</label><input placeholder="Nome"></div>
                    <div class="Cl"><label>Contato</label><input placeholder="Contato"></div>
                    <div class="Cl"><label>Endereço</label><input placeholder="Endereço"></div>
                    <div class="Cl"><label>Comentário</label><input placeholder="Comentário"></div>
                </div>
                <button onclick="VerNota()">Ver Nota</button>
                </form>
            </div>

            <div><!--Arte-->
                <style>
                    .container {
                        max-width: 300px;
                        margin: auto;
                        padding: 20px;
                        border: 1px solid #ccc;
                        border-radius: 10px;
                        box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
                    }
                    .tootal, .tootal span {
                        font-size: 18px;
                        font-weight: bold;
                        color: #00df00;
                    }
                    .Pcntalmt{
                        margin-top: 15px;
                        color: gray;
                    }
                </style>

                <div class="container" style="margin-bottom: 150px;margin-top: 50px;">
                    <h3>Orçamento de Arte:</h3>

                    <select id="designOptions" onchange="EscolheARTE()" class="w100">
                        <option value="20" data-extra="0">Post Digital - R$ 20,00</option>
                        <option value="20" data-extra="4">Carrossel - R$ 20,00 (+R$ 4,00 por unidade)</option>
                        <option value="25" data-extra="0">Banner Digital - R$ 25,00</option>
                        <option value="25" data-extra="0">Cartão de Visita - R$ 25,00</option>
                        <option value="50" data-extra="0">Flyer - R$ 50,00</option>
                        <option value="30" data-extra="0">Panfleto - R$ 30,00</option>
                        <option value="20" data-extra="0">Wing Banner - R$ 20,00</option>
                        <option value="50" data-extra="10">Cardápio - R$ 50,00 (+R$ 10,00 por página)</option>
                        <option value="25" data-extra="3">Backdrop Simples - R$ 25,00 (+R$ 3,00 por patrocinador)</option>
                        <option value="100" data-extra="0">Logo - R$ 100,00</option>
                        <option value="400" data-extra="0">Identidade - R$ 400,00</option>
                        <option value="40" data-extra="0">Manipulação/Tratamento - R$ 40,00</option>
                        <option value="25" data-extra="0">Vetorização - R$ 25,00</option>
                        <option value="5" data-extra="0">Banner Simples Texto - R$ 5,00</option>
                        <option value="30" data-extra="3">Arte para Camisa - R$ 30,00 (+R$ 3,00 por variação)</option>
                    </select>
                    
                    <label for="quantidade">Quantidade:</label><input type="number" id="quantidade" value="1" min="1" oninput="EscolheARTE()">

                    </select>
                    <div id="Bruxos">
                        <label><input type="checkbox" value="20" onchange="EscolheARTE()"> Identidade Visual (20%)</label><br>
                        <label><input type="checkbox" value="15" onchange="EscolheARTE()"> Roteirizar (15%)</label><br>
                        <label><input type="checkbox" value="25" onchange="EscolheARTE()"> Criar Logomarca (25%)</label><br>
                        <label><input type="checkbox" value="8"  onchange="EscolheARTE()"> Digitação (8%)</label><br>
                        <label><input type="checkbox" value="7"  onchange="EscolheARTE()"> Escolha de Imagens (7%)</label><br>
                        <label><input type="checkbox" value="5"  onchange="EscolheARTE()"> Montagem (5%)</label><br>
                    </div>

                    <div class="Pcntalmt"></div>
                    <div class="tootal">Total: R$ <span id="total">0.00</span></div>
                </div>

                <script>
                    function EscolheARTE(){
                        const Slt = $("#designOptions")
                        const Qnt = $("#quantidade").value
                        const Val = parseFloat(Slt.value)
                        const Ext = parseFloat(Slt.options[Slt.selectedIndex].getAttribute("data-extra")) || 0
                        let Porcent = 0
                        $$('#Bruxos input[type="checkbox"]:checked').forEach(e=>{console.log(e) ; Porcent += parseFloat(e.value)})
                        const Pcnt = Porcent.toFixed(2)/100
                        const Total = Val+(Ext*(Qnt-1))
                        const Total2 = Total+(Total*Pcnt)

                        $(".Pcntalmt").innerHTML = `Porcentagem: R$ ${parseFloat(Pcnt)*100}%`
                        $(".tootal").innerHTML = `R$ ${Total2.toFixed(2).replace('.', ',')}`
                    }

                </script>
            </div>
        </div>

        <script>
            const FIMGeral = performance.now() ; console.log(`⏱️ ORçamento(): ${(FIMGeral-INgeral).toFixed(2)}ms`)
        </script>
    </div>

    <style> /*CSS dos Modais*/
        .Dark #FModal>div{background:#1b1b1b}
        .Lite #FModal>div{background:#ffffff}
        .Dark #FModal > #ModalNota{background:#ffffff;color:black}
              #FModal h1{font-size:25px}

        #ModalLogin{width:300px;height:400px}
        #ModalCadastro{width:70%}
        #Modal-Item .Feed{width:400px;height:400px}
        #Modal-Item .Stry{width:250px;height:440px}
        #Modal-Info1,#Modal-Info2{padding:30px}
        #InnerVazio input{position:absolute;width:200px}

        #ModalNota>div{padding:5px 0px}
        #Nota-Clnt>div>div>div{margin:0px 5px}
        #ModalNota img{width:50px;height:50px}
        .Start2 p{margin:1px 5px}
        #LugarFotoNotta{margin-right:3px}

        #TabelaNotinha{text-align: center;border-collapse: collapse;border: #d8d8d8 solid 1px;}
        #TabelaNotinha tr{background: #5F009E;color: white;font-size: 13px;}
        #TabelaNotinha td{background: #ffffff;color: black; padding: 3px;font-size: 13px;}
        #TabelaNotinha tfoot > tr > th {background: #575757}
        #TabelaNotinha td:nth-child(5){font-size: 13px;color:#4f4f4f;}
        #TabelaNotinha td:nth-child(6){font-weight: bold}
    </style>

    <div id="FModal" class="Ct">
        <script>function SairMdal(){None('#FModal')} </script>

        <div id="ModalLogin" class="Ct Rltv Rd">
            <div class="Close Ct" onclick="SairMdal()">X</div>
            <div class="Bt Loginn">Login</div>
              <div class="Ct Start">
                <label for="Senha">Senha</label>
                <input id="Inpt-Senha" class="Inputss" type="password" onkeyup="TestSenha(event,this)">
              </div>
              <span id="Span-Login" class="erro"></span>
              <div class="Bt">
                <button class="Ct w40" onclick="TestSenha('','#Inpt-Senha')">Logar</button>
                <button class="Ct w40" onclick="Deslogar();SairMdal()">Sair</button>
              </div>
        </div>

        <div id="FormIMG"></div>

        <div id="Mdal-Prod">
            fotrinhas
        </div>
    
        <div id="ModalNota" class="Cl Rltv Rd media30">
        <div class="Close Ct" onclick="SairMdal()">X</div>
        <div id="Titulo-Nota" class="w100 Bt Hr"></div>
            <div id="Nota-Empresa" class="Ct Row Hr Bt w100">
                <div class="Ct">
                <div id="LugarFotoNotta"><img src="Img/Logo2.png"></div>
                <div>
                    <h2>INFINITY GRAFF</h2>
                    <h2>IMPRESSÃO DIGITAL</h2>
                </div>
                </div>
        
                <div class="Start2">
                    <div class="FtBd Ct">Endereço: <p>Estrada do Tip, N° 54A</p></div>
                    <div class="FtBd Ct">Cidade: <p>SÃO LOURENÇO DA MATA</p></div>
                    <div class="FtBd Ct">Email: <p>infinitygraff@outlook.com</p></div>
                    <div class="FtBd Ct">Contato: <p class="B">(81) 98726.5401</p></div>
                </div>
            </div>
        
            <div class="Ct Cl Hr">
                <h2>CUPOM FISCAL</h2>
                <div id="DataNota"></div>
            </div>
        
            <div class="Start2 Hr">
                <div class="Ct"><p class="FtBd">ORDEM DE SERVIÇO:<p><p>${id}</p></div>
                <div class="Ct"><p class="FtBd">Data:</p><p>00/00/2023</p></div>
            </div>
        
            <div id="Nota-Clnt" class="Row w100 Ev">
                <div>
                <div class="Ct FtLt">Nome:     <div data="Clnt"></div> </div>
                <div class="Ct FtLt">Fone:     <div data="Cntt"></div> </div>
                </div>
                <div>
                <div class="Ct FtLt">Endereço: <div data="Local"></div></div>
                <div class="Ct FtLt">Cidade:   <div data="City"></div> </div>
                </div>
                <div>
                <div class="Ct FtLt">CPF/CNPJ: <div data="CNPJ"></div> </div>
                </div>
            </div>
        
            <div id="ConteudoNota" class="w100">
                <table id="TabelaNotinha" class="w100"><thead><tr><th style="color: white">Serviços</th></tr></thead></table>
                <div id="DescrNota" class="Ct Cl"></div>
                <h2 id="TotalNotta" class="Hr Ct"></h2>
            </div>
        
            <div class="w100 Ct">
            <button id="trocatroca" class="BTNota Ct RD magem" onclick="troctroc()">Troca-Troca</button>
            <button class="BTNota Ct RD magem" onclick="SairMdal()">Cancelar</button>
            <button class="BTNota Ct RD magem" onclick="NewPDF()">Imprimir<div id="imgnotta" class="Ct"></div></button>
            </div>
        </div>

        <div id="EditarPerfil" class="Cl Rltv Rd">
            <div class="Close Ct" onclick="SairMdal()">X</div>
            <div>Foto</div>
            <img src="./Img/Perfil_Allan.png" width="100">
            <div>Nome do Usuário</div>
            <input type="text" placeholder="Senha Atual">
            <input type="text" placeholder="Nova Senha">
            <input type="text" placeholder="Repetir Senha">
        </div>

        <div id="ConfigPag" class="Cl Rltv Rd">
            <div class="Ct Close" onclick="SairMdal()">X</div>
            <div><input id="DarkLite" type="checkbox" class="GETConfig" onchange="DarkLite2('body',this.checked)" onclick="SaveConfig(this)"> <label>Modo Escuro</label></div>
            <div><input id="TamFonte" type="range"> <label>Tamanho de Fonte</label></div>
        </div>

        <div id="PagSUPORTE" class="Cl Rltv Rd">
            <div class="Close Ct" onclick="SairMdal()">X</div>
            <div>informações de Suporte</div>
            <div>dicas de como usar o APP, principalmente pra mim</div>
        </div>
    </div>
</body>

<script> // Funções de Login
    let LgTp = {'Nome':'','Cod':'','Img':''} ; function SemLogin(){return LgTp.Cod===''}
    function TestSenha(e,ipt=null){

        function CrypPass(senha){
            const Cryp = senha.split('').map((c,idx)=>{
                if(/[0-9]/.test(c)){let N=parseInt(c)
                N=N===9?0:N+(idx%2===1?4:1);return N.toString()}
                else if(/[A-Za-z]/.test(c)){
                let L=c.charCodeAt(0)+(idx%2===1?5:1)
                if(L>90&&L<97)L-=26
                else if(L>122)L-=26
                return String.fromCharCode(L)}else{return c}})
            var par = [] ; var imp = []
            Cryp.forEach((e,idx)=>{idx%2===0?par.push(e):imp.push(e)})
            const Par=par.reverse().flatMap(C=>[`3${C}$`,`r${C}-`,`3${C}&`])
            const Imp=imp.reverse().flatMap(C=>[`-${C}e`,`V${C}9`,`@${C}K`])
            return Par.concat(Imp).join('')
        }

        const User={
            '34$r4-34&-7eV79@7K':['(Baby)','Baby Massia'   ,'Img/Perfil_Baby.png'   ],
            '32$r2-32&-6eV69@6K':['(Alan)','Allan MacLovin','Img/Perfil_Allan.png'  ],
            '31$r1-31&-4eV49@4K':['(Lisa)','Lisa Caramelo' ,'Img/Perfil_Lisa.png'   ],
            '36$r6-36&-9eV99@9K':['(Segu)','Segunda Hippie','Img/Perfil_Segunda.png']
        }

        if(e==='Deslog'){
            Nm($('#Login-Top'),'')
            Inn('.LgTp2',IconLogin)
            Show('.LgTp')
            None('.ImgPerfil')
            $('.ImgPerfil').src=''
        
        }else if(e==='Storage'){ if(User[ipt] === undefined || User[ipt] === null){return}
            else{
                // localStorage.removeItem('SenhaCryp')
                // localStorage.setItem('SenhaCryp',input)
                Nm($('#Login-Top'),'Logado')
                Inn('.LgTp2',User[ipt][1])
                Show('.ImgPerfil')
                $('.ImgPerfil').src=User[ipt][2]
            }
        }
        else{
            let inpt=e==='' ? $(ipt) : ipt
            if(KeyEnter(e)||e===''){
                const Cryp = CrypPass(inpt.value)
                if(User[Cryp]){

                    None($('#IMG-PerfiL'))
                    SairMdal()
                    localStorage.removeItem('SenhaCryp')
                    localStorage.setItem('SenhaCryp',Cryp)
                    Nm($('#Login-Top'),"Logado")
                    Inn('.LgTp2',User[Cryp][1])
                    Show('.ImgPerfil')
                    Show('.ImgPerfil2')
                    $('.ImgPerfil').src=User[Cryp][2]

                }else{Inn('#Span-Login','Senha Inválida') ; inpt.placeholder='Senha Inválida'}
                inpt.value='';inpt.focus()
                console.log('Logou')
            }
        }
    }
    
    function LoginStorage(){const Pass = localStorage.getItem('SenhaCryp');if(Pass===null){return};TestSenha('Storage',Pass)}
    function Deslogar()    {localStorage.removeItem('SenhaCryp');TestSenha('Deslog','')}
    LoginStorage()
    /*
    idéias pra o Login
        Login com LocalStorage
        deixar o CryPass() na BaseDados da Biblioteca
        criar um Objeto no inicio com Nome User q vai passar todos os Dados do Usuário
        e é atravéz desses dados que toda a interface vai carregar de acordo com o usuário
        suas configurações e personalziações, suas informações e suas Listas de Pedidos
    */
</script>

<script> // Coisas da NOTA
    function estaOculta(e) {return getComputedStyle(e).display === "none"}

    function VerNota(){
        MdalShow('#ModalNota')
        // Aqui em Baixo coletar tudo q ta no orçamento e Jogar pra cá!
        // deixar uma Opção pra Copiar o Texto
        const dados = $$('#ORC tbody tr').map(tr=>$$('td input, td select',tr).map(e=>{if(estaOculta(e)){return}else{return e.value}}))
        console.log(dados)
    }
</script>

<script> // Controla a Base de Dados
    function Rfresh(){(async()=>{await GetJSON()})()}
    async function GetJSON(){ // por enquanto não ta sendo usado
        console.log('Não Está Rodando')
        async function UparClnt(){FetchPOST(Link+'/postUpar_Clnt_Data',[''])}
        async function UparLink(){FetchPOST(Link+'/postUparLink',[''])}
        async function UparLinkMPAG(){FetchPOST(Link+'/postUparLinkMPAG',[''])}
        async function Get_Json(End){return new Promise(r=>{FetchGET(`${Link}/getJSON/${End}`,e=>{D[End]=MAX(e,'ID')+1;J[End]=e;r()})})}
        await UparClnt() ; await UparLink() ; await UparLinkMPAG()
        for(let end of ['CLNT','SERV','PGMT','UBER','GRAD','OOSS','PDDS','MPAG']){await Get_Json(end)}
        PosGet()
    }

    function PosGet(){
        Onloads('body')
        NavPag(Atual['Pag'])
        Format_Bndj_Clnt()
        Tm_Filt() // Carregar todo Conteúdo do THFilt
        RealTime()
        console.log('✅ Concluido')
    }

    function EditCell(e,vall=null){
        const[Typ,x,Col,Cry]=D_Rastr(_td(e))
        const Val = vall===""?"":VAL(_td(e))
        const idPDD =  tr_ID(Pai(_td(Pai(_td(e)))))
        const isBdj = D_Rastr(_td(Pai(_td(e))))[3]

        if(Val===Nm(e)){return}
        const Arr = [Typ,idPDD,Cry,x,Col,isBdj,vall===""?"":vall?vall:Val] // [Tabela,Linha,Coluna,NovoValor]
        Nm(e,e.textContent.trim())
        console.log('arrayFinal',Arr)
        EditCONST(Arr) //EditJSON(arrays)
    }

    function EditCONST(Arr){
        const [Typ,idPDD,Cry,x,col,isBdj,vall] = Arr
        const item = NovoJson.find(obj=>obj['Id']==idPDD)
        const Idx = NovoJson.findIndex(obj=>obj['Id']==idPDD)
        console.log(isBdj)
        if(isBdj=='Bndj'){
            const typ = item[minuscule(Typ)]
            const Idxbdj = NovoJson[Idx][minuscule(Typ)].findIndex(obj=>obj['Id']==x)
            NovoJson[Idx][minuscule(Typ)][Idxbdj][col] = vall //idPDD
            console.log(NovoJson[Idx])
        }else{
            console.log(`${NovoJson[col]} >> ${vall}`)
            NovoJson[col] = vall 
        }
        //RealTime()
    }


    const TesteClnt=(e,td=null)=>{
        if($('#ConfirCliente').checked){console.log('Perguntar')}
            if(confirm(`Tem Certeza que quer salvar: ${e.value} como Cliente?`)){
                if(Nmame(e)){return Nmame(e)}else{AddROW('CLNT',{Clnt:e.value});if(td){EditCell(td,D['CLNT'])} ; return D['CLNT']}}
    }
</script>

<script> // Controladores antigos pra confiscar
    function EditCellFake(eu){ // Usado apenas no Format_Bndj_Clnt()   // assim q eu eliminar lá, poderei apagar isso aqui!
        const val = Nm($('input',Pai(eu)))
        const R = D_Rastr(Avo(eu.closest('.BNdj')))
        const arrays = (['PDDS',R[1],'Clnt',val]) // [Tabela,Linha,Coluna,NovoValor]
        console.log(arrays)
        EditJSON(arrays)
    }
    const EditCellFake2=(e)=>{ // Usado apenas no Format_Bndj_Clnt() // é a mesma coisa, tem q ver lá tbm
        const R = D_Rastr(_td(e))
        e.value.split('|').forEach(E=>{
            // isso ta rodando 2 vezes mesmo quando só tem 1 no caso quando eu não digioto o | // talvez seja pq ta rodando 2 vezes, uma no Enter, e outra no Onblur
            AddROW('PGMT',{Link:R[1],Valr:RgxPixAV(E)[1],Form:RgxPixAV(E)[2]})
        })
    }

    function add_PDDS(e,nome){
        const TestePgmt=()=>{if(e[5]){AddROW('PGMT',{Desc:e[5]});return D['PGMT']}else{return '.'}}
        const TesteServ=()=>{AddROW('SERV',{ID:`${D['PDDS']}|1`,Serv:e[2],Desc:e[3],Valr:Num(e[4]),Forn:e[6],OK:false});return 1}
        AddROW('PDDS',{RG:AGORA(),OFF:1,Data:DMY(e[0]),Serv:TesteServ(),Clnt:TesteClnt(nome),Pgmt:TestePgmt()}) 
        Clear($$('#FormPDDS input, #FormPDDS select'))
        // neste Add_PDDS: quando salvar Pgmnt tem que Linkar o ID do Pedido
    }

    function NovaLinhaBDj(Eu){ // isso talvez deva ir la pra baixo
        const R = D_Rastr(_td(Eu))
        const Sv = $$('tbody tr',_td(Eu))
        if(R[2]=='Pgmt'){ AddROW(R[2].toUpperCase(),{Link:`${R[1]}`}) }
        if(R[2]=='Serv'){ AddROW(R[2].toUpperCase(),{ID:`${R[1]}|${Sv.length}`}) }
    }

    // Edit e Delet ta Funcionando
        // os que execulta antes de atualizar o Json "//FAST//"
        function AddROW(Pln,obj=null){/*AddRowPratica(Pln,obj,'<')*/ ; AddROWConst(Pln,obj) ; /* FetchPOST(Link+'/postLINHA',[Pln,obj],(e)=>{ALERT(e)}) */ }

        function AddRowPratica(Pln,obj,Pose){
            let tbody =  $(`#H_${Pln} > tbody`)
            let Colll = $$(`#H_${Pln} > thead th p`).map(p=>Inn(p))
            let Clone =  $('tr',tbody).cloneNode(true)
            $$(':scope > td',Clone).forEach((td,x)=>{if($('p',td)){Inn($('p',td),obj[Colll[x]]??'')}}) // Atualizar (este if ta aqui só por que a Lixeira não tem uma Tag <p> dai ela retorna Null) Atualizar de Forma Genérica (q Funcione com td Input, Edit, CheckBox tudo!)
            Pose === "<" ? tbody.prepend(Clone) : tbody.appendChild(Clone)
            // o Clone não ta Exibindo Bandeja corretamente talvez por causa da exibição de bandeija depende do ID, e não ta sendo passado corretamente na hora do clone
        }

        function RmvROW(Typ,id,eu){eu.closest('tr').remove() ; FetchPOST(Link+'/postDELETE' ,[Typ,id],(e)=>{ALERT(e)})}
        function ExcROW(Typ,id,eu){eu.closest('tr').remove() ; FetchPOST(Link+'/postEXCLUIR',[Typ,id],(e)=>{ALERT(e)})}
        function EditJSON(arry){FetchPOST(Link+'/postEDIT',arry,(e)=>{ALERT(e);return e})}

        function AddROWConst(Typ,obj=null){ // ESTE É BEM MELHOR que o AddRowPratica() NA TORA (depois mudar pra inserir no Inicio ou no Final)
            const LastRow=(obj,id)=>obj.reduce((max,e)=>Math.max(max,e[id]),0)
            const Arq = J[Typ]
            const Novo = {...Arq[Arq.length-1]}                    // Clona Nova Linha
            ObjKey(Novo).forEach(k=>(Novo[k]=''))                  // Limpa tudo
            Novo['ID'] = LastRow(Arq,'ID') + 1                     // Muda Id para um Novo
            if(obj){ObjEtr(obj).forEach((K)=>{Novo[K[0]] = K[1]})} // Atualizar o Restante dos Dados
            J[Typ].push(Novo)
            console.log(Novo)
            PosGet()
        }
    PosGet()    
</script>

<script> // Storage Salva Configurações
    function AtivaEventos(){window.addEventListener("scroll",()=>{scrollPosition=[window.scrollX,window.scrollY]})}
    // AtivaEventos()

    function Disparos(e){/*console.log('Dispoaro >')*/ ; e.dispatchEvent(new Event('change')); /* console.log('< Dispoaro') */}

    function SaveConfig(e){StogeSet(e.id,Vll(e)) ; /* console.log('Save',e.id,Vll(e)) */ }

    function GetConfig(){$$('.GETConfig').forEach(e=>{
        const Valor = StogeGet(e.id)
        if(Valor){ llv(e,Valor);Disparos(e)  }})}
    
    window.onload = () => {GetConfig()}

    // function GetConfigOrdem(){OrdenarRows($(`#H_PDDS thead tr th:nth-child(${8}) a`),7,'p','desc')}
    // function savecoifigTABLE(){StogeSet('Orden',x)}
    // Save para MenuNav
    
</script>

<script> // comentários
    // Permitir Remover o Fx do <Header>
    // Mostrar o Valor por M2 ao Lado do Option
    // Permitir Drag nas Linhas
    // imitar Bureal no Futuro (deixando todas bandeijas aberta)
    // no Select se oq está atualmente selecionado, existir no option da próxima rodada, então mantem ele
    // selecionar option automaticamente caso tenha apeans 1
    // Proibir Drag em Imagens
    // a soma de metros de produtos do mesmo tipo tem q resultar na Diminuição da Crescente
    // o Valor Crescente deve ficar verde, se ele for igual ao valor Final
    // qual foi o PC q deu a entrada, precisa registrar tbm, Adicionar RG tbm em Pedidos, e em Clientes e Pagamento
    // Poder Diferenciar oq foi preenchido Automatico, e o q foi preenchido Manualmente


    // Ficar trocando a Barra de Pesquisa lá do Topo, pra cada Página
    // um click abre a imagem, click duplo Adiciona ela em baixo
    // deixar maior os botões de Limpar tudo, e excluir tudo (CSS mobile)
    // Adicionar um Botão pra Limpar os ta imcompleto, deixando apenas os orçamentos Certinhos
    // quero criar meu próprio Teclado Numerico, com Opções de cm, m, e mm (Oculpando espaço nessesário na Tela, sem mover o Scroll)
    // como impedir q a página dê zoom, pelo celular

    //missrand.e bixinha da musica Rendow - Damn Fly

    // Dica pra mover Linha igual Movimenta as Linhas na Planilha, aparece só o contorno e o grad bem simplifciado
    // ao exibir o SVG grande, mostra o tamanho das coisas

    // https://www.erome.com/a/wcmxSNOS
    // https://www.erome.com/a/VkT1uhYg
    // https://www.erome.com/a/PWY4fkMD
    // https://www.erome.com/a/Vk99UZ8L
    // https://www.erome.com/a/K0hAD4GJ
</script>

<script> // Templates pra iserir mais pra frente
    const tmplt_Cores=e=>`<li class="Ct Rd ppt" style="background:${e}" onclick="mudarCor(this,'${e}');VariasCor(this,'${e}')"></li>`
</script>

</html>