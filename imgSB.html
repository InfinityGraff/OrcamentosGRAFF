<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Upload com Supabase</title>
  <script src="https://unpkg.com/@supabase/supabase-js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    .upload { margin-bottom: 20px; }
    #galeria {display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;}
    #galeria img {width: 150px; height: 150px; object-fit: cover;border-radius: 8px; box-shadow: 0 2px 6px rgba(0,0,0,0.2);}
  </style>
</head>
<body>
  <h2>Upload com Supabase</h2>

  <div class="upload">
    <label>Selecionar Imagem:</label><input type="file" id="inputImagem" accept="image/*"><br><br>
    <label>Selecionar Arquivo:</label><input type="file" id="inputArquivo"><br><br>
    <button onclick="upload()">Enviar</button>
    <button onclick="carregarGaleria()">Galeria</button>
  </div>

  <h3>Galeria</h3>
  <div id="galeria"></div>

  <script>
    const SUPABASE_URL      = "https://adxigvfxtafvlmpvwwvb.supabase.co"
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkeGlndmZ4dGFmdmxtcHZ3d3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1Njc1NTEsImV4cCI6MjA2NzE0MzU1MX0.wc90qDuSNhtolJBd4qLEux3xCwJwPuTTFb3gZMKUBYU"
    const supabase          = window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY)

    const bucketName = "uploads" // bucket criado no Supabase

    // Upload dos arquivos
    async function upload(){
      const imgFile = document.getElementById("inputImagem").files[0]
      const file = document.getElementById("inputArquivo").files[0]

      if (imgFile) await EnviaArq(imgFile,"imagens/")
      if (file) await EnviaArq(file,"arquivos/")

      carregarGaleria()
    }

    // Envia arquivo para Supabase Storage
    async function EnviaArq(file,pasta){
      const nome = `${pasta}_${file.name}`
      let {error} = await supabase.storage.from(bucketName).upload(nome,file,{upsert:false})
      if (error) {
        console.error("Erro no upload:", error.message)
        alert("Erro ao enviar: " + error.message)}
    }

    // Carregar imagens na galeria
    async function carregarGaleria(){
      const {data,error} = await supabase.storage.from(bucketName).list("imagens",{limit:50})
      if (error){console.error("Erro ao listar:", error.message);return}
      const galeria = document.getElementById("galeria")
      galeria.innerHTML = ""

      for (let item of data){
        const {data:urlData} = await supabase.storage.from(bucketName).getPublicUrl("imagens/"+item.name)
        const img = document.createElement("img")
        img.src = urlData.publicUrl
        galeria.appendChild(img)
      }
    }
    carregarGaleria()
  </script>
</body>
</html>