<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Operador - Placar</title>
    <link  href="https://raw.githack.com/InfinityGraff/MyBiblioteca/main/CSSBiblioteca.css" rel="stylesheet">
    <script src="https://raw.githack.com/InfinityGraff/MyBiblioteca/main/PreScript.js"      ></script>
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
    <script> // Base de Dados
      const SUPABASE_URL = "https://adxigvfxtafvlmpvwwvb.supabase.co"
      const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkeGlndmZ4dGFmdmxtcHZ3d3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1Njc1NTEsImV4cCI6MjA2NzE0MzU1MX0.wc90qDuSNhtolJBd4qLEux3xCwJwPuTTFb3gZMKUBYU"
      const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY)
    </script>
</head>

<style>
  body { display: flex; flex-direction: column; align-items: center; justify-content: flex-start; font-family: 'Arial', sans-serif; background: #f0f2f5; color: #333; margin: 0; padding: 40px 20px; }
  h1 { font-size: 2.5rem; margin-bottom: 30px; color: #1a1a1a; }
  label { display: block; font-weight: bold; margin-top: 15px; }
  input[type="text"], input[type="number"] { width: 200px; padding: 10px; margin-top: 5px; border-radius: 8px; border: 1px solid #ccc; font-size: 1rem; transition: border 0.2s, box-shadow 0.2s; }
  input:focus { border-color: #4a90e2; box-shadow: 0 0 5px rgba(74,144,226,0.5); outline: none; }
  button { margin-top: 30px; padding: 12px 25px; font-size: 1.2rem; background: #4a90e2; color: #fff; border: none; border-radius: 10px; cursor: pointer; transition: background 0.2s, transform 0.1s; }
  button:hover { background: #357ABD; transform: scale(1.05); }
  .dropzone { border: 2px dashed #fff; padding: 20px; text-align: center; border-radius: 10px; background: #ffffff1a; cursor: pointer; }
  .dropzone.hover { background: #ffffff33; }
</style>

<body>
  <h1>Operador do Placar</h1>

  <div class="Ct">
    <div class="Cl">
      <label>Time A:</label><input id="time_a" value="Time Azul"><br>
      <div id="dropA" class="dropzone">Adicionar Imagem</div><br>
      <label>Gols A:</label><input type="number" id="gols_a" value="0"><br>
    </div>
    <div class="Cl">
      <label>Time B:</label><input id="time_b" value="Time Vermelho"><br>
      <div id="dropB" class="dropzone">Adicionar Imagem</div><br>
      <label>Gols B:</label><input type="number" id="gols_b" value="0"><br>
    </div>
  </div>

  <label>Tempo:</label>
  <select id="tempo">
    <option>1º Tempo</option>
    <option>2º Tempo</option>
    <option>Prorrogação</option>
    <option>Acréscimos</option>
    <option>Pênaltis</option>
    <option>Encerrado</option>
  </select><br><br>

  <button onclick="atualizar()">Atualizar Placar</button>
</body>

<script>
  async function uploadImagem(file, nomeTime) {
    const fileName = `${nomeTime.replace(/\s+/g, '_')}.png`;
    const { data, error } = await supabase.storage.from('times').upload(fileName, file, { upsert: true });

    if (error) {
      alert('❌ Erro ao enviar imagem');
      console.error(error);
      return null;
    }

    const { data: publicUrl } = supabase.storage.from('times').getPublicUrl(fileName);
    return publicUrl.publicUrl;
  }

  async function atualizar() {
    const d = {
      time_a: time_a.value,
      time_b: time_b.value,
      gols_a: +gols_a.value,
      gols_b: +gols_b.value,
      tempo: tempo.value,
      img_a: ImgA_URL || '',
      img_b: ImgB_URL || ''
    };
    const { error } = await supabase.from('placar').update(d).eq('id', 1);
    if (error) console.error(error);
    else alert('✅ Placar atualizado!');
  }

  // ==================== Drag & Drop ====================

  let ImgA_URL = '', ImgB_URL = '';

  function prepararDrop(dropId, timeId, tipo) {
    const zona = document.getElementById(dropId);

    zona.onclick = () => {
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = async e => {
        const file = e.target.files[0];
        if (file) {
          const url = await uploadImagem(file, document.getElementById(timeId).value);
          if (tipo === 'A') ImgA_URL = url;
          else ImgB_URL = url;
          zona.textContent = '✅ Imagem enviada!';
        }
      };
      input.click();
    };

    zona.ondragover = e => { e.preventDefault(); zona.classList.add('hover'); };
    zona.ondragleave = () => zona.classList.remove('hover');
    zona.ondrop = async e => {
      e.preventDefault();
      zona.classList.remove('hover');
      const file = e.dataTransfer.files[0];
      if (file) {
        const url = await uploadImagem(file, document.getElementById(timeId).value);
        if (tipo === 'A') ImgA_URL = url;
        else ImgB_URL = url;
        zona.textContent = '✅ Imagem enviada!';
      }
    };
  }

  prepararDrop('dropA','time_a','A')
  prepararDrop('dropB','time_b','B')
</script>

</html>
