<!DOCTYPE html>
<html lang='pt-BR'>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orcamento</title>
    <link rel="icon" type="image/x-icon" href="Img/FavG_32.png">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link  href="https://raw.githack.com/InfinityGraff/MyBiblioteca/main/fontes.css"        rel="stylesheet">
    <link  href="https://raw.githack.com/InfinityGraff/MyBiblioteca/main/CSSBiblioteca.css" rel="stylesheet">
    <script src="https://raw.githack.com/InfinityGraff/MyBiblioteca/main/PreScript.js"      ></script>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
          
        <link  href="https://raw.githack.com/InfinityGraff/MyBiblioteca/main/SB_Crud.css" rel="stylesheet">
        <script src="https://raw.githack.com/InfinityGraff/MyBiblioteca/main/SB_Crud.js"        ></script>
         
<!-- 
        <link href="../MyBiblioteca/SB_Crud.css" rel="stylesheet">
        <script src="../MyBiblioteca/SB_Crud.js"      ></script>
--> 
    <!--
        <link  href="../MyBiblioteca/fontes.css"        rel="stylesheet">
        <link  href="../MyBiblioteca/CSSBiblioteca.css" rel="stylesheet">
       
        <link  href="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/fontes.css"        rel="stylesheet">
        <link  href="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/CSSBiblioteca.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/PreScript.js"      ></script>
    -->
    
    <link  href="./CssGRAFF.css" rel="stylesheet">
    <script src="./BaseGRAFF.js"></script>
    <script src="./BiblGRAFF.js"></script>
    <script src="./Gera3D.js"></script>
    
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/0.160.0/three.min.js"></script> -->
    <!--<script src="https://threejs.org/build/three.js"></script>-->
</head>

<script> // Configuração do SupaBase
    const SUPABASE_URL      = "https://adxigvfxtafvlmpvwwvb.supabase.co"
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkeGlndmZ4dGFmdmxtcHZ3d3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1Njc1NTEsImV4cCI6MjA2NzE0MzU1MX0.wc90qDuSNhtolJBd4qLEux3xCwJwPuTTFb3gZMKUBYU"
    const supaBASE          = window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY)
    const BASE_URL          = `https://adxigvfxtafvlmpvwwvb.supabase.co/storage/v1/object/public/uploads/`
</script>

<script>
  const CRYPP  = ['Fixo','Edit','Data','Valr','Slct','Chek','Imgs','Mdds','Bndj','Auto','Soma','Lixo','Ssvg','Sync','Link','BjIn','OKAY']
  const CRYCLS = ['Auto','CorID','Fita1','Fita2','LnK']
</script>

<style>
    body    {font-family:Arial;background:#111;color:#eee}
    .SB_WRAP{border:1px solid #444;padding:10px;margin:12px}
    .SB_WRAP h2{margin:0 0 8px;color:#8f007c}
    .SB_ROW {margin-bottom:40px}
    .SB_CELL{border:1px solid #666;padding:4px 4px;min-width:70px;background:#1b1b1b}
    .SB_CELL[contenteditable="true"]:focus{outline:2px solid #8f007c;background:#222}
    .SB_ID  {background:#000;color:#999}
</style>

<body>
    <div id="app"></div>
</body>

<script>
  async function SB_GET(){
    const {data,error} = await supaBASE.from('BS').select('*').order('Id',{ascending:true})
    if(error){ERR(error);return []} ; return data
  }

  function RenderBS(rows){
    window.SB_OnInput = (id,key,prop,el)=>{const R=rows.find(r=>r.Id==id) ; if(!R) return ; UpdateJSON(R,key,prop,el.innerText )}
    Inn($('#app'),rows.map(row=>{
      const json = typeof row.Json==='string' ? JSON.parse(row.Json) : row.Json
      if(!json) return ''
      return `<div class="Ct SB_WRAP"><h2 class="w100">${row.Tabela}</h2>
        <div class="Cl SB_ROW">${['.','TM','CLS','SRC','TH','LINK','FOOT','DPCK','COR','AUTO'].map(e=>`<div class="SB_CELL SB_ID">${e}</div>`).join('')}</div>
        ${ObjEtr(json).map(([k,j])=>`
          <div class="Cl SB_ROW">
            <div class="SB_CELL SB_ID" contenteditable onblur="SB_OnInput(${row.Id},'${k}','KEY',this)">${k}</div>
            ${['TM','CLS','SRC','TH','LINK','FOOT','DPCK','COR','AUTO'].map(e=>`<div class="SB_CELL" contenteditable onblur="SB_OnInput(${row.Id},'${k}','${e}',this)">${j[e]??''}</div>`).join('')}
          </div>`).join('')}
      </div>`
    }).join(''))
  }

  function UpdateJSON(row,key,prop,val){
    LOG(row,key,prop,val)
    const json = typeof row.Json === 'string' ? JSON.parse(row.Json) : structuredClone(row.Json)
    if(prop === 'KEY'){
      val = val.trim()
      if(!val || val === key || json[val]) return
      json[val] = json[key]
      delete json[key]
    } else {json[key] && (json[key][prop] = val) }
    Sb_EDIT(supaBASE, 'BS', row.Id, 'Json', row.Json = json)
  }

  async function Init(){const rows = await SB_GET() ; RenderBS(rows)}
  Init()

  // Exibir aqui na Tabela um Reflexo de como as tabelas vão ficar no CSS

</script>

</html>










