<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Desing</title>
    <link rel="icon" type="image/x-icon" href="Img/FavG_32.png">
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <!--
    <link  href="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/fontes.css"        rel="stylesheet">
    <link  href="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/CSSBiblioteca.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/InfinityGraff/MyBiblioteca@main/PreScript.js"      ></script>
    -->
    <link  href="../MyBiblioteca/CSSBiblioteca.css" rel="stylesheet">
    <link  href="../MyBiblioteca/fontes.css"        rel="stylesheet">
    <script src="../MyBiblioteca/PreScript.js"      ></script>
    <link  href="./CssGRAFF.css" rel="stylesheet">
    <script src="./BaseGRAFF.js"></script>
    <script src="./BiblGRAFF.js"></script>
    <script src="./Gera3D.js"></script>
    <script src="./Base.js"></script>
    <script src="./JSON/JSON.js"></script>
</head>

<script> // Configuração do SupaBase
    const SUPABASE_URL      = "https://adxigvfxtafvlmpvwwvb.supabase.co"
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFkeGlndmZ4dGFmdmxtcHZ3d3ZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTE1Njc1NTEsImV4cCI6MjA2NzE0MzU1MX0.wc90qDuSNhtolJBd4qLEux3xCwJwPuTTFb3gZMKUBYU"
    const Supabase          = window.supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY)
    const BASE_URL          = `https://adxigvfxtafvlmpvwwvb.supabase.co/storage/v1/object/public/uploads/`
</script>

<style>
    .Gap        {gap:14px} .gap{gap: 8px}
    body        {padding: 14px}
    *           {box-sizing:border-box}
    .rs         {color:#8dff57}
    .Box .rs    {font-size: 25px}
    .Art .rs    {font-size: 25px}
    h2,h3       {font-size: 25px}
    .BOX        {padding:18px;border-radius:14px;background:#111;border:1px solid #222}
    .Box        {width:130px; height:100px; padding:5px ;  transition:all 0.1s ease-in-out ;cursor: pointer;}
    .Box:hover  {border:1px solid #93c47d;box-shadow:0 0 8px #93c47d99;transform:scale(1.05);}
    #Perf .Box a{width: 40px; height: 40px}
    .Desc a     {width: 15px; height: 15px}
    .Pic        {width:120px;border-radius:50%}
    .Art        {gap:3px}
    .Art img    {width:120px;height:120px;object-fit:contain;border-radius:8px;background:#111}
    .Fotoz      {width: 20px; height: auto;}

    .Svg-P svg  {width: 15px; height: 15px;}
    .Svg-M svg  {width: 30px; height: 30px;}
    .Svg-G svg  {width: 40px; height: 40px;}

    #Perf-Trfs table {width:100%; font-size:14px; color:#eee; background-color:#222}
    #Perf-Trfs th, #Perf-Trfs td {border:1px solid #444; padding:8px 12px; text-align:left}
    #Perf-Trfs th                {background-color:#333}
    #Perf-Trfs tr:hover          {background-color:#444}
    #Perf-Trfs td:first-child    {text-align:center; width:50px; }
</style>

<body class="Dark CSS1">
    <div class="Cl Gap">
        <div id="Perf-Perf" class="BOX Ev Gap w80"></div>
        <div id="Perf-Soli" class="BOX Cl Gap w80"></div>
        <div id="Perf-Andm" class="BOX Cl Gap w80"></div>
        <div id="Perf-Hist" class="BOX Cl Gap w80"></div>
        <div id="Perf-Hist2" class="BOX Cl Gap w80"></div>
        <div id="Perf-Trfs" class="BOX Cl Gap w80"></div>
    </div>
</body>

<script>
    let [__A,__M,__D,__S]=['','','','']
    const Tm_SOliArt=(U,E)=>`<h3>Solicitações      </h3><div class="Start w100 Gap">${E.map(e=>`<div class="    Ct Bt Hov BOX" onclick="Unyc('${U}','${e.Id}')"><div class="Cl Start2"><b>${e.Nome}</b><p>${e.Tema} • ${e.Prazo}</p></div><p>${Tm_RS2(e.Valr)}</p><button onclick="AceitarART(${U},${e.Id})">AceitarART</button></div>`).join("")}</div>`
    const Tm_ListArt=(U,E)=>`<h3>Histórico de Artes</h3><div class="Start w100 Gap">${E.map(e=>`<div class="Art Cl PT Hov BOX" onclick="Unyc('${U}','${e.Id}')"><img src="${BASE_URL}Img/${e.Nome}.webp"><p>${e.Nome}</p><p>${e.Tema}</p><p>${Tm_RS2(e.Valr)}</p></div>`).join("")}</div>`
    const View=(U,Md)=>MODAL(Tm_ListArt(U,Md=='Dslk'?__D:__A))        // ao rodar o Modal Excluir o Antigo
    const Unyc=(U,ID)=>MODAL(Tm_ListArt(U,__A.filter(e=>e.Id==ID))) // ao rodar o Modal Excluir o Antigo

    function Load_Perfil(U,u,a){
        __A = a.filter(o=>o.Dsng==U && o.Stts=='Ok' && !o.Dslk?.includes(U))
        __M = a.filter(o=>o.Dsng==U && o.Stts=='Aceita')
        __D = a.filter(o=>o.Dslk?.includes(U))
        __S = a.filter(o=>o.Dsng==null||o.Dsng=="")
        let Partic = 0 ; let Comiss = 0
        J['SERV'].forEach(e=>{if(e.Dsng==U){Partic+=1 ; Comiss+=e.CArt} /*if(e.Cbmt==U){Partic+=1 ; Comiss+=e.VCbt}*/ })

        Inn($('#Perf-Perf'),`<img class="Pic" src="${u.Foto}">
                <div class="Desc Cl Start2 Gap"><div class="Ct Gap"><h2>${u.Nome}</h2><p>${D_Brev2[u.cgo]}</p></div>
                    ${['Emal','Lcal','Fone'].map(e=>`<div class="Ct gap"><a class="Svg-P f-Lrnj">${SVG[e]}</a><p>${u[e]}</p></div>`).join('')}
                </div>
                <div class="Ct Gap">
                    <div class="BOX Cl Box"                              ><a class="Svg-G f-gren">${SVG['Okay']}</a><p>Participações     </p><h3>${Partic             }</h3></div>
                    <div class="BOX Cl Box" onclick="View('${U}','Okay')"><a class="Svg-G f-gren">${SVG['Okay']}</a><p>Total de Artes    </p><h3>${__A.length         }</h3></div>
                    <div class="BOX Cl Box" onclick="View('${U}','Dslk')"><a class="Svg-G f-redd">${SVG['Dslk']}</a><p>Total de rejeições</p><h3>${__D.length         }</h3></div>
                    <div class="BOX Cl Box" onclick="View('${U}','Coin')"><a class="Svg-G f-gren">${SVG['Coin']}</a><p>Saldo Total       </p>${Tm_RS2(SOMA_Obj(__A,'Valr'))}</div>
                </div>`)
        Inn($('#Perf-Soli'),Tm_SOliArt(U,__S)) ; Inn($('#Perf-Andm'),Tm_SOliArt(U,__M)) ; Inn($('#Perf-Hist'),Tm_ListArt(U,__A)) // U.On?"Online":"Offline"
            
        const tableFilt = J.SERV.reverse().filter(e=>e.Dsng==U)

        const rows = tableFilt.map(e=>`<tr>
            <td>${JJ.CLNT[e.Clnt]?.Clnt}</td>
            <td>${e.Serv}</td><td>${e.TArt}</td><td>${e.CArt}</td><td>${e.Dsng}</td>
            <td><img class="Fotoz" src="${BASE_URL}Img/${e.Id}"></td>
        </tr>`).join('')

        Inn($('#Perf-Trfs'),`<table><thead><tr>${['Cliente','Serviço','Tipo','Valor','Desing','Foto'].map(e=>`<th>${e}</th>`).join('')}</tr></thead><tbody>${rows}</tbody></table>`)
        Inn($('#Perf-Hist2' ),`<h3>Histórico de Artes</h3><div class="Start w100 Gap">${tableFilt.map(e=>`<div class="Art Cl PT Hov BOX" onclick="Unyc('${e.Id}')"><img src="${BASE_URL}Img/${e.Id}.webp"><p>${JJ.CLNT[e.Clnt]?.Clnt}</p><p>${e.TArt}</p><p>${Tm_RS2(e.CArt)}</p></div>`).join("")}</div>`)    
    }
    
    async function LoadByName(U){
        if(!U) return          null ; const {data:USER,error:e1} = await Supabase.from("USER").select("*").eq("Nome",U).single()
        if(e1) return ERR(e1), null ; const {data:ARTE         } = await Supabase.from("ARTE").select("*")
        return {USER,ARTE}
    }
    
    async function AceitarART(U,Id){const{error}=await Supabase.from("ARTE").update({Stts:"Aceita",Dsng:U}).eq("Id",Id)
        if(!error){alert("Solicitação aceita") ; location.reload()}
    }

    LoadByName('Fexta').then(r=>{if(!r)return;Load_Perfil('Fexta',r.USER,r.ARTE)})
</script>

<script> // passar pra Bibliotecas
// SVG P M e G
// o novo tmRS()
// idéia dos Boxs

</script>

</html>